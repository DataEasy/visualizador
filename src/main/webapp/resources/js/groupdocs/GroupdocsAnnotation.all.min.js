!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var n,e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(n in t)if(void 0!==e.style[n])return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var i,n=e(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close")),t.isDefaultPrevented()||(i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s())};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),"string"==typeof t&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.alert.data-api",t,n.prototype.close)}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){"loadingText"==e?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s="object"==typeof n&&n;i||r.data("button",i=new t(this,s)),"toggle"==n?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(t){var n=this.getActiveIndex(),r=this;if(!(t>this.$items.length-1||0>t))return this.sliding?this.$element.one("slid",function(){r.to(t)}):n==t?this.pause().cycle():this.slide(t>n?"next":"prev",e(this.$items[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){return this.sliding?void 0:this.slide("next")},prev:function(){return this.sliding?void 0:this.slide("prev")},slide:function(t,n){var f,r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o="next"==t?"left":"right",u="next"==t?"first":"last",a=this;if(this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u](),f=e.Event("slide",{relatedTarget:i[0],direction:o}),!i.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var t=e(a.$indicators.children()[a.getActiveIndex()]);t&&t.addClass("active")})),e.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(f),f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{if(this.$element.trigger(f),f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,"object"==typeof n&&n),o="string"==typeof n?n:s.slide;i||r.data("carousel",i=new t(this,s)),"number"==typeof n?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(t){var r,o,n=e(this),i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),n.data());i.carousel(s),(o=n.attr("data-slide-to"))&&i.data("carousel").pause().to(o).cycle(),t.preventDefault()})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(!this.transitioning&&!this.$element.hasClass("in")){if(t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in"),r&&r.length){if(i=r.data("collapse"),i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])}},hide:function(){var t;!this.transitioning&&this.$element.hasClass("in")&&(t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0))},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[null!==e?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){"show"==n.type&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n),n.isDefaultPrevented()||(this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=e.extend({},e.fn.collapse.defaults,r.data(),"object"==typeof n&&n);i||r.data("collapse",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.collapse.data-api","[data-toggle=collapse]",function(t){var r,n=e(this),i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})}(window.jQuery),!function(e){"use strict";function r(){e(".dropdown-backdrop").remove(),e(t).each(function(){i(e(this)).removeClass("open")})}function i(t){var r,n=t.attr("data-target");return n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=n&&e(n),r&&r.length||(r=t.parent()),r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var s,o,n=e(this);if(!n.is(".disabled, :disabled"))return s=i(n),o=s.hasClass("open"),r(),o||("ontouchstart"in document.documentElement&&e('<div class="dropdown-backdrop"/>').insertBefore(e(this)).on("click",r),s.toggleClass("open")),n.focus(),!1},keydown:function(n){var r,s,u,a,f;if(/(38|40|27)/.test(n.keyCode)&&(r=e(this),n.preventDefault(),n.stopPropagation(),!r.is(".disabled, :disabled"))){if(u=i(r),a=u.hasClass("open"),!a||a&&27==n.keyCode)return 27==n.which&&u.find(t).focus(),r.click();s=e("[role=menu] li:not(.divider):visible a",u),s.length&&(f=s.index(s.filter(":focus")),38==n.keyCode&&f>0&&f--,40==n.keyCode&&f<s.length-1&&f++,~f||(f=0),s.eq(f).focus())}}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),"string"==typeof t&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.dropdown.data-api",r).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")}))},hide:function(t){t&&t.preventDefault();t=e.Event("hide"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){27==t.which&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;if(this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t):t()):t&&t()}};var n=e.fn.modal;e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),"object"==typeof n&&n);i||r.data("modal",i=new t(this,s)),"string"==typeof n?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s,o,u,a;for(this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,o=this.options.trigger.split(" "),a=o.length;a--;)u=o[a],"click"==u?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):"manual"!=u&&(i="hover"==u?"mouseenter":"focus",s="hover"==u?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this)));this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i,n=e.fn[this.type].defaults,r={};return this._options&&e.each(this._options,function(e,t){n[e]!=t&&(r[e]=t)},this),i=e(t.currentTarget)[this.type](r).data(this.type),i.options.delay&&i.options.delay.show?(clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show),void 0):i.show()},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),n.options.delay&&n.options.delay.hide?(n.hoverState="out",void(this.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide))):n.hide()},show:function(){var t,n,r,i,s,o,u=e.Event("show");if(this.hasContent()&&this.enabled){if(this.$element.trigger(u),u.isDefaultPrevented())return;switch(t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),s="function"==typeof this.options.placement?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,t.detach().css({top:0,left:0,display:"block"}),this.options.container?t.appendTo(this.options.container):t.insertAfter(this.$element),n=this.getPosition(),r=t[0].offsetWidth,i=t[0].offsetHeight,s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}this.applyPlacement(o,s),this.$element.trigger("shown")}},applyPlacement:function(e,t){var s,o,u,a,n=this.tip(),r=n[0].offsetWidth,i=n[0].offsetHeight;n.offset(e).addClass(t).addClass("in"),s=n[0].offsetWidth,o=n[0].offsetHeight,"top"==t&&o!=i&&(e.top=e.top+i-o,a=!0),"bottom"==t||"top"==t?(u=0,e.left<0&&(u=-2*e.left,e.left=0,n.offset(e),s=n[0].offsetWidth,o=n[0].offsetHeight),this.replaceArrow(u-r+s,s,"left")):this.replaceArrow(o-i,o,"top"),a&&n.offset(e)},replaceArrow:function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function i(){var t=setTimeout(function(){n.off(e.support.transition.end).detach()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.detach()})}var n=this.tip(),r=e.Event("hide");return this.$element.trigger(r),r.isDefaultPrevented()?void 0:(n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?i():n.detach(),this.$element.trigger("hidden"),this)},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var t=this.$element[0];return e.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},tip:function(){return this.$tip=this.$tip||e(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var n=t?e(t.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s="object"==typeof n&&n;i||r.data("tooltip",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=("function"==typeof n.content?n.content.call(t[0]):n.content)||t.attr("data-content")},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s="object"==typeof n&&n;i||r.data("popover",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(window.jQuery),!function(e){"use strict";function t(t,n){var s,r=e.proxy(this.process,this),i=e(e(t).is("body")?window:t);this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var n,t=this;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var n=e(this),r=n.data("target")||n.attr("href"),i=/^#\w/.test(r)&&e(r);return i&&i.length&&[[i.position().top+(!e.isWindow(t.$scrollElement.get(0))&&t.$scrollElement.scrollTop()),r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var o,e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s="object"==typeof n&&n;i||r.data("scrollspy",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var i,s,o,t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target");r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),t.parent("li").hasClass("active")||(i=n.find(".active:last a")[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o),o.isDefaultPrevented()||(s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})))},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),"string"==typeof n&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=e(this.options.menu),this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){for(var i,t=[],n=[],r=[];i=e.shift();)i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t="function"==typeof this.$element[e]),t},move:function(e){if(this.shown){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()}},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){this.suppressKeyPressRepeat||this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},focus:function(e){this.focused=!0},blur:function(e){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(e){e.stopPropagation(),e.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(t){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=e.fn.typeahead;e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s="object"==typeof n&&n;i||r.data("typeahead",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=n,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);n.data("typeahead")||n.typeahead(n.data())})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)).on("click.affix.data-api",e.proxy(function(){setTimeout(e.proxy(this.checkPosition,this),1)},this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var a,t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom";"object"!=typeof i&&(s=o=i),"function"==typeof o&&(o=i.top()),"function"==typeof s&&(s=i.bottom()),a=null!=this.unpin&&n+this.unpin<=r.top?!1:null!=s&&r.top+this.$element.height()>=t-s?"bottom":null!=o&&o>=n?"top":!1,this.affixed!==a&&(this.affixed=a,this.unpin="bottom"==a?r.top-n:null,this.$element.removeClass(u).addClass("affix"+(a?"-"+a:"")))}};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s="object"==typeof n&&n;i||r.data("affix",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery),function(){function s(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent("on"+c,b)}function y(a){return"keypress"==a.type?String.fromCharCode(a.which):h[a.which]?h[a.which]:z[a.which]?z[a.which]:String.fromCharCode(a.which).toLowerCase()}function t(a,c){a=a||{};var d,b=!1;for(d in m)a[d]&&m[d]>c?b=!0:m[d]=0;b||(p=!1)}function A(a,c,b,d,g){var f,e,h=[],j=b.type;if(!l[a])return[];for("keyup"==j&&u(a)&&(c=[a]),f=0;f<l[a].length;++f)e=l[a][f],e.seq&&m[e.seq]!=e.level||j!=e.action||("keypress"!=j||b.metaKey||b.ctrlKey)&&c.sort().join(",")!==e.modifiers.sort().join(",")||(d&&e.combo==g&&l[a].splice(f,1),h.push(e));return h}function v(a,c,b){k.stopCallback(c,c.target||c.srcElement,b)||!1!==a(c,b)||(c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.returnValue=!1,c.cancelBubble=!0)}function w(a){"number"!=typeof a.which&&(a.which=a.keyCode);var c=y(a);if(c)if("keyup"==a.type&&x==c)x=!1;else{var b=[];a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta");var d,b=A(c,b,a),g={},f=0,e=!1;for(d=0;d<b.length;++d)b[d].seq?(e=!0,f=Math.max(f,b[d].level),g[b[d].seq]=1,v(b[d].callback,a,b[d].combo)):!e&&!p&&v(b[d].callback,a,b[d].combo);a.type==p&&!u(c)&&t(g,f)}}function u(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function B(a,c,b){if(!b){if(!q){q={};for(var d in h)d>95&&112>d||h.hasOwnProperty(d)&&(q[h[d]]=d)}b=q[a]?"keydown":"keypress"}return"keypress"==b&&c.length&&(b="keydown"),b}function C(a,c,b,d,g){r[a+":"+b]=c,a=a.replace(/\s+/g," ");var e,h,f=a.split(" "),j=[];if(1<f.length){var k=a,n=b;for(m[k]=0,n||(n=B(f[0],[])),a=function(){p=n,++m[k],clearTimeout(D),D=setTimeout(t,1e3)},b=function(a){v(c,a,k),"keyup"!==n&&(x=y(a)),setTimeout(t,10)},d=0;d<f.length;++d)C(f[d],d<f.length-1?a:b,n,k,d)}else{for(h="+"===a?["+"]:a.split("+"),f=0;f<h.length;++f)e=h[f],E[e]&&(e=E[e]),b&&"keypress"!=b&&F[e]&&(e=F[e],j.push("shift")),u(e)&&j.push(e);b=B(e,j,b),l[e]||(l[e]=[]),A(e,j,{type:b},!d,a),l[e][d?"unshift":"push"]({callback:c,modifiers:j,action:b,seq:d,level:g,combo:a})}}for(var q,D,h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},z={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},F={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},E={option:"alt",command:"meta","return":"enter",escape:"esc"},l={},r={},m={},x=!1,p=!1,g=1;20>g;++g)h[111+g]="f"+g;for(g=0;9>=g;++g)h[g+96]=g;s(document,"keypress",w),s(document,"keydown",w),s(document,"keyup",w);var k={bind:function(a,c,b){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)C(a[d],c,b);return this},unbind:function(a,c){return k.bind(a,function(){},c)},trigger:function(a,c){return r[a+":"+c]&&r[a+":"+c](),this},reset:function(){return l={},r={},this},stopCallback:function(a,c){return-1<(" "+c.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==c.tagName||"SELECT"==c.tagName||"TEXTAREA"==c.tagName||c.contentEditable&&"true"==c.contentEditable}};window.Mousetrap=k,"function"==typeof define&&define.amd&&define(k)}(),function($){$.fn.customScrollbar=function(options,args){var defaultOptions={skin:void 0,hScroll:!0,vScroll:!0,updateOnWindowResize:!1,animationSpeed:300,onCustomScroll:void 0,swipeSpeed:1,wheelSpeed:40,fixedThumbWidth:void 0,fixedThumbHeight:void 0,preventDefaultScroll:!1},Scrollable=function(element,options){
this.$element=$(element),this.options=options,this.addScrollableClass(),this.addSkinClass(),this.addScrollBarComponents(),this.options.vScroll&&(this.vScrollbar=new Scrollbar(this,new VSizing)),this.options.hScroll&&(this.hScrollbar=new Scrollbar(this,new HSizing)),this.$element.data("scrollable",this),this.initKeyboardScrolling(),this.bindEvents()};Scrollable.prototype={addScrollableClass:function(){this.$element.hasClass("scrollable")||(this.scrollableAdded=!0,this.$element.addClass("scrollable"))},removeScrollableClass:function(){this.scrollableAdded&&this.$element.removeClass("scrollable")},addSkinClass:function(){"string"!=typeof this.options.skin||this.$element.hasClass(this.options.skin)||(this.skinClassAdded=!0,this.$element.addClass(this.options.skin))},removeSkinClass:function(){this.skinClassAdded&&this.$element.removeClass(this.options.skin)},addScrollBarComponents:function(){this.assignViewPort(),0==this.$viewPort.length&&(this.$element.wrapInner('<div class="viewport" />'),this.assignViewPort(),this.viewPortAdded=!0),this.assignOverview(),0==this.$overview.length&&(this.$viewPort.wrapInner('<div class="overview" />'),this.assignOverview(),this.overviewAdded=!0),this.addScrollBar("vertical","prepend"),this.addScrollBar("horizontal","append")},removeScrollbarComponents:function(){this.removeScrollbar("vertical"),this.removeScrollbar("horizontal"),this.overviewAdded&&this.$element.unwrap(),this.viewPortAdded&&this.$element.unwrap()},removeScrollbar:function(orientation){this[orientation+"ScrollbarAdded"]&&this.$element.find(".scroll-bar."+orientation).remove()},assignViewPort:function(){this.$viewPort=this.$element.find(".viewport")},assignOverview:function(){this.$overview=this.$viewPort.find(".overview")},addScrollBar:function(orientation,fun){0==this.$element.find(".scroll-bar."+orientation).length&&(this.$element[fun]("<div class='scroll-bar "+orientation+"'><div class='thumb'></div></div>"),this[orientation+"ScrollbarAdded"]=!0)},resize:function(keepPosition){this.vScrollbar&&this.vScrollbar.resize(keepPosition),this.hScrollbar&&this.hScrollbar.resize(keepPosition)},scrollTo:function(element){this.vScrollbar&&this.vScrollbar.scrollToElement(element),this.hScrollbar&&this.hScrollbar.scrollToElement(element)},scrollToXY:function(x,y){this.scrollToX(x),this.scrollToY(y)},scrollToX:function(x){this.hScrollbar&&this.hScrollbar.scrollOverviewTo(x,!0)},scrollToY:function(y){this.vScrollbar&&this.vScrollbar.scrollOverviewTo(y,!0)},scrollByX:function(x){this.hScrollbar&&this.scrollToX(this.hScrollbar.overviewPosition()+x)},scrollByY:function(y){this.vScrollbar&&this.scrollToY(this.vScrollbar.overviewPosition()+y)},remove:function(){this.removeScrollableClass(),this.removeSkinClass(),this.removeScrollbarComponents(),this.$element.data("scrollable",null),this.removeKeyboardScrolling(),this.vScrollbar&&this.vScrollbar.remove(),this.hScrollbar&&this.hScrollbar.remove()},setAnimationSpeed:function(speed){this.options.animationSpeed=speed},isInside:function(element,wrappingElement){var $element=$(element),$wrappingElement=$(wrappingElement),elementOffset=$element.offset(),wrappingElementOffset=$wrappingElement.offset();return elementOffset.top>=wrappingElementOffset.top&&elementOffset.left>=wrappingElementOffset.left&&elementOffset.top+$element.height()<=wrappingElementOffset.top+$wrappingElement.height()&&elementOffset.left+$element.width()<=wrappingElementOffset.left+$wrappingElement.width()},initKeyboardScrolling:function(){var _this=this;this.elementKeydown=function(event){document.activeElement===_this.$element[0]&&(_this.vScrollbar&&_this.vScrollbar.keyScroll(event),_this.hScrollbar&&_this.hScrollbar.keyScroll(event))},this.$element.attr("tabindex","-1").keydown(this.elementKeydown)},removeKeyboardScrolling:function(){this.$element.removeAttr("tabindex").unbind("keydown",this.elementKeydown)},bindEvents:function(){this.options.onCustomScroll&&this.$element.on("customScroll",this.options.onCustomScroll)}};var Scrollbar=function(scrollable,sizing){this.scrollable=scrollable,this.sizing=sizing,this.$scrollBar=this.sizing.scrollBar(this.scrollable.$element),this.$thumb=this.$scrollBar.find(".thumb"),this.setScrollPosition(0,0),this.resize(),this.initMouseMoveScrolling(),this.initMouseWheelScrolling(),this.initTouchScrolling(),this.initMouseClickScrolling(),this.initWindowResize()};Scrollbar.prototype={resize:function(keepPosition){this.overviewSize=this.sizing.size(this.scrollable.$overview),this.calculateViewPortSize(),this.sizing.size(this.scrollable.$viewPort,this.viewPortSize),this.ratio=this.viewPortSize/this.overviewSize,this.sizing.size(this.$scrollBar,this.viewPortSize),this.thumbSize=this.calculateThumbSize(),this.sizing.size(this.$thumb,this.thumbSize),this.maxThumbPosition=this.calculateMaxThumbPosition(),this.maxOverviewPosition=this.calculateMaxOverviewPosition(),this.enabled=this.overviewSize>this.viewPortSize,void 0===this.scrollPercent&&(this.scrollPercent=0),this.enabled?this.rescroll(keepPosition):this.setScrollPosition(0,0),this.$scrollBar.toggle(this.enabled)},calculateViewPortSize:function(){var elementSize=this.sizing.size(this.scrollable.$element);if(elementSize>0&&!this.maxSizeUsed)this.viewPortSize=elementSize,this.maxSizeUsed=!1;else{var maxSize=this.sizing.maxSize(this.scrollable.$element);this.viewPortSize=Math.min(maxSize,this.overviewSize),this.maxSizeUsed=!0}},calculateThumbSize:function(){var size,fixedSize=this.sizing.fixedThumbSize(this.scrollable.options);return size=fixedSize?fixedSize:this.ratio*this.viewPortSize,Math.max(size,this.sizing.minSize(this.$thumb))},initMouseMoveScrolling:function(){var _this=this;this.$thumb.mousedown(function(event){_this.enabled&&_this.startMouseMoveScrolling(event)}),this.documentMouseup=function(event){_this.stopMouseMoveScrolling(event)},$(document).mouseup(this.documentMouseup),this.documentMousemove=function(event){_this.mouseMoveScroll(event)},$(document).mousemove(this.documentMousemove),this.$thumb.click(function(event){event.stopPropagation()})},removeMouseMoveScrolling:function(){this.$thumb.unbind(),$(document).unbind("mouseup",this.documentMouseup),$(document).unbind("mousemove",this.documentMousemove)},initMouseWheelScrolling:function(){var _this=this;this.scrollable.$element.mousewheel(function(event,delta,deltaX,deltaY){if(_this.enabled){var scrolled=_this.mouseWheelScroll(deltaX,deltaY);_this.stopEventConditionally(event,scrolled)}})},removeMouseWheelScrolling:function(){this.scrollable.$element.unbind("mousewheel")},initTouchScrolling:function(){if(document.addEventListener){var _this=this;this.elementTouchstart=function(event){_this.enabled&&_this.startTouchScrolling(event)},this.scrollable.$element[0].addEventListener("touchstart",this.elementTouchstart),this.documentTouchmove=function(event){_this.touchScroll(event)},this.scrollable.$element[0].addEventListener("touchmove",this.documentTouchmove),this.elementTouchend=function(event){_this.stopTouchScrolling(event)},this.scrollable.$element[0].addEventListener("touchend",this.elementTouchend)}},removeTouchScrolling:function(){document.addEventListener&&(this.scrollable.$element[0].removeEventListener("touchstart",this.elementTouchstart),document.removeEventListener("touchmove",this.documentTouchmove),this.scrollable.$element[0].removeEventListener("touchend",this.elementTouchend))},initMouseClickScrolling:function(){var _this=this;this.scrollBarClick=function(event){_this.mouseClickScroll(event)},this.$scrollBar.click(this.scrollBarClick)},removeMouseClickScrolling:function(){this.$scrollBar.unbind("click",this.scrollBarClick)},initWindowResize:function(){if(this.scrollable.options.updateOnWindowResize){var _this=this;this.windowResize=function(){_this.resize()},$(window).resize(this.windowResize)}},removeWindowResize:function(){$(window).unbind("resize",this.windowResize)},isKeyScrolling:function(key){return null!=this.keyScrollDelta(key)},keyScrollDelta:function(key){for(var scrollingKey in this.sizing.scrollingKeys)if(scrollingKey==key)return this.sizing.scrollingKeys[key](this.viewPortSize);return null},startMouseMoveScrolling:function(event){this.mouseMoveScrolling=!0,$("body").addClass("not-selectable"),this.setUnselectable($("body"),"on"),this.setScrollEvent(event),event.preventDefault()},stopMouseMoveScrolling:function(event){this.mouseMoveScrolling=!1,$("body").removeClass("not-selectable"),this.setUnselectable($("body"),null)},setUnselectable:function(element,value){element.attr("unselectable")!=value&&(element.attr("unselectable",value),element.find(":not(input)").attr("unselectable",value))},mouseMoveScroll:function(event){if(this.mouseMoveScrolling){var delta=this.sizing.mouseDelta(this.scrollEvent,event);this.scrollThumbBy(delta),this.setScrollEvent(event)}},startTouchScrolling:function(event){event.touches&&1==event.touches.length&&(this.setScrollEvent(event.touches[0]),this.touchScrolling=!0,event.stopPropagation())},touchScroll:function(event){if(this.touchScrolling&&event.touches&&1==event.touches.length){var delta=-this.sizing.mouseDelta(this.scrollEvent,event.touches[0])*this.scrollable.options.swipeSpeed,scrolled=this.scrollOverviewBy(delta);scrolled&&this.setScrollEvent(event.touches[0]),this.stopEventConditionally(event,scrolled)}},stopTouchScrolling:function(event){this.touchScrolling=!1,event.stopPropagation()},mouseWheelScroll:function(deltaX,deltaY){var delta=-this.sizing.wheelDelta(deltaX,deltaY)*this.scrollable.options.wheelSpeed;return 0!=delta?this.scrollOverviewBy(delta):void 0},mouseClickScroll:function(event){var delta=this.viewPortSize-20;event["page"+this.sizing.scrollAxis()]<this.$thumb.offset()[this.sizing.offsetComponent()]&&(delta=-delta),this.scrollOverviewBy(delta)},keyScroll:function(event){var keyDown=event.which;if(this.enabled&&this.isKeyScrolling(keyDown)){var scrolled=this.scrollOverviewBy(this.keyScrollDelta(keyDown));this.stopEventConditionally(event,scrolled)}},scrollThumbBy:function(delta){var thumbPosition=this.thumbPosition();thumbPosition+=delta,thumbPosition=this.positionOrMax(thumbPosition,this.maxThumbPosition);var oldScrollPercent=this.scrollPercent;if(this.scrollPercent=thumbPosition/this.maxThumbPosition,oldScrollPercent!=this.scrollPercent){var overviewPosition=thumbPosition*this.maxOverviewPosition/this.maxThumbPosition;return this.setScrollPosition(overviewPosition,thumbPosition),this.triggerCustomScroll(oldScrollPercent),!0}return!1},thumbPosition:function(){return this.$thumb.position()[this.sizing.offsetComponent()]},scrollOverviewBy:function(delta){var overviewPosition=this.overviewPosition()+delta;return this.scrollOverviewTo(overviewPosition,!1)},overviewPosition:function(){return-this.scrollable.$overview.position()[this.sizing.offsetComponent()]},scrollOverviewTo:function(overviewPosition,animate){overviewPosition=this.positionOrMax(overviewPosition,this.maxOverviewPosition);var oldScrollPercent=this.scrollPercent;if(this.scrollPercent=overviewPosition/this.maxOverviewPosition,oldScrollPercent!=this.scrollPercent){var thumbPosition=this.scrollPercent*this.maxThumbPosition;return animate?this.setScrollPositionWithAnimation(overviewPosition,thumbPosition):this.setScrollPosition(overviewPosition,thumbPosition),this.triggerCustomScroll(oldScrollPercent),!0}return!1},positionOrMax:function(p,max){return 0>p?0:p>max?max:p},triggerCustomScroll:function(oldScrollPercent){this.scrollable.$element.trigger("customScroll",{scrollAxis:this.sizing.scrollAxis(),direction:this.sizing.scrollDirection(oldScrollPercent,this.scrollPercent),scrollPercent:100*this.scrollPercent})},rescroll:function(keepPosition){if(keepPosition){var overviewPosition=this.positionOrMax(this.overviewPosition(),this.maxOverviewPosition);this.scrollPercent=overviewPosition/this.maxOverviewPosition;var thumbPosition=this.scrollPercent*this.maxThumbPosition;this.setScrollPosition(overviewPosition,thumbPosition)}else{var thumbPosition=this.scrollPercent*this.maxThumbPosition,overviewPosition=this.scrollPercent*this.maxOverviewPosition;this.setScrollPosition(overviewPosition,thumbPosition)}},setScrollPosition:function(overviewPosition,thumbPosition){this.$thumb.css(this.sizing.offsetComponent(),thumbPosition+"px"),this.scrollable.$overview.css(this.sizing.offsetComponent(),-overviewPosition+"px")},setScrollPositionWithAnimation:function(overviewPosition,thumbPosition){var thumbAnimationOpts={},overviewAnimationOpts={};thumbAnimationOpts[this.sizing.offsetComponent()]=thumbPosition+"px",this.$thumb.animate(thumbAnimationOpts,this.scrollable.options.animationSpeed),overviewAnimationOpts[this.sizing.offsetComponent()]=-overviewPosition+"px",this.scrollable.$overview.animate(overviewAnimationOpts,this.scrollable.options.animationSpeed)},calculateMaxThumbPosition:function(){return Math.max(0,this.sizing.size(this.$scrollBar)-this.thumbSize)},calculateMaxOverviewPosition:function(){return Math.max(0,this.sizing.size(this.scrollable.$overview)-this.sizing.size(this.scrollable.$viewPort))},setScrollEvent:function(event){var attr="page"+this.sizing.scrollAxis();this.scrollEvent&&this.scrollEvent[attr]==event[attr]||(this.scrollEvent={pageX:event.pageX,pageY:event.pageY})},scrollToElement:function(element){var $element=$(element);if(this.sizing.isInside($element,this.scrollable.$overview)&&!this.sizing.isInside($element,this.scrollable.$viewPort)){var elementOffset=$element.offset(),overviewOffset=this.scrollable.$overview.offset();this.scrollable.$viewPort.offset();this.scrollOverviewTo(elementOffset[this.sizing.offsetComponent()]-overviewOffset[this.sizing.offsetComponent()],!0)}},remove:function(){this.removeMouseMoveScrolling(),this.removeMouseWheelScrolling(),this.removeTouchScrolling(),this.removeMouseClickScrolling(),this.removeWindowResize()},stopEventConditionally:function(event,condition){(condition||this.scrollable.options.preventDefaultScroll)&&(event.preventDefault(),event.stopPropagation())}};var HSizing=function(){};HSizing.prototype={size:function($el,arg){return arg?$el.width(arg):$el.width()},minSize:function($el){return parseInt($el.css("min-width"))||0},maxSize:function($el){return parseInt($el.css("max-width"))||0},fixedThumbSize:function(options){return options.fixedThumbWidth},scrollBar:function($el){return $el.find(".scroll-bar.horizontal")},mouseDelta:function(event1,event2){return event2.pageX-event1.pageX},offsetComponent:function(){return"left"},wheelDelta:function(deltaX,deltaY){return deltaX},scrollAxis:function(){return"X"},scrollDirection:function(oldPercent,newPercent){return newPercent>oldPercent?"right":"left"},scrollingKeys:{37:function(viewPortSize){return-10},39:function(viewPortSize){return 10}},isInside:function(element,wrappingElement){var $element=$(element),$wrappingElement=$(wrappingElement),elementOffset=$element.offset(),wrappingElementOffset=$wrappingElement.offset();return elementOffset.left>=wrappingElementOffset.left&&elementOffset.left+$element.width()<=wrappingElementOffset.left+$wrappingElement.width()}};var VSizing=function(){};return VSizing.prototype={size:function($el,arg){return arg?$el.height(arg):$el.height()},minSize:function($el){return parseInt($el.css("min-height"))||0},maxSize:function($el){return parseInt($el.css("max-height"))||0},fixedThumbSize:function(options){return options.fixedThumbHeight},scrollBar:function($el){return $el.find(".scroll-bar.vertical")},mouseDelta:function(event1,event2){return event2.pageY-event1.pageY},offsetComponent:function(){return"top"},wheelDelta:function(deltaX,deltaY){return deltaY},scrollAxis:function(){return"Y"},scrollDirection:function(oldPercent,newPercent){return newPercent>oldPercent?"down":"up"},scrollingKeys:{38:function(viewPortSize){return-10},40:function(viewPortSize){return 10},33:function(viewPortSize){return-(viewPortSize-20)},34:function(viewPortSize){return viewPortSize-20}},isInside:function(element,wrappingElement){var $element=$(element),$wrappingElement=$(wrappingElement),elementOffset=$element.offset(),wrappingElementOffset=$wrappingElement.offset();return elementOffset.top>=wrappingElementOffset.top&&elementOffset.top+$element.height()<=wrappingElementOffset.top+$wrappingElement.height()}},this.each(function(){if(void 0==options&&(options=defaultOptions),"string"==typeof options){var scrollable=$(this).data("scrollable");scrollable&&scrollable[options](args)}else{if("object"!=typeof options)throw"Invalid type of options";options=$.extend(defaultOptions,options),new Scrollable($(this),options)}})}}(jQuery),function($){function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,deltaX=0,deltaY=0;return event=$.event.fix(orgEvent),event.type="mousewheel",orgEvent.wheelDelta&&(delta=orgEvent.wheelDelta/120),orgEvent.detail&&(delta=-orgEvent.detail/3),deltaY=delta,void 0!==orgEvent.axis&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaY=0,deltaX=delta),void 0!==orgEvent.wheelDeltaY&&(deltaY=orgEvent.wheelDeltaY/120),void 0!==orgEvent.wheelDeltaX&&(deltaX=orgEvent.wheelDeltaX/120),args.unshift(event,delta,deltaX,deltaY),($.event.dispatch||$.event.handle).apply(this,args)}var types=["DOMMouseScroll","mousewheel"];if($.event.fixHooks)for(var i=types.length;i;)$.event.fixHooks[types[--i]]=$.event.mouseHooks;$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var i=types.length;i;)this.addEventListener(types[--i],handler,!1);else this.onmousewheel=handler},teardown:function(){if(this.removeEventListener)for(var i=types.length;i;)this.removeEventListener(types[--i],handler,!1);else this.onmousewheel=null}},$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}})}(jQuery),!function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,g="*",h=function(){},i=function(a,b){return a-b},j={n:{}},k=function(a,d){a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=k.listeners(a),j=0,l=[],m={},n=[],o=b;b=a,c=0;for(var p=0,q=h.length;q>p;p++)"zIndex"in h[p]&&(l.push(h[p].zIndex),h[p].zIndex<0&&(m[h[p].zIndex]=h[p]));for(l.sort(i);l[j]<0;)if(e=m[l[j++]],n.push(e.apply(d,g)),c)return c=f,n;for(p=0;q>p;p++)if(e=h[p],"zIndex"in e)if(e.zIndex==l[j]){if(n.push(e.apply(d,g)),c)break;do if(j++,e=m[l[j]],e&&n.push(e.apply(d,g)),c)break;while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,g)),c)break;return c=f,b=o,n.length?n:null};k._events=j,k.listeners=function(a){var b,c,d,e,h,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,h=m.length;h>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n[g]],d=2;d--;)b=c[d],b&&(l.push(b),p=p.concat(b.f||[]));o=l}return p},k.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(f),d=j,e=0,g=c.length;g>e;e++)d=d.n,d=d.hasOwnProperty(c[e])&&d[c[e]]||(d[c[e]]={n:{}});for(d.f=d.f||[],e=0,g=d.f.length;g>e;e++)if(d.f[e]==b)return h;return d.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.f=function(a){var b=[].slice.call(arguments,1);return function(){k.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},k.stop=function(){c=1},k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},k.nts=function(){return b.split(f)},k.off=k.unbind=function(a,b){if(!a)return void(k._events=j={n:{}});var c,d,h,i,l,m,n,o=a.split(f),p=[j];for(i=0,l=o.length;l>i;i++)for(m=0;m<p.length;m+=h.length-2){if(h=[m,1],c=p[m].n,o[i]!=g)c[o[i]]&&h.push(c[o[i]]);else for(d in c)c[e](d)&&h.push(c[d]);p.splice.apply(p,h)}for(i=0,l=p.length;l>i;i++)for(c=p[i];c.n;){if(b){if(c.f){for(m=0,n=c.f.length;n>m;m++)if(c.f[m]==b){c.f.splice(m,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[e](d)&&c.n[d].f){var q=c.n[d].f;for(m=0,n=q.length;n>m;m++)if(q[m]==b){q.splice(m,1);break}!q.length&&delete c.n[d].f}}else{delete c.f;for(d in c.n)c.n[e](d)&&c.n[d].f&&delete c.n[d].f}c=c.n}},k.once=function(a,b){var c=function(){return k.unbind(a,c),b.apply(this,arguments)};return k.on(a,c)},k.version=d,k.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=k:"undefined"!=typeof define?define("eve",[],function(){return k}):a.eve=k}(window||this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){function c(a){if(c.is(a,"function"))return u?a():b.on("raphael.DOMload",a);if(c.is(a,V))return c._engine.create[D](c,a.splice(0,3+c.is(a[0],T))).add(a);var d=Array.prototype.slice.call(arguments,0);if(c.is(d[d.length-1],"function")){var e=d.pop();return u?e.call(c._engine.create[D](c,d)):b.on("raphael.DOMload",function(){e.call(c._engine.create[D](c,d))})}return c._engine.create[D](c,arguments)}function d(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[z](c)&&(b[c]=d(a[c]));return b}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function f(a,b,c){function d(){var f=Array.prototype.slice.call(arguments,0),g=f.join(""),h=d.cache=d.cache||{},i=d.count=d.count||[];return h[z](g)?(e(i,g),c?c(h[g]):h[g]):(i.length>=1e3&&delete h[i.shift()],i.push(g),h[g]=a[D](b,f),c?c(h[g]):h[g])}return d}function g(){return this.hex}function h(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function i(a,b,c,d,e){var f=-3*b+9*c-9*d+3*e,g=a*f+6*b-12*c+6*d;return a*g-3*b+3*c}function j(a,b,c,d,e,f,g,h,j){null==j&&(j=1),j=j>1?1:0>j?0:j;for(var k=j/2,l=12,m=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;l>p;p++){var q=k*m[p]+k,r=i(q,a,c,e,g),s=i(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return k*o}function k(a,b,c,d,e,f,g,h,i){if(!(0>i||j(a,b,c,d,e,f,g,h)<i)){var k,l=1,m=l/2,n=l-m,o=.01;for(k=j(a,b,c,d,e,f,g,h,n);Q(k-i)>o;)m/=2,n+=(i>k?1:-1)*m,k=j(a,b,c,d,e,f,g,h,n);return n}}function l(a,b,c,d,e,f,g,h){if(!(O(a,c)<P(e,g)||P(a,c)>O(e,g)||O(b,d)<P(f,h)||P(b,d)>O(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+P(a,c).toFixed(2)||n>+O(a,c).toFixed(2)||n<+P(e,g).toFixed(2)||n>+O(e,g).toFixed(2)||o<+P(b,d).toFixed(2)||o>+O(b,d).toFixed(2)||o<+P(f,h).toFixed(2)||o>+O(f,h).toFixed(2)))return{x:l,y:m}}}}function m(a,b,d){var e=c.bezierBBox(a),f=c.bezierBBox(b);if(!c.isBBoxIntersect(e,f))return d?0:[];for(var g=j.apply(0,a),h=j.apply(0,b),i=O(~~(g/5),1),k=O(~~(h/5),1),m=[],n=[],o={},p=d?0:[],q=0;i+1>q;q++){var r=c.findDotsAtSegment.apply(c,a.concat(q/i));m.push({x:r.x,y:r.y,t:q/i})}for(q=0;k+1>q;q++)r=c.findDotsAtSegment.apply(c,b.concat(q/k)),n.push({x:r.x,y:r.y,t:q/k});for(q=0;i>q;q++)for(var s=0;k>s;s++){var t=m[q],u=m[q+1],v=n[s],w=n[s+1],x=Q(u.x-t.x)<.001?"y":"x",y=Q(w.x-v.x)<.001?"y":"x",z=l(t.x,t.y,u.x,u.y,v.x,v.y,w.x,w.y);if(z){if(o[z.x.toFixed(4)]==z.y.toFixed(4))continue;o[z.x.toFixed(4)]=z.y.toFixed(4);var A=t.t+Q((z[x]-t[x])/(u[x]-t[x]))*(u.t-t.t),B=v.t+Q((z[y]-v[y])/(w[y]-v[y]))*(w.t-v.t);A>=0&&1.001>=A&&B>=0&&1.001>=B&&(d?p++:p.push({x:z.x,y:z.y,t1:P(A,1),t2:P(B,1)}))}}return p}function n(a,b,d){a=c._path2curve(a),b=c._path2curve(b);for(var e,f,g,h,i,j,k,l,n,o,p=d?0:[],q=0,r=a.length;r>q;q++){var s=a[q];if("M"==s[0])e=i=s[1],f=j=s[2];else{"C"==s[0]?(n=[e,f].concat(s.slice(1)),e=n[6],f=n[7]):(n=[e,f,e,f,i,j,i,j],e=i,f=j);for(var t=0,u=b.length;u>t;t++){var v=b[t];if("M"==v[0])g=k=v[1],h=l=v[2];else{"C"==v[0]?(o=[g,h].concat(v.slice(1)),g=o[6],h=o[7]):(o=[g,h,g,h,k,l,k,l],g=k,h=l);var w=m(n,o,d);if(d)p+=w;else{for(var x=0,y=w.length;y>x;x++)w[x].segment1=q,w[x].segment2=t,w[x].bez1=n,w[x].bez2=o;p=p.concat(w)}}}}}return p}function o(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function p(){return this.x+H+this.y+H+this.width+"  "+this.height}function q(a,b,c,d,e,f){function g(a){return((l*a+k)*a+j)*a}function h(a,b){var c=i(a,b);return((o*c+n)*c+m)*c}function i(a,b){var c,d,e,f,h,i;for(e=a,i=0;8>i;i++){if(f=g(e)-a,Q(f)<b)return e;if(h=(3*l*e+2*k)*e+j,Q(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),Q(f-a)<b)return e;a>f?c=e:d=e,e=(d-c)/2+c}return e}var j=3*b,k=3*(d-b)-j,l=1-j-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return h(a,1/(200*f))}function r(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[z](e)&&(d[_(e)]=a[e],c.push(_(e)));c.sort(lb)}this.anim=d,this.top=c[c.length-1],this.percents=c}function s(a,d,e,f,g,h){e=_(e);var i,j,k,l,m,n,p=a.ms,r={},s={},t={};if(f)for(v=0,x=ic.length;x>v;v++){var u=ic[v];if(u.el.id==d.id&&u.anim==a){u.percent!=e?(ic.splice(v,1),k=1):j=u,d.attr(u.totalOrigin);break}}else f=+s;for(var v=0,x=a.percents.length;x>v;v++){if(a.percents[v]==e||a.percents[v]>f*a.top){e=a.percents[v],m=a.percents[v-1]||0,p=p/a.top*(e-m),l=a.percents[v+1],i=a.anim[e];break}f&&d.attr(a.anim[a.percents[v]])}if(i){if(j)j.initstatus=f,j.start=new Date-j.ms*f;else{for(var y in i)if(i[z](y)&&(db[z](y)||d.paper.customAttributes[z](y)))switch(r[y]=d.attr(y),null==r[y]&&(r[y]=cb[y]),s[y]=i[y],db[y]){case T:t[y]=(s[y]-r[y])/p;break;case"colour":r[y]=c.getRGB(r[y]);var A=c.getRGB(s[y]);t[y]={r:(A.r-r[y].r)/p,g:(A.g-r[y].g)/p,b:(A.b-r[y].b)/p};break;case"path":var B=Kb(r[y],s[y]),C=B[1];for(r[y]=B[0],t[y]=[],v=0,x=r[y].length;x>v;v++){t[y][v]=[0];for(var D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(C[v][D]-r[y][v][D])/p}break;case"transform":var G=d._,H=Pb(G[y],s[y]);if(H)for(r[y]=H.from,s[y]=H.to,t[y]=[],t[y].real=!0,v=0,x=r[y].length;x>v;v++)for(t[y][v]=[r[y][v][0]],D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(s[y][v][D]-r[y][v][D])/p;else{var K=d.matrix||new o,L={_:{transform:G.transform},getBBox:function(){return d.getBBox(1)}};r[y]=[K.a,K.b,K.c,K.d,K.e,K.f],Nb(L,s[y]),s[y]=L._.transform,t[y]=[(L.matrix.a-K.a)/p,(L.matrix.b-K.b)/p,(L.matrix.c-K.c)/p,(L.matrix.d-K.d)/p,(L.matrix.e-K.e)/p,(L.matrix.f-K.f)/p]}break;case"csv":var M=I(i[y])[J](w),N=I(r[y])[J](w);if("clip-rect"==y)for(r[y]=N,t[y]=[],v=N.length;v--;)t[y][v]=(M[v]-r[y][v])/p;s[y]=M;break;default:for(M=[][E](i[y]),N=[][E](r[y]),t[y]=[],v=d.paper.customAttributes[y].length;v--;)t[y][v]=((M[v]||0)-(N[v]||0))/p}var O=i.easing,P=c.easing_formulas[O];if(!P)if(P=I(O).match(Z),P&&5==P.length){var Q=P;P=function(a){return q(a,+Q[1],+Q[2],+Q[3],+Q[4],p)}}else P=nb;if(n=i.start||a.start||+new Date,u={anim:a,percent:e,timestamp:n,start:n+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:p,easing:P,from:r,diff:t,to:s,el:d,callback:i.callback,prev:m,next:l,repeat:h||a.times,origin:d.attr(),totalOrigin:g},ic.push(u),f&&!j&&!k&&(u.stop=!0,u.start=new Date-p*f,1==ic.length))return kc();k&&(u.start=new Date-u.ms*f),1==ic.length&&jc(kc)}b("raphael.anim.start."+d.id,d,a)}}function t(a){for(var b=0;b<ic.length;b++)ic[b].el.paper==a&&ic.splice(b--,1)}c.version="2.1.2",c.eve=b;var u,v,w=/[, ]+/,x={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},y=/\{(\d+)\}/g,z="hasOwnProperty",A={doc:document,win:a},B={was:Object.prototype[z].call(A.win,"Raphael"),is:A.win.Raphael},C=function(){this.ca=this.customAttributes={}},D="apply",E="concat",F="ontouchstart"in A.win||A.win.DocumentTouch&&A.doc instanceof DocumentTouch,G="",H=" ",I=String,J="split",K="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](H),L={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M=I.prototype.toLowerCase,N=Math,O=N.max,P=N.min,Q=N.abs,R=N.pow,S=N.PI,T="number",U="string",V="array",W=Object.prototype.toString,X=(c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},Z=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=N.round,_=parseFloat,ab=parseInt,bb=I.prototype.toUpperCase,cb=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},db=c._availableAnimAttrs={blur:T,"clip-rect":"csv",cx:T,cy:T,fill:"colour","fill-opacity":T,"font-size":T,height:T,opacity:T,path:"path",r:T,rx:T,ry:T,stroke:"colour","stroke-opacity":T,"stroke-width":T,transform:"transform",width:T,x:T,y:T},eb=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,fb={hs:1,rg:1},gb=/,?([achlmqrstvxz]),?/gi,hb=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ib=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,jb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,kb=(c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),lb=function(a,b){return _(a)-_(b)},mb=function(){},nb=function(a){return a},ob=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},pb=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},qb=c._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();
return ob(b.x,b.y,b.width,b.height)},set:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)}},rb=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Kb(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=A,c.type=A.win.SVGAngle||A.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){var sb,tb=A.doc.createElement("div");if(tb.innerHTML='<v:shape adj="1"/>',sb=tb.firstChild,sb.style.behavior="url(#default#VML)",!sb||"object"!=typeof sb.adj)return c.type=G;tb=null}c.svg=!(c.vml="VML"==c.type),c._Paper=C,c.fn=v=C.prototype=c.prototype,c._id=0,c._oid=0,c.is=function(a,b){return b=M.call(b),"finite"==b?!Y[z](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||W.call(a).slice(8,-1).toLowerCase()==b},c.angle=function(a,b,d,e,f,g){if(null==f){var h=a-d,i=b-e;return h||i?(180+180*N.atan2(-i,-h)/S+360)%360:0}return c.angle(a,b,f,g)-c.angle(d,e,f,g)},c.rad=function(a){return a%360*S/180},c.deg=function(a){return 180*a/S%360},c.snapTo=function(a,b,d){if(d=c.is(d,"finite")?d:10,c.is(a,V)){for(var e=a.length;e--;)if(Q(a[e]-b)<=d)return a[e]}else{a=+a;var f=b%a;if(d>f)return b-f;if(f>a-d)return b-f+a}return b},c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*N.random()|0,c="x"==a?b:3&b|8;return c.toString(16)}),c.setWindow=function(a){b("raphael.setWindow",c,A.win,a),A.win=a,A.doc=A.win.document,c._engine.initWin&&c._engine.initWin(A.win)};var ub=function(a){if(c.vml){var b,d=/^\s+|\s+$/g;try{var e=new ActiveXObject("htmlfile");e.write("<body>"),e.close(),b=e.body}catch(g){b=createPopup().document.body}var h=b.createTextRange();ub=f(function(a){try{b.style.color=I(a).replace(d,G);var c=h.queryCommandValue("ForeColor");return c=(255&c)<<16|65280&c|(16711680&c)>>>16,"#"+("000000"+c.toString(16)).slice(-6)}catch(e){return"none"}})}else{var i=A.doc.createElement("i");i.title="Raphal Colour Picker",i.style.display="none",A.doc.body.appendChild(i),ub=f(function(a){return i.style.color=a,A.doc.defaultView.getComputedStyle(i,G).getPropertyValue("color")})}return ub(a)},vb=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},xb=function(){return this.hex},yb=function(a,b,d){if(null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,U)){var e=c.getRGB(a);a=e.r,b=e.g,d=e.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},zb=function(a,b,d,e){a*=255,b*=255,d*=255;var f={r:a,g:b,b:d,hex:c.rgb(a,b,d),toString:xb};return c.is(e,"finite")&&(f.opacity=e),f};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=xb,a},c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Q(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var e,f,g,h,i;return a=a%360/60,i=2*b*(.5>c?c:1-c),h=i*(1-Q(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.rgb2hsb=function(a,b,c){c=yb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=O(a,b,c),g=f-P(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6*60/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:vb}},c.rgb2hsl=function(a,b,c){c=yb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=O(a,b,c),h=P(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6*60/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:wb}},c._path2string=function(){return this.join(",").replace(gb,"$1")},c._preload=function(a,b){var c=A.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,A.doc.body.removeChild(this)},c.onerror=function(){A.doc.body.removeChild(this)},A.doc.body.appendChild(c),c.src=a},c.getRGB=f(function(a){if(!a||(a=I(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!(fb[z](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=ub(a));var b,d,e,f,h,i,j=a.match(X);return j?(j[2]&&(e=ab(j[2].substring(5),16),d=ab(j[2].substring(3,5),16),b=ab(j[2].substring(1,3),16)),j[3]&&(e=ab((h=j[3].charAt(3))+h,16),d=ab((h=j[3].charAt(2))+h,16),b=ab((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100)),j[5]?(i=j[5][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||""==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsb2rgb(b,d,e,f)):j[6]?(i=j[6][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||""==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsl2rgb(b,d,e,f)):(j={r:b,g:d,b:e,toString:g},j.hex="#"+(16777216|e|d<<8|b<<16).toString(16).slice(1),c.is(f,"finite")&&(j.opacity=f),j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},c),c.hsb=f(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=f(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=f(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),c.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex},c.getColor.reset=function(){delete this.start},c.parsePathString=function(a){if(!a)return null;var b=Ab(a);if(b.arr)return Cb(b.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];return c.is(a,V)&&c.is(a[0],V)&&(e=Cb(a)),e.length||I(a).replace(hb,function(a,b,c){var f=[],g=b.toLowerCase();if(c.replace(jb,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b][E](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)e.push([b][E](f));else for(;f.length>=d[g]&&(e.push([b][E](f.splice(0,d[g]))),d[g]););}),e.toString=c._path2string,b.arr=Cb(e),e},c.parseTransformString=f(function(a){if(!a)return null;var b=[];return c.is(a,V)&&c.is(a[0],V)&&(b=Cb(a)),b.length||I(a).replace(ib,function(a,c,d){var e=[];M.call(c),d.replace(jb,function(a,b){b&&e.push(+b)}),b.push([c][E](e))}),b.toString=c._path2string,b});var Ab=function(a){var b=Ab.ps=Ab.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[z](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/S;return(q>s||t>r)&&(y+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}},c.bezierBBox=function(a,b,d,e,f,g,h,i){c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]);var j=Jb.apply(null,a);return{x:j.min.x,y:j.min.y,x2:j.max.x,y2:j.max.y,width:j.max.x-j.min.x,height:j.max.y-j.min.y}},c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},c.pathIntersection=function(a,b){return n(a,b)},c.pathIntersectionNumber=function(a,b){return n(a,b,1)},c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&n(a,[["M",b,d],["H",e.x2+10]],1)%2==1},c._removedFactory=function(a){return function(){b("raphael.log",null,"Raphal: you are calling to method "+a+" of removed object",a)}};var Bb=c.pathBBox=function(a){var b=Ab(a);if(b.bbox)return d(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Kb(a);for(var c,e=0,f=0,g=[],h=[],i=0,j=a.length;j>i;i++)if(c=a[i],"M"==c[0])e=c[1],f=c[2],g.push(e),h.push(f);else{var k=Jb(e,f,c[1],c[2],c[3],c[4],c[5],c[6]);g=g[E](k.min.x,k.max.x),h=h[E](k.min.y,k.max.y),e=c[5],f=c[6]}var l=P[D](0,g),m=P[D](0,h),n=O[D](0,g),o=O[D](0,h),p=n-l,q=o-m,r={x:l,y:m,x2:n,y2:o,width:p,height:q,cx:l+p/2,cy:m+q/2};return b.bbox=d(r),r},Cb=function(a){var b=d(a);return b.toString=c._path2string,b},Db=c._pathToRelative=function(a){var b=Ab(a);if(b.rel)return Cb(b.rel);c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f]));for(var j=i,k=a.length;k>j;j++){var l=d[j]=[],m=a[j];if(m[0]!=M.call(m[0]))switch(l[0]=M.call(m[0]),l[0]){case"a":l[1]=m[1],l[2]=m[2],l[3]=m[3],l[4]=m[4],l[5]=m[5],l[6]=+(m[6]-e).toFixed(3),l[7]=+(m[7]-f).toFixed(3);break;case"v":l[1]=+(m[1]-f).toFixed(3);break;case"m":g=m[1],h=m[2];default:for(var n=1,o=m.length;o>n;n++)l[n]=+(m[n]-(n%2?e:f)).toFixed(3)}else{l=d[j]=[],"m"==m[0]&&(g=m[1]+e,h=m[2]+f);for(var p=0,q=m.length;q>p;p++)d[j][p]=m[p]}var r=d[j].length;switch(d[j][0]){case"z":e=g,f=h;break;case"h":e+=+d[j][r-1];break;case"v":f+=+d[j][r-1];break;default:e+=+d[j][r-2],f+=+d[j][r-1]}}return d.toString=c._path2string,b.rel=Cb(d),d},Eb=c._pathToAbsolute=function(a){var b=Ab(a);if(b.abs)return Cb(b.abs);if(c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,g=0,i=0,j=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],g=e,i=f,j++,d[0]=["M",e,f]);for(var k,l,m=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),n=j,o=a.length;o>n;n++){if(d.push(k=[]),l=a[n],l[0]!=bb.call(l[0]))switch(k[0]=bb.call(l[0]),k[0]){case"A":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]+e),k[7]=+(l[7]+f);break;case"V":k[1]=+l[1]+f;break;case"H":k[1]=+l[1]+e;break;case"R":for(var p=[e,f][E](l.slice(1)),q=2,r=p.length;r>q;q++)p[q]=+p[q]+e,p[++q]=+p[q]+f;d.pop(),d=d[E](h(p,m));break;case"M":g=+l[1]+e,i=+l[2]+f;default:for(q=1,r=l.length;r>q;q++)k[q]=+l[q]+(q%2?e:f)}else if("R"==l[0])p=[e,f][E](l.slice(1)),d.pop(),d=d[E](h(p,m)),k=["R"][E](l.slice(-2));else for(var s=0,t=l.length;t>s;s++)k[s]=l[s];switch(k[0]){case"Z":e=g,f=i;break;case"H":e=k[1];break;case"V":f=k[1];break;case"M":g=k[k.length-2],i=k[k.length-1];default:e=k[k.length-2],f=k[k.length-1]}}return d.toString=c._path2string,b.abs=Cb(d),d},Fb=function(a,b,c,d){return[a,b,c,d,c,d]},Gb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Hb=function(a,b,c,d,e,g,h,i,j,k){var l,m=120*S/180,n=S/180*(+e||0),o=[],p=f(function(a,b,c){var d=a*N.cos(c)-b*N.sin(c),e=a*N.sin(c)+b*N.cos(c);return{x:d,y:e}});if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{l=p(a,b,-n),a=l.x,b=l.y,l=p(i,j,-n),i=l.x,j=l.y;var q=(N.cos(S/180*e),N.sin(S/180*e),(a-i)/2),r=(b-j)/2,s=q*q/(c*c)+r*r/(d*d);s>1&&(s=N.sqrt(s),c=s*c,d=s*d);var t=c*c,u=d*d,v=(g==h?-1:1)*N.sqrt(Q((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*c*r/d+(a+i)/2,x=v*-d*q/c+(b+j)/2,y=N.asin(((b-x)/d).toFixed(9)),z=N.asin(((j-x)/d).toFixed(9));y=w>a?S-y:y,z=w>i?S-z:z,0>y&&(y=2*S+y),0>z&&(z=2*S+z),h&&y>z&&(y-=2*S),!h&&z>y&&(z-=2*S)}var A=z-y;if(Q(A)>m){var B=z,C=i,D=j;z=y+m*(h&&z>y?1:-1),i=w+c*N.cos(z),j=x+d*N.sin(z),o=Hb(i,j,c,d,e,0,h,C,D,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),K=N.tan(A/4),L=4/3*c*K,M=4/3*d*K,O=[a,b],P=[a+L*G,b-M*F],R=[i+L*I,j-M*H],T=[i,j];if(P[0]=2*O[0]-P[0],P[1]=2*O[1]-P[1],k)return[P,R,T][E](o);o=[P,R,T][E](o).join()[J](",");for(var U=[],V=0,W=o.length;W>V;V++)U[V]=V%2?p(o[V-1],o[V],n).y:p(o[V],o[V+1],n).x;return U},Ib=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:R(j,3)*a+3*R(j,2)*i*c+3*j*i*i*e+R(i,3)*g,y:R(j,3)*b+3*R(j,2)*i*d+3*j*i*i*f+R(i,3)*h}},Jb=f(function(a,b,c,d,e,f,g,h){var i,j=e-2*c+a-(g-2*e+c),k=2*(c-a)-2*(e-c),l=a-c,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,o=[b,h],p=[a,g];return Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),j=f-2*d+b-(h-2*f+d),k=2*(d-b)-2*(f-d),l=b-d,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),{min:{x:P[D](0,p),y:P[D](0,o)},max:{x:O[D](0,p),y:O[D](0,o)}}}),Kb=c._path2curve=f(function(a,b){var c=!b&&Ab(a);if(!b&&c.curve)return Cb(c.curve);for(var d=Eb(a),e=b&&Eb(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(a,b,c){var d,e,f={T:1,Q:1};if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in f)&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][E](Hb[D](0,[b.x,b.y][E](a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e][E](a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"][E](Gb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][E](Gb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][E](Fb(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][E](Fb(b.x,b.y,a[1],b.y));break;case"V":a=["C"][E](Fb(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][E](Fb(b.x,b.y,b.X,b.Y))}return a}),i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][E](c.splice(0,6)));a.splice(b,1),l=O(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=O(d.length,e&&e.length||0))},k=0,l=O(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2],f.y=m[o-1],f.bx=_(m[o-4])||f.x,f.by=_(m[o-3])||f.y,g.bx=e&&(_(n[p-4])||g.x),g.by=e&&(_(n[p-3])||g.y),g.x=e&&n[p-2],g.y=e&&n[p-1]}return e||(c.curve=Cb(d)),e?[d,e]:d},null,Cb),Lb=(c._parseDots=f(function(a){for(var b=[],d=0,e=a.length;e>d;d++){var f={},g=a[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex,g[2]&&(f.offset=g[2]+"%"),b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(var h=_(b[d-1].offset||0),i=0,j=d+1;e>j;j++)if(b[j].offset){i=b[j].offset;break}i||(i=100,j=e),i=_(i);for(var k=(i-h)/(j-d+1);j>d;d++)h+=k,b[d].offset=h+"%"}return b}),c._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)}),Mb=(c._tofront=function(a,b){b.top!==a&&(Lb(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Lb(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Lb(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},c._insertbefore=function(a,b,c){Lb(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b},c.toMatrix=function(a,b){var c=Bb(a),d={_:{transform:G},getBBox:function(){return c}};return Nb(d,b),d.matrix}),Nb=(c.transformPath=function(a,b){return rb(a,Mb(a,b))},c._extractTransform=function(a,b){if(null==b)return a._.transform;b=I(b).replace(/\.{3}|\u2026/g,a._.transform||G);var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,k=new o;if(j.transform=d||[],d)for(var l=0,m=d.length;m>l;l++){var n,p,q,r,s,t=d[l],u=t.length,v=I(t[0]).toLowerCase(),w=t[0]!=v,x=w?k.invert():0;"t"==v&&3==u?w?(n=x.x(0,0),p=x.y(0,0),q=x.x(t[1],t[2]),r=x.y(t[1],t[2]),k.translate(q-n,r-p)):k.translate(t[1],t[2]):"r"==v?2==u?(s=s||a.getBBox(1),k.rotate(t[1],s.x+s.width/2,s.y+s.height/2),e+=t[1]):4==u&&(w?(q=x.x(t[2],t[3]),r=x.y(t[2],t[3]),k.rotate(t[1],q,r)):k.rotate(t[1],t[2],t[3]),e+=t[1]):"s"==v?2==u||3==u?(s=s||a.getBBox(1),k.scale(t[1],t[u-1],s.x+s.width/2,s.y+s.height/2),h*=t[1],i*=t[u-1]):5==u&&(w?(q=x.x(t[3],t[4]),r=x.y(t[3],t[4]),k.scale(t[1],t[2],q,r)):k.scale(t[1],t[2],t[3],t[4]),h*=t[1],i*=t[2]):"m"==v&&7==u&&k.add(t[1],t[2],t[3],t[4],t[5],t[6]),j.dirtyT=1,a.matrix=k}a.matrix=k,j.sx=h,j.sy=i,j.deg=e,j.dx=f=k.e,j.dy=g=k.f,1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1}),Ob=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Pb=c._equaliseTransform=function(a,b){b=I(b).replace(/\.{3}|\u2026/g,a),a=c.parseTransformString(a)||[],b=c.parseTransformString(b)||[];for(var d,e,f,g,h=O(a.length,b.length),i=[],j=[],k=0;h>k;k++){if(f=a[k]||Ob(b[k]),g=b[k]||Ob(f),f[0]!=g[0]||"r"==f[0].toLowerCase()&&(f[2]!=g[2]||f[3]!=g[3])||"s"==f[0].toLowerCase()&&(f[3]!=g[3]||f[4]!=g[4]))return;for(i[k]=[],j[k]=[],d=0,e=O(f.length,g.length);e>d;d++)d in f&&(i[k][d]=f[d]),d in g&&(j[k][d]=g[d])}return{from:i,to:j}};c._getContainer=function(a,b,d,e){var f;return f=null!=e||c.is(a,"object")?a:A.doc.getElementById(a),null!=f?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0},c.pathToRelative=Db,c._engine={},c.path2curve=Kb,c.matrix=function(a,b,c,d,e,f){return new o(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=N.sqrt(b(a));a[0]&&(a[0]/=c),a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var g,h,i,j,k=[[],[],[]],l=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],m=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof o&&(m=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),g=0;3>g;g++)for(h=0;3>h;h++){for(j=0,i=0;3>i;i++)j+=l[g][i]*m[i][h];k[g][h]=j}this.a=k[0][0],this.b=k[1][0],this.c=k[0][1],this.d=k[1][1],this.e=k[0][2],this.f=k[1][2]},a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new o(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)},a.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,d){a=c.rad(a),b=b||0,d=d||0;var e=+N.cos(a).toFixed(9),f=+N.sin(a).toFixed(9);this.add(e,f,-f,e,b,d),this.add(1,0,0,1,-b,-d)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[I.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];a.scalex=N.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=N.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley;var f=-e[0][1],g=e[1][1];return 0>g?(a.rotate=c.deg(N.acos(g)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(N.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){var b=a||this[J]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:G)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:G)+(b.rotate?"r"+[b.rotate,0,0]:G)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(o.prototype);var Qb=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);v.safari="Apple Computer, Inc."==navigator.vendor&&(Qb&&Qb[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Qb&&Qb[1]<8?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:mb;for(var Rb=function(){this.returnValue=!1},Sb=function(){return this.originalEvent.preventDefault()},Tb=function(){this.cancelBubble=!0},Ub=function(){return this.originalEvent.stopPropagation()},Vb=function(a){var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,c=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;return{x:a.clientX+c,y:a.clientY+b}},Wb=function(){return A.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=Vb(a);return c.call(d,a,b.x,b.y)};if(a.addEventListener(b,e,!1),F&&L[b]){var f=function(b){for(var e=Vb(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){b=b.targetTouches[g],b.originalEvent=f,b.preventDefault=Sb,b.stopPropagation=Ub;break}return c.call(d,b,e.x,e.y)};a.addEventListener(L[b],f,!1)}return function(){return a.removeEventListener(b,e,!1),F&&L[b]&&a.removeEventListener(L[b],e,!1),!0}}:A.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||A.win.event;var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,e=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||Rb,a.stopPropagation=a.stopPropagation||Tb,c.call(d,a,f,g)};a.attachEvent("on"+b,e);var f=function(){return a.detachEvent("on"+b,e),!0};return f}:void 0}(),Xb=[],Yb=function(a){for(var c,d=a.clientX,e=a.clientY,f=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,g=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,h=Xb.length;h--;){if(c=Xb[h],F&&a.touches){for(var i,j=a.touches.length;j--;)if(i=a.touches[j],i.identifier==c.el._drag.id){d=i.clientX,e=i.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var k,l=c.el.node,m=l.nextSibling,n=l.parentNode,o=l.style.display;A.win.opera&&n.removeChild(l),l.style.display="none",k=c.el.paper.getElementByPoint(d,e),l.style.display=o,A.win.opera&&(m?n.insertBefore(l,m):n.appendChild(l)),k&&b("raphael.drag.over."+c.el.id,c.el,k),d+=g,e+=f,b("raphael.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},Zb=function(a){c.unmousemove(Yb).unmouseup(Zb);for(var d,e=Xb.length;e--;)d=Xb[e],d.el._drag={},b("raphael.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,a);Xb=[]},$b=c.el={},_b=K.length;_b--;)!function(a){c[a]=$b[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Wb(this.shape||this.node||A.doc,a,b,d||this)})),this},c["un"+a]=$b["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name!=a||!c.is(b,"undefined")&&d[e].f!=b||(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(K[_b]);$b.data=function(a,d){var e=kb[this.id]=kb[this.id]||{};if(0==arguments.length)return e;if(1==arguments.length){if(c.is(a,"object")){for(var f in a)a[z](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this},$b.removeData=function(a){return null==a?kb[this.id]={}:kb[this.id]&&delete kb[this.id][a],this},$b.getData=function(){return d(kb[this.id]||{})},$b.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},$b.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var ac=[];$b.drag=function(a,d,e,f,g,h){function i(i){(i.originalEvent||i).preventDefault();var j=i.clientX,k=i.clientY,l=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,m=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;if(this._drag.id=i.identifier,F&&i.touches)for(var n,o=i.touches.length;o--;)if(n=i.touches[o],this._drag.id=n.identifier,n.identifier==this._drag.id){j=n.clientX,k=n.clientY;break}this._drag.x=j+m,this._drag.y=k+l,!Xb.length&&c.mousemove(Yb).mouseup(Zb),Xb.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("raphael.drag.start."+this.id,d),a&&b.on("raphael.drag.move."+this.id,a),e&&b.on("raphael.drag.end."+this.id,e),b("raphael.drag.start."+this.id,g||f||this,i.clientX+m,i.clientY+l,i)}return this._drag={},ac.push({el:this,start:i}),this.mousedown(i),this},$b.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)},$b.undrag=function(){for(var a=ac.length;a--;)ac[a].el==this&&(this.unmousedown(ac[a].start),ac.splice(a,1),b.unbind("raphael.drag.*."+this.id));!ac.length&&c.unmousemove(Yb).unmouseup(Zb),Xb=[]},v.circle=function(a,b,d){var e=c._engine.circle(this,a||0,b||0,d||0);return this.__set__&&this.__set__.push(e),e},v.rect=function(a,b,d,e,f){var g=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.ellipse=function(a,b,d,e){var f=c._engine.ellipse(this,a||0,b||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},v.path=function(a){a&&!c.is(a,U)&&!c.is(a[0],V)&&(a+=G);var b=c._engine.path(c.format[D](c,arguments),this);return this.__set__&&this.__set__.push(b),b},v.image=function(a,b,d,e,f){var g=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.text=function(a,b,d){var e=c._engine.text(this,a||0,b||0,I(d));return this.__set__&&this.__set__.push(e),e},v.set=function(a){!c.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new mc(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b},v.setStart=function(a){this.__set__=a||this.set()},v.setFinish=function(){var a=this.__set__;return delete this.__set__,a},v.setSize=function(a,b){return c._engine.setSize.call(this,a,b)},v.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)},v.top=v.bottom=null,v.raphael=c;var bc=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=b.top+(A.win.pageYOffset||e.scrollTop||d.scrollTop)-f,i=b.left+(A.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g;return{y:h,x:i}};v.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=A.doc.elementFromPoint(a,b);if(A.win.opera&&"svg"==e.tagName){var f=bc(d),g=d.createSVGRect();g.x=a-f.x,g.y=b-f.y,g.width=g.height=1;var h=d.getIntersectionList(g,null);h.length&&(e=h[h.length-1])}if(!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null},v.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b},v.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},v.forEach=function(a,b){for(var c=this.bottom;c;){if(a.call(b,c)===!1)return this;c=c.next}return this},v.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},$b.isPointInside=function(a,b){var d=this.realPath=qb[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=c.transformPath(d,this.attr("transform"))),c.isPointInsidePath(d,a,b)},$b.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=qb[this.type](this),b.bboxwt=Bb(this.realPath),b.bboxwt.toString=p,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=qb[this.type](this)),b.bbox=Bb(rb(this.realPath,this.matrix)),b.bbox.toString=p,b.dirty=b.dirtyT=0),b.bbox)},$b.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},$b.glow=function(a){if("text"==this.type)return null;a=a||{};var b={width:(a.width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||qb[this.type](this);f=this.matrix?rb(f,this.matrix):f;for(var g=1;c+1>g;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var cc=function(a,b,d,e,f,g,h,i,l){return null==l?j(a,b,d,e,f,g,h,i):c.findDotsAtSegment(a,b,d,e,f,g,h,i,k(a,b,d,e,f,g,h,i,l))},dc=function(a,b){return function(d,e,f){d=Kb(d);for(var g,h,i,j,k,l="",m={},n=0,o=0,p=d.length;p>o;o++){if(i=d[o],"M"==i[0])g=+i[1],h=+i[2];else{if(j=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),n+j>e){if(b&&!m.start){if(k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),l+=["C"+k.start.x,k.start.y,k.m.x,k.m.y,k.x,k.y],f)return l;m.start=l,l=["M"+k.x,k.y+"C"+k.n.x,k.n.y,k.end.x,k.end.y,i[5],i[6]].join(),n+=j,g=+i[5],h=+i[6];continue}if(!a&&!b)return k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),{x:k.x,y:k.y,alpha:k.alpha}}n+=j,g=+i[5],h=+i[6]}l+=i.shift()+i}return m.end=l,k=a?n:b?m:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1),k.alpha&&(k={x:k.x,y:k.y,alpha:k.alpha}),k}},ec=dc(1),fc=dc(),gc=dc(0,1);c.getTotalLength=ec,c.getPointAtLength=fc,c.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return gc(a,b).end;var d=gc(a,c,1);return b?gc(d,b).end:d},$b.getTotalLength=function(){var a=this.getPath();return a?this.node.getTotalLength?this.node.getTotalLength():ec(a):void 0},$b.getPointAtLength=function(a){var b=this.getPath();return b?fc(b,a):void 0},$b.getPath=function(){var a,b=c._getPath[this.type];return"text"!=this.type&&"set"!=this.type?(b&&(a=b(this)),a):void 0},$b.getSubpath=function(a,b){var d=this.getPath();return d?c.getSubpath(d,a,b):void 0};var hc=c.easing_formulas={linear:function(a){return a},"<":function(a){return R(a,1.7)},">":function(a){return R(a,.48)},"<>":function(a){var b=.48-a/1.04,c=N.sqrt(.1734+b*b),d=c-b,e=R(Q(d),1/3)*(0>d?-1:1),f=-c-b,g=R(Q(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:R(2,-10*a)*N.sin(2*(a-.075)*S/.3)+1},bounce:function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b}};hc.easeIn=hc["ease-in"]=hc["<"],hc.easeOut=hc["ease-out"]=hc[">"],hc.easeInOut=hc["ease-in-out"]=hc["<>"],hc["back-in"]=hc.backIn,hc["back-out"]=hc.backOut;var ic=[],jc=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},kc=function(){for(var a=+new Date,d=0;d<ic.length;d++){var e=ic[d];if(!e.el.removed&&!e.paused){var f,g,h=a-e.start,i=e.ms,j=e.easing,k=e.from,l=e.diff,m=e.to,n=(e.t,e.el),o={},p={};if(e.initstatus?(h=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*i,
e.status=e.initstatus,delete e.initstatus,e.stop&&ic.splice(d--,1)):e.status=(e.prev+(e.percent-e.prev)*(h/i))/e.anim.top,!(0>h))if(i>h){var q=j(h/i);for(var r in k)if(k[z](r)){switch(db[r]){case T:f=+k[r]+q*i*l[r];break;case"colour":f="rgb("+[lc($(k[r].r+q*i*l[r].r)),lc($(k[r].g+q*i*l[r].g)),lc($(k[r].b+q*i*l[r].b))].join(",")+")";break;case"path":f=[];for(var t=0,u=k[r].length;u>t;t++){f[t]=[k[r][t][0]];for(var v=1,w=k[r][t].length;w>v;v++)f[t][v]=+k[r][t][v]+q*i*l[r][t][v];f[t]=f[t].join(H)}f=f.join(H);break;case"transform":if(l[r].real)for(f=[],t=0,u=k[r].length;u>t;t++)for(f[t]=[k[r][t][0]],v=1,w=k[r][t].length;w>v;v++)f[t][v]=k[r][t][v]+q*i*l[r][t][v];else{var x=function(a){return+k[r][a]+q*i*l[r][a]};f=[["m",x(0),x(1),x(2),x(3),x(4),x(5)]]}break;case"csv":if("clip-rect"==r)for(f=[],t=4;t--;)f[t]=+k[r][t]+q*i*l[r][t];break;default:var y=[][E](k[r]);for(f=[],t=n.paper.customAttributes[r].length;t--;)f[t]=+y[t]+q*i*l[r][t]}o[r]=f}n.attr(o),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e),b("raphael.anim.finish."+d.id,d,e),c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(m),ic.splice(d--,1),e.repeat>1&&!e.next){for(g in m)m[z](g)&&(p[g]=e.totalOrigin[g]);e.el.attr(p),s(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&s(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}c.svg&&n&&n.paper&&n.paper.safari(),ic.length&&jc(kc)},lc=function(a){return a>255?255:0>a?0:a};$b.animateWith=function(a,b,d,e,f,g){var h=this;if(h.removed)return g&&g.call(h),h;var i=d instanceof r?d:c.animation(d,e,f,g);s(i,h,i.percents[0],null,h.attr());for(var j=0,k=ic.length;k>j;j++)if(ic[j].anim==b&&ic[j].el==a){ic[k-1].start=ic[j].start;break}return h},$b.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this},r.prototype.delay=function(a){var b=new r(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},r.prototype.repeat=function(a){var b=new r(this.anim,this.ms);return b.del=this.del,b.times=N.floor(O(a,0))||1,b},c.animation=function(a,b,d,e){if(a instanceof r)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null),a=Object(a),b=+b||0;var f,g,h={};for(g in a)a[z](g)&&_(g)!=g&&_(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new r({100:h},b)):new r(a,b)},$b.animate=function(a,b,d,e){var f=this;if(f.removed)return e&&e.call(f),f;var g=a instanceof r?a:c.animation(a,b,d,e);return s(g,f,g.percents[0],null,f.attr()),f},$b.setTime=function(a,b){return a&&null!=b&&this.status(a,P(b,a.ms)/a.ms),this},$b.status=function(a,b){var c,d,e=[],f=0;if(null!=b)return s(a,this,-1,P(b,1)),this;for(c=ic.length;c>f;f++)if(d=ic[f],d.el.id==this.id&&(!a||d.anim==a)){if(a)return d.status;e.push({anim:d.anim,status:d.status})}return a?0:e},$b.pause=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||b("raphael.anim.pause."+this.id,this,ic[c].anim)!==!1&&(ic[c].paused=!0);return this},$b.resume=function(a){for(var c=0;c<ic.length;c++)if(ic[c].el.id==this.id&&(!a||ic[c].anim==a)){var d=ic[c];b("raphael.anim.resume."+this.id,this,d.anim)!==!1&&(delete d.paused,this.status(d.anim,d.status))}return this},$b.stop=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||b("raphael.anim.stop."+this.id,this,ic[c].anim)!==!1&&ic.splice(c--,1);return this},b.on("raphael.remove",t),b.on("raphael.clear",t),$b.toString=function(){return"Raphals object"};var mc=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)!a[b]||a[b].constructor!=$b.constructor&&a[b].constructor!=mc||(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},nc=mc.prototype;nc.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)a=arguments[c],!a||a.constructor!=$b.constructor&&a.constructor!=mc||(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},nc.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},nc.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(a.call(b,this.items[c],c)===!1)return this;return this};for(var oc in $b)$b[z](oc)&&(nc[oc]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][D](c,b)})}}(oc));return nc.attr=function(a,b){if(a&&c.is(a,V)&&c.is(a[0],"object"))for(var d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(var f=0,g=this.items.length;g>f;f++)this.items[f].attr(a,b);return this},nc.clear=function(){for(;this.length;)this.pop()},nc.splice=function(a,b){a=0>a?O(this.length+a,0):a,b=O(0,P(this.length-a,b));var c,d=[],e=[],f=[];for(c=2;c<arguments.length;c++)f.push(arguments[c]);for(c=0;b>c;c++)e.push(this[a+c]);for(;c<this.length-a;c++)d.push(this[a+c]);var g=f.length;for(c=0;c<g+d.length;c++)this.items[a+c]=this[a+c]=g>c?f[c]:d[c-g];for(c=this.items.length=this.length-=b-g;this[c];)delete this[c++];return new mc(e)},nc.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},nc.animate=function(a,b,d,e){(c.is(d,"function")||!d)&&(e=d||null);var f,g,h=this.items.length,i=h,j=this;if(!h)return this;e&&(g=function(){!--h&&e.call(j)}),d=c.is(d,U)?d:g;var k=c.animation(a,b,d,g);for(f=this.items[--i].animate(k);i--;)this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(f,k,k),this.items[i]&&!this.items[i].removed||h--;return this},nc.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},nc.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=P[D](0,a),b=P[D](0,b),c=O[D](0,c),d=O[D](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},nc.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},nc.toString=function(){return"Raphals set"},nc.glow=function(a){var b=this.paper.set();return this.forEach(function(c){var d=c.glow(a);null!=d&&d.forEach(function(a){b.push(a)})}),b},nc.isPointInside=function(a,b){var c=!1;return this.forEach(function(d){return d.isPointInside(a,b)?(c=!0,!1):void 0}),c},c.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[z](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=ab(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[z](e)){var f=a.glyphs[e];if(b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k)for(var g in f.k)f[z](g)&&(b.glyphs[e].k[g]=f.k[g])}}return a},v.getFont=function(a,b,d,e){if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){var f=c.fonts[a];if(!f){var g=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,G)+"(\\s|$)","i");for(var h in c.fonts)if(c.fonts[z](h)&&g.test(h)){f=c.fonts[h];break}}var i;if(f)for(var j=0,k=f.length;k>j&&(i=f[j],i.face["font-weight"]!=b||i.face["font-style"]!=d&&i.face["font-style"]||i.face["font-stretch"]!=e);j++);return i}},v.print=function(a,b,d,e,f,g,h,i){g=g||"middle",h=O(P(h||0,1),-1),i=O(P(i||1,3),1);var j,k=I(d)[J](G),l=0,m=0,n=G;if(c.is(e,"string")&&(e=this.getFont(e)),e){j=(f||16)/e.face["units-per-em"];for(var o=e.face.bbox[J](w),p=+o[0],q=o[3]-o[1],r=0,s=+o[1]+("baseline"==g?q+ +e.face.descent:q/2),t=0,u=k.length;u>t;t++){if("\n"==k[t])l=0,x=0,m=0,r+=q*i;else{var v=m&&e.glyphs[k[t-1]]||{},x=e.glyphs[k[t]];l+=m?(v.w||e.w)+(v.k&&v.k[k[t]]||0)+e.w*h:0,m=1}x&&x.d&&(n+=c.transformPath(x.d,["t",l*j,r*j,"s",j,j,p,s,"t",(a-p)/j,(b-s)/j]))}}return this.path(n).attr({fill:"#000",stroke:"none"})},v.add=function(a){if(c.is(a,"array"))for(var b,d=this.set(),e=0,f=a.length;f>e;e++)b=a[e]||{},x[z](b.type)&&d.push(this[b.type]().attr(b));return d},c.format=function(a,b){var d=c.is(b,V)?[0][E](b):arguments;return a&&c.is(a,U)&&d.length-1&&(a=a.replace(y,function(a,b){return null==d[++b]?G:d[b]})),a||G},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return B.was?A.win.Raphael=B.is:delete Raphael,c},c.st=nc,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1),a.readyState="complete"},!1),a.readyState="loading"),e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){u=!0}),function(){if(c.svg){var a="hasOwnProperty",b=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=c.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};c.toString=function(){return"Your browser supports SVG.\nYou are running Raphal "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[a](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),b(e[f])):d.setAttribute(f,b(e[f])))}else d=c._g.doc.createElementNS("http://www.w3.org/2000/svg",d),d.style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(a,e){var j="linear",k=a.id+e,m=.5,n=.5,o=a.node,p=a.paper,r=o.style,s=c._g.doc.getElementById(k);if(!s){if(e=b(e).replace(c._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b),n=d(c);var e=2*(n>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){var t=e.shift();if(t=-d(t),isNaN(t))return null;var u=[0,0,f.cos(c.rad(t)),f.sin(c.rad(t))],v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v,u[3]*=v,u[2]<0&&(u[0]=-u[2],u[2]=0),u[3]<0&&(u[1]=-u[3],u[3]=0)}var w=c._parseDots(e);if(!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),a.gradient&&k!=a.gradient.id&&(p.defs.removeChild(a.gradient),delete a.gradient),!a.gradient){s=q(j+"Gradient",{id:k}),a.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:a.matrix.invert()}),p.defs.appendChild(s);for(var x=0,y=w.length;y>x;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){if("path"==d.type){for(var g,h,i,j,k,m=b(e).toLowerCase().split("-"),n=d.paper,r=f?"end":"start",s=d.node,t=d.attrs,u=t["stroke-width"],v=m.length,w="classic",x=3,y=3,z=5;v--;)switch(m[v]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=m[v];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}if("open"==w?(x+=2,y+=2,z+=2,i=1,j=f?4:1,k={fill:"none",stroke:t.stroke}):(j=i=x/2,k={fill:t.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=w){var A="raphael-marker-"+w,B="raphael-marker-"+r+w+x+y;c._g.doc.getElementById(A)?p[A]++:(n.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[w],id:A})),p[A]=1);var C,D=c._g.doc.getElementById(B);D?(p[B]++,C=D.getElementsByTagName("use")[0]):(D=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:j,refY:y/2}),C=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(1/((x/z+y/z)/2)).toFixed(4)}),D.appendChild(C),n.defs.appendChild(D),p[B]=1),q(C,k);var E=i*("diamond"!=w&&"oval"!=w);f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-E*u):(g=E*u,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),k={},k["marker-"+r]="url(#"+B+")",(h||g)&&(k.d=c.getSubpath(t.path,g,h)),q(s,k),d._.arrows[r+"Path"]=A,d._.arrows[r+"Marker"]=B,d._.arrows[r+"dx"]=E,d._.arrows[r+"Type"]=w,d._.arrows[r+"String"]=e}else f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-g):(g=0,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),d._.arrows[r+"Path"]&&q(s,{d:c.getSubpath(t.path,g,h)}),delete d._.arrows[r+"Path"],delete d._.arrows[r+"Marker"],delete d._.arrows[r+"dx"],delete d._.arrows[r+"Type"],delete d._.arrows[r+"String"];for(k in p)if(p[a](k)&&!p[k]){var F=c._g.doc.getElementById(k);F&&F.parentNode.removeChild(F)}}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=u[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=c.length;h--;)g[h]=c[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility;i.style.visibility="hidden";for(var o in f)if(f[a](o)){if(!c._availableAttrs[a](o))continue;var p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"title":var u=i.getElementsByTagName("title");if(u.length&&(u=u[0]))u.firstChild.nodeValue=p;else{u=q("title");var w=c._g.doc.createTextNode(p);u.appendChild(w),i.appendChild(u)}break;case"href":case"target":var x=i.parentNode;if("a"!=x.tagName.toLowerCase()){var z=q("a");x.insertBefore(z,i),z.appendChild(i),x=z}"target"==o?x.setAttributeNS(n,"show","blank"==p?"new":p):x.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":var A=b(p).split(j);if(4==A.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var B=q("clipPath"),C=q("rect");B.id=c.createUUID(),q(C,{x:A[0],y:A[1],width:A[2],height:A[3]}),B.appendChild(C),d.paper.defs.appendChild(B),q(i,{"clip-path":"url(#"+B.id+")"}),d.clip=C}if(!p){var D=i.getAttribute("clip-path");if(D){var E=c._g.doc.getElementById(D.replace(/(^url\(#|\)$)/g,l));E&&E.parentNode.removeChild(E),q(i,{"clip-path":l}),delete d.clip}}break;case"path":"path"==d.type&&(q(i,{d:p?k.path=c._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x",p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y",p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p),d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":(1!=d._.sx||1!=d._.sy)&&(p/=g(h(d._.sx),h(d._.sy))||1),d.paper._vbSize&&(p*=d.paper._vbSize),i.setAttribute(o,p),k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f),d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":var F=b(p).match(c._ISURL);if(F){B=q("pattern");var G=q("image");B.id=c.createUUID(),q(B,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),q(G,{x:0,y:0,"xlink:href":F[1]}),B.appendChild(G),function(a){c._preload(F[1],function(){var b=this.offsetWidth,c=this.offsetHeight;q(a,{width:b,height:c}),q(G,{width:b,height:c}),d.paper.safari()})}(B),d.paper.defs.appendChild(B),q(i,{fill:"url(#"+B.id+")"}),d.pattern=B,d.pattern&&s(d);break}var H=c.getRGB(p);if(H.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p)){if("opacity"in k||"fill-opacity"in k){var I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));if(I){var J=I.getElementsByTagName("stop");q(J[J.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})}}k.gradient=p,k.fill="none";break}}else delete f.gradient,delete k.gradient,!c.is(k.opacity,"undefined")&&c.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!c.is(k["fill-opacity"],"undefined")&&c.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});H[a]("opacity")&&q(i,{"fill-opacity":H.opacity>1?H.opacity/100:H.opacity});case"stroke":H=c.getRGB(p),i.setAttribute(o,H.hex),"stroke"==o&&H[a]("opacity")&&q(i,{"stroke-opacity":H.opacity>1?H.opacity/100:H.opacity}),"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[a]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)),I&&(J=I.getElementsByTagName("stop"),q(J[J.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");var K=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[K]=p,d._.dirty=1,i.setAttribute(o,p)}}y(d,f),i.style.visibility=m},x=1.2,y=function(d,f){if("text"==d.type&&(f[a]("text")||f[a]("font")||f[a]("font-size")||f[a]("x")||f[a]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(c._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;if(f[a]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var j,k=b(f.text).split("\n"),m=[],n=0,o=k.length;o>n;n++)j=q("tspan"),n&&q(j,{dy:i*x,x:g.x}),j.appendChild(c._g.doc.createTextNode(k[n])),h.appendChild(j),m[n]=j}else for(m=h.getElementsByTagName("tspan"),n=0,o=m.length;o>n;n++)n?q(m[n],{dy:i*x,x:g.x}):q(m[0],{dy:0});q(h,{x:g.x,y:g.y}),d._.dirty=1;var p=d._getBBox(),r=g.y-(p.y+p.height/2);r&&c.is(r,"finite")&&q(m[0],{dy:r})}},z=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.matrix=c.matrix(),this.realPath=null,this.paper=b,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},A=c.el;z.prototype=A,A.constructor=z,c._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);var d=new z(c,b);return d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d},A.rotate=function(a,c,e){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,c,e]])),this},A.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this},A.translate=function(a,c){return this.removed?this:(a=b(a).split(j),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",a,c]])),this)},A.transform=function(b){var d=this._;if(null==b)return d.transform;if(c._extractTransform(this,b),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy){var e=this.attrs[a]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},A.remove=function(){if(!this.removed&&this.node.parentNode){var a=this.paper;a.__set__&&a.__set__.exclude(this),k.unbind("raphael.*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),c._tear(this,a),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}},A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b},A.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;for(var g=b.split(j),h={},i=0,l=g.length;l>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return l-1?h:h[g[0]]}if(null==d&&c.is(b,"array")){for(h={},i=0,l=b.length;l>i;i++)h[b[i]]=this.attr(b[i]);return h}if(null!=d){var m={};m[b]=d}else null!=b&&c.is(b,"object")&&(m=b);for(var n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[a](n)&&m[a](n)&&c.is(this.paper.customAttributes[n],"function")){var o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(var p in o)o[a](p)&&(m[p]=o[p])}return w(this,m),this},A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this},A.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;return"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper),this.paper,this},A.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this},A.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this},A.blur=function(a){var b=this;if(0!==+a){var d=q("filter"),e=q("feGaussianBlur");b.attrs.blur=a,d.id=c.createUUID(),q(e,{stdDeviation:+a||1.5}),d.appendChild(e),b.paper.defs.appendChild(d),b._blur=d,q(b.node,{filter:"url(#"+d.id+")"})}else b._blur&&(b._blur.parentNode.removeChild(b._blur),delete b._blur,delete b.attrs.blur),b.node.removeAttribute("filter");return b},c._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);var f=new z(e,a);return f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f},c._engine.rect=function(a,b,c,d,e,f){var g=q("rect");a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h},c._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g},c._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h},c._engine.text=function(a,b,d,e){var f=q("text");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g},c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,g=a.height;if(!b)throw new Error("SVG container not found.");var h,i=q("svg"),j="overflow:hidden;";return d=d||0,e=e||0,f=f||512,g=g||342,q(i,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==b?(i.style.cssText=j+"position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(i),h=1):(i.style.cssText=j+"position:relative",b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i)),b=new c._Paper,b.width=f,b.height=g,b.canvas=i,b.clear(),b._left=b._top=0,h&&(b.renderfix=function(){}),b.renderfix(),b},c._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var f,h,i=g(c/this.width,d/this.height),j=this.top,l=e?"xMidYMid meet":"xMinYMin";for(null==a?(this._vbSize&&(i=1),delete this._vbSize,f="0 0 "+this.width+m+this.height):(this._vbSize=i,f=a+m+b+m+c+m+d),q(this.canvas,{viewBox:f,preserveAspectRatio:l});i&&j;)h="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":h}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[a,b,c,d,!!e],this},c.prototype.renderfix=function(){var a,b=this.canvas,c=b.style;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(d){a=b.createSVGMatrix()}var e=-a.e%1,f=-a.f%1;(e||f)&&(e&&(this._left=(this._left+e)%1,c.left=this._left+"px"),f&&(this._top=(this._top+f)%1,c.top=this._top+"px"))},c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null,(this.desc=q("desc")).appendChild(c._g.doc.createTextNode("Created with Raphal "+c.version)),a.appendChild(this.desc),a.appendChild(this.defs=q("defs"))},c.prototype.remove=function(){k("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};var B=c.st;for(var C in A)A[a](C)&&!B[a](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}}(),function(){if(c.vml){var a="hasOwnProperty",b=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=c.eve,m=" progid:DXImageTransform.Microsoft",n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(a){var d=/[ahqstv]/gi,e=c._pathToAbsolute;if(b(a).match(d)&&(e=c._path2curve),d=/[clmz]/g,e==c._pathToAbsolute&&!b(a).match(d)){var g=b(a).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]),d.push(f(a*u))}),g+d});return g}var h,i,j=e(a);g=[];for(var k=0,l=j.length;l>k;k++){h=j[k],i=j[k][0].toLowerCase(),"z"==i&&(i="x");for(var m=1,r=h.length;r>m;m++)i+=f(h[m]*u)+(m!=r-1?",":o);g.push(i)}return g.join(n)},y=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",q=u/b,r=u/c;if(m.visibility="hidden",b&&c){if(l.coordsize=i(q)+n+i(r),m.rotation=f*(0>b*c?-1:1),f){var s=y(f,d,e);d=s.dx,e=s.dy}if(0>b&&(p+="x"),0>c&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-q+n+e*-r,k||g.fillsize){var t=l.getElementsByTagName(j);t=t&&t[0],l.removeChild(t),k&&(s=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),t.position=s.dx*o+n+s.dy*o),g.fillsize&&(t.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(t)}m.visibility="visible"}};c.toString=function(){return"Your browser doesnt support SVG. Falling down to VML.\nYou are running Raphal "+this.version};var A=function(a,c,d){for(var e=b(c).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}var k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h,k[f+"arrowlength"]=i,k[f+"arrowwidth"]=j},B=function(e,i){e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,q=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),r=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),s=e;for(var t in i)i[a](t)&&(m[t]=i[t]);if(q&&(m.path=c._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||q)&&(l.path=x(~b(m.path).toLowerCase().indexOf("r")?c._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),r){var y=+m.cx,B=+m.cy,D=+m.rx||+m.r||0,E=+m.ry||+m.r||0;l.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((y-D)*u),f((B-E)*u),f((y+D)*u),f((B+E)*u),f(y*u)),e._.dirty=1}if("clip-rect"in i){var G=b(i["clip-rect"]).split(k);if(4==G.length){G[2]=+G[2]+ +G[0],G[3]=+G[3]+ +G[1];var H=l.clipRect||c._g.doc.createElement("div"),I=H.style;I.clip=c.format("rect({1}px {2}px {3}px {0}px)",G),l.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=e.paper.width+"px",I.height=e.paper.height+"px",l.parentNode.insertBefore(H,l),H.appendChild(l),l.clipRect=H)}i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")}if(e.textpath){var J=e.textpath.style;i.font&&(J.font=i.font),i["font-family"]&&(J.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(J.fontSize=i["font-size"]),i["font-weight"]&&(J.fontWeight=i["font-weight"]),i["font-style"]&&(J.fontStyle=i["font-style"])}if("arrow-start"in i&&A(s,i["arrow-start"]),"arrow-end"in i&&A(s,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){var K=l.getElementsByTagName(j),L=!1;if(K=K&&K[0],!K&&(L=K=F(j)),"image"==e.type&&i.src&&(K.src=i.src),i.fill&&(K.on=!0),(null==K.on||"none"==i.fill||null===i.fill)&&(K.on=!1),K.on&&i.fill){var M=b(i.fill).match(c._ISURL);if(M){K.parentNode==l&&l.removeChild(K),K.rotate=!0,K.src=M[1],K.type="tile";var N=e.getBBox(1);K.position=N.x+n+N.y,e._.fillpos=[N.x,N.y],c._preload(M[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})}else K.color=c.getRGB(i.fill).hex,K.src=o,K.type="solid",c.getRGB(i.fill).error&&(s.type in{circle:1,ellipse:1}||"r"!=b(i.fill).charAt())&&C(s,i.fill,K)&&(m.fill="none",m.gradient=i.fill,K.rotate=!1)}if("fill-opacity"in i||"opacity"in i){var O=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+c.getRGB(i.fill).o+1||2)-1);O=h(g(O,0),1),K.opacity=O,K.src&&(K.color="none")}l.appendChild(K);var P=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],Q=!1;!P&&(Q=P=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(P.on=!0),
("none"==i.stroke||null===i.stroke||null==P.on||0==i.stroke||0==i["stroke-width"])&&(P.on=!1);var R=c.getRGB(i.stroke);P.on&&i.stroke&&(P.color=R.hex),O=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+R.o+1||2)-1);var S=.75*(d(i["stroke-width"])||1);if(O=h(g(O,0),1),null==i["stroke-width"]&&(S=m["stroke-width"]),i["stroke-width"]&&(P.weight=S),S&&1>S&&(O*=S)&&(P.weight=1),P.opacity=O,i["stroke-linejoin"]&&(P.joinstyle=i["stroke-linejoin"]||"miter"),P.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(P.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),"stroke-dasharray"in i){var T={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};P.dashstyle=T[a](i["stroke-dasharray"])?T[i["stroke-dasharray"]]:o}Q&&l.appendChild(P)}if("text"==s.type){s.paper.canvas.style.display=o;var U=s.paper.span,V=100,W=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=U.style,m.font&&(p.font=m.font),m["font-family"]&&(p.fontFamily=m["font-family"]),m["font-weight"]&&(p.fontWeight=m["font-weight"]),m["font-style"]&&(p.fontStyle=m["font-style"]),W=d(m["font-size"]||W&&W[0])||10,p.fontSize=W*V+"px",s.textpath.string&&(U.innerHTML=b(s.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var X=U.getBoundingClientRect();s.W=m.w=(X.right-X.left)/V,s.H=m.h=(X.bottom-X.top)/V,s.X=m.x,s.Y=m.y+s.H/2,("x"in i||"y"in i)&&(s.path.v=c.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],Z=0,$=Y.length;$>Z;Z++)if(Y[Z]in i){s._.dirty=1;break}switch(m["text-anchor"]){case"start":s.textpath.style["v-text-align"]="left",s.bbx=s.W/2;break;case"end":s.textpath.style["v-text-align"]="right",s.bbx=-s.W/2;break;default:s.textpath.style["v-text-align"]="center",s.bbx=0}s.textpath.style["v-text-kern"]=!0}},C=function(a,f,g){a.attrs=a.attrs||{};var h=(a.attrs,Math.pow),i="linear",j=".5 .5";if(a.attrs.gradient=f,f=b(f).replace(c._radial_gradient,function(a,b,c){return i="radial",b&&c&&(b=d(b),c=d(c),h(b-.5,2)+h(c-.5,2)>.25&&(c=e.sqrt(.25-h(b-.5,2))*(2*(c>.5)-1)+.5),j=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==i){var k=f.shift();if(k=-d(k),isNaN(k))return null}var l=c._parseDots(f);if(!l)return null;if(a=a.shape||a.node,l.length){a.removeChild(g),g.on=!0,g.method="none",g.color=l[0].color,g.color2=l[l.length-1].color;for(var m=[],p=0,q=l.length;q>p;p++)l[p].offset&&m.push(l[p].offset+n+l[p].color);g.colors=m.length?m.join():"0% "+g.color,"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360),a.appendChild(g)}return 1},D=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=b,this.matrix=c.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},E=c.el;D.prototype=E,E.constructor=D,E.transform=function(a){if(null==a)return this._.transform;var d,e=this.paper._viewBoxShift,f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:o;e&&(d=a=b(a).replace(/\.{3}|\u2026/g,this._.transform||o)),c._extractTransform(this,f+a);var g,h=this.matrix.clone(),i=this.skew,j=this.node,k=~b(this.attrs.fill).indexOf("-"),l=!b(this.attrs.fill).indexOf("url(");if(h.translate(1,1),l||k||"image"==this.type)if(i.matrix="1 0 0 1",i.offset="0 0",g=h.split(),k&&g.noRotation||!g.isSimple){j.style.filter=h.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;j.coordorigin=q*-u+n+r*-u,z(this,1,1,q,r,0)}else j.style.filter=o,z(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate);else j.style.filter=o,i.matrix=b(h),i.offset=h.offset();return d&&(this._.transform=d),this},E.rotate=function(a,c,e){if(this.removed)return this;if(null!=a){if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,c,e]])),this}},E.translate=function(a,c){return this.removed?this:(a=b(a).split(k),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",a,c]])),this)},E.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=o),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),c.eve.unbind("raphael.*.*."+this.id),c._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}},E.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if(b==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=b.split(k),h={},i=0,m=g.length;m>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&c.is(b,"array")){for(h={},i=0,m=b.length;m>i;i++)h[b[i]]=this.attr(b[i]);return h}var n;null!=d&&(n={},n[b]=d),null==d&&c.is(b,"object")&&(n=b);for(var o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[a](o)&&n[a](o)&&c.is(this.paper.customAttributes[o],"function")){var p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(var q in p)p[a](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text),B(this,n)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)},E.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)},E.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)},E.blur=function(a){var b=this.node.runtimeStyle,d=b.filter;return d=d.replace(r,o),0!==+a?(this.attrs.blur=a,b.filter=d+n+m+".Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",f(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur),this},c._engine.path=function(a,b){var c=F("shape");c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin;var d=new D(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c);var f=F("skew");return f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d},c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g),i=a.path(h),j=i.attrs;return i.X=j.x=b,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i},c._engine.ellipse=function(a,b,c,d,e){var f=a.path();return f.attrs,f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f},c._engine.circle=function(a,b,c,d){var e=a.path();return e.attrs,e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e},c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g),i=a.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=b,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=b,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i},c._engine.text=function(a,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath");d=d||0,e=e||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=b(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0";var k=new D(h,a),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g};k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=b(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),a.canvas.appendChild(h);var m=F("skew");return m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k},c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this},c._engine.setViewBox=function(a,b,d,e,f){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,f]);var h,i,j=this.width,k=this.height,l=1/g(d/j,e/k);return f&&(h=k/e,i=j/d,j>d*h&&(a-=(j-d*h)/2/h),k>e*i&&(b-=(k-e*i)/2/i)),this._viewBox=[a,b,d,e,!!f],this._viewBoxShift={dx:-a,dy:-b,scale:l},this.forEach(function(a){a.transform("...")}),this};var F;c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},c._engine.initWin(c._g.win),c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,e=a.width,f=a.x,g=a.y;if(!b)throw new Error("VML container not found.");var h=new c._Paper,i=h.canvas=c._g.doc.createElement("div"),j=i.style;return f=f||0,g=g||0,e=e||512,d=d||342,h.width=e,h.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),h.coordsize=1e3*u+n+1e3*u,h.coordorigin="0 0",h.span=c._g.doc.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",i.appendChild(h.span),j.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==b?(c._g.doc.body.appendChild(i),j.left=f+"px",j.top=g+"px",j.position="absolute"):b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i),h.renderfix=function(){},h},c.prototype.clear=function(){c.eve("raphael.clear",this),this.canvas.innerHTML=o,this.span=c._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},c.prototype.remove=function(){c.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};var G=c.st;for(var H in E)E[a](H)&&!G[a](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}}(),B.was?A.win.Raphael=c:Raphael=c,c}),function(b){function d(g,h){if(!(g.originalEvent.touches.length>1)){g.preventDefault();var i=g.originalEvent.changedTouches[0],f=document.createEvent("MouseEvents");f.initMouseEvent(h,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),g.target.dispatchEvent(f)}}if(b.support.touch="ontouchend"in document,b.support.touch){var a,c=b.ui.mouse.prototype,e=c._mouseInit;c._touchStart=function(g){var f=this;!a&&f._mouseCapture(g.originalEvent.changedTouches[0])&&(a=!0,f._touchMoved=!1,d(g,"mouseover"),d(g,"mousemove"),d(g,"mousedown"))},c._touchMove=function(f){a&&(this._touchMoved=!0,d(f,"mousemove"))},c._touchEnd=function(f){a&&(d(f,"mouseup"),d(f,"mouseout"),this._touchMoved||d(f,"click"),a=!1)},c._mouseInit=function(){var f=this;f.element.bind("touchstart",b.proxy(f,"_touchStart")).bind("touchmove",b.proxy(f,"_touchMove")).bind("touchend",b.proxy(f,"_touchEnd")),e.call(f)}}}(jQuery),window.jGroupdocs||(window.jGroupdocs={}),jGroupdocs.html={toText:function(html){return html&&html.length?html.replace(/<div>|<li>|<ul>|<p>|<br\s*[\/]?>/gi,"\n").replace(/<li>/gi,"  *  ").replace(/<[^>]+>/gi,""):""},textWidth:function(text,fontProp){var tag=document.createElement("div");tag.style.position="absolute",tag.style.left="-999em",tag.style.whiteSpace="nowrap",tag.style.font=fontProp,tag.innerHTML=text,document.body.appendChild(tag);var result=tag.clientWidth;return document.body.removeChild(tag),result}},jSaaspose.utils={getSequenceNumber:function(){var sn=1e3;return function(){return++sn}}(),getName:function(path){return null!=path?path.replace(/.*(\/|\\)/,""):""},getExt:function(path){var name=null!=path?Container.Resolve("PathProvider").getName(path):"";return name.replace(/.*[\.]/,"")},getHexColor:function(color){return color&&0>color&&(color=4294967295+color+1),"#"+("000000"+(color&&color.toString?color.toString(16):"")).substr(-6)}},function($){window.jGroupdocs||(window.jGroupdocs={}),jGroupdocs.UndoManager=function(){this._commands=[],this._pendingCommands=[],this._position=-1,this._doing=!1,this._redoing=!1},$.extend(jGroupdocs.UndoManager.prototype,{_commands:null,_pendingCommands:null,_position:-1,_doing:!1,_redoing:!1,canUndo:function(){return!this._doing&&this._position>=0},canRedo:function(){return!this._doing&&this._position<this._commands.length-1},executeAsync:function(command){var self=this,onDone=command._callbacks.onDone,onUndone=command._callbacks.onUndone,onDoFailed=command._callbacks.onDoFailed,onUndoFailed=command._callbacks.onUndoFailed,execChunk=function(cmdCallback,mngrCallback){return function(response){cmdCallback&&cmdCallback(response),mngrCallback&&mngrCallback(command)}};$.extend(command._callbacks,{onDone:execChunk(onDone,self._onDone.bind(self)),onUndone:execChunk(onUndone,self._onUndone.bind(self)),onDoFailed:execChunk(onDoFailed,self._onDoUndoFailed.bind(self)),onDoFailed:execChunk(onUndoFailed,self._onDoUndoFailed.bind(self))});return this._doing?(this._pendingCommands.push(command),!0):(this._doing=!0,command.executeAsync(),this._onExecuting(),!0)},undoAsync:function(){this.canUndo()&&(this._doing=!0,this._commands[this._position].undoAsync(),this._onExecuting())},redoAsync:function(){this.canRedo()&&(this._doing=!0,this._redoing=!0,this._commands[this._position+1].redoAsync(),this._onExecuting())},clear:function(){this._commands.length=0,this._position=-1},_onExecuting:function(){},_onDone:function(command){if(this._redoing||(this._clearRedo(),this._commands.push(command)),this._position++,this._pendingCommands.length>0){var cmd=this._pendingCommands.shift();cmd.executeAsync(),this._onExecuting()}else this._doing=!1,this._redoing=!1},_onUndone:function(command){this._position--,this._doing=!1},_onDoUndoFailed:function(command){this._pendingCommands.splice(0,this._pendingCommands.length),this._doing=!1,this._redoing=!1},_clearRedo:function(){this._commands=this._commands.slice(0,this._position+1)}}),jGroupdocs.UndoableCommand=function(){},$.extend(jGroupdocs.UndoableCommand.prototype,{undoCommand:function(){throw up}}),jGroupdocs.AsyncCommand=function(callbacks){jGroupdocs.UndoableCommand.prototype.constructor.apply(this,arguments),this._callbacks=callbacks},$.extend(jGroupdocs.AsyncCommand.prototype,jGroupdocs.UndoableCommand.prototype,{_callbacks:{onDone:null,onUndone:null,onDoFailed:null,onUndoFailed:null,onIdsFixedUp:null},executeAsync:function(){throw up},undoAsync:function(){this.undoCommand().executeAsync()},redoAsync:function(){this.executeAsync()},_onDone:function(response){this._callbacks.onDone&&this._callbacks.onDone(response)},_onDoFailed:function(response){this._callbacks.onDoFailed&&this._callbacks.onDoFailed(response)},_onUndone:function(response){this._callbacks.onUndone&&this._callbacks.onUndone(response)},_onUndoFailed:function(response){this._callbacks.onUndoFailed&&this._callbacks.onUndoFailed(response)}})}(jQuery),function($,undefined){$.widget("ui.printable",{options:{contentLoader:null,displayName:null},_viewModel:null,_frame:null,_frameLoaded:!1,_fileId:"",_setup:null,_create:function(){this._viewModel=new printableViewModel},_init:function(){},viewModel:function(){return this._viewModel},print:function(fileId,setup){if(this._viewModel.printing(!0),this._frameLoaded&&this._fileId==fileId&&this._setup==setup&&setup.renew!==!0)return void this._preview();var self=this;this._fileId=fileId,this._setup=setup,this._frame&&this._frame.length||(this._frame=$("<iframe name='groupdocsPrintFrame' src='about:blank' style='width: 0; height: 0;'></iframe>"),this._frame.appendTo(this.element)),this.options.contentLoader(fileId,setup,function(response){self._frameLoaded||self._frame.load(function(){window.setTimeout(function(){self._preview()},10),self._frameLoaded=!0});var iframeDoc=self._frame.get(0).contentWindow.document;iframeDoc.open(),iframeDoc.write(response.data.content),iframeDoc.close()},function(error){})},_preview:function(){this._viewModel.printing(!1),this._frame.get(0).contentWindow.focus(),this._frame.get(0).contentWindow.print()}}),printableViewModel=function(){this._init()},$.extend(printableViewModel.prototype,{printing:null,_init:function(){this.printing=ko.observable(!1)}})}(jQuery),$.extend(jSaaspose.PortalService.prototype,{getReviewerContactsAsync:function(userId,privateKey,successCallback,errorCallback){},listAnnotationsAsync:function(connectionId,userId,privateKey,fileId,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId};return this._runServiceAsync(this.applicationPath+"ListAnnotations"+this._urlSuffix,data,successCallback,errorCallback,!1)},createAnnotationAsync:function(connectionId,userId,privateKey,fileId,type,message,pageNumber,rectangle,annotationPosition,textRange,svgPath,drawingOptions,font,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,type:type,message:message,pageNumber:pageNumber,rectangle:rectangle,annotationPosition:annotationPosition,textRange:textRange,svgPath:svgPath,drawingOptions:drawingOptions,font:font};return this._runServiceAsync(this.applicationPath+"CreateAnnotation"+this._urlSuffix,data,successCallback,errorCallback,!1)},deleteAnnotationAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid};return this._runServiceAsync(this.applicationPath+"DeleteAnnotation"+this._urlSuffix,data,successCallback,errorCallback,!1)},addAnnotationReplyAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,message,parentReplyGuid,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,message:message,parentReplyGuid:parentReplyGuid};return this._runServiceAsync(this.applicationPath+"AddAnnotationReply"+this._urlSuffix,data,successCallback,errorCallback,!1)},deleteAnnotationReplyAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,replyGuid,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,replyGuid:replyGuid};return this._runServiceAsync(this.applicationPath+"DeleteAnnotationReply"+this._urlSuffix,data,successCallback,errorCallback,!1)},editAnnotationReplyAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,replyGuid,message,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,replyGuid:replyGuid,message:message};return this._runServiceAsync(this.applicationPath+"EditAnnotationReply"+this._urlSuffix,data,successCallback,errorCallback,!1)},restoreAnnotationRepliesAsync:function(connectionId,fileId,annotationGuid,replies,successCallback,errorCallback){var data={connectionId:connectionId,fileId:fileId,annotationGuid:annotationGuid,replies:replies};return this._runServiceAsync(this.applicationPath+"RestoreAnnotationReplies"+this._urlSuffix,data,successCallback,errorCallback,!1)},viewAnnotatedDocumentAsync:function(userId,privateKey,guid,index,count,width,height,quality,usePdf,watermark,successCallback,errorCallback,useCache){var data={userId:userId,privateKey:privateKey,guid:guid,width:width,quality:quality,usePdf:usePdf,preloadPagesCount:count,watermarkText:watermark.text,watermarkColor:watermark.color,watermarkPosition:watermark.position,watermarkFontSize:watermark.fontSize};this._runServiceAsync(this.applicationPath+this.urlPrefix+"/ViewDocument"+this._urlSuffix,data,successCallback,errorCallback,null!=useCache?useCache:!0)},moveAnnotationMarkerAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,left,top,pageNumber,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,left:left,top:top,pageNumber:pageNumber};return this._runServiceAsync(this.applicationPath+"MoveAnnotationMarker"+this._urlSuffix,data,successCallback,errorCallback,!1)},saveTextFieldAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,text,fontFamily,fontSize,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,text:text,fontFamily:fontFamily,fontSize:fontSize};return this._runServiceAsync(this.applicationPath+"SaveTextField"+this._urlSuffix,data,successCallback,errorCallback,!1)},setTextFieldColorAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,fontColor,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,fontColor:fontColor};return this._runServiceAsync(this.applicationPath+"SetTextFieldColor"+this._urlSuffix,data,successCallback,errorCallback,!1)},setAnnotationBackgroundColorAsync:function(connectionId,fileId,annotationGuid,color,successCallback,errorCallback){var data={connectionId:connectionId,fileId:fileId,annotationGuid:annotationGuid,color:color};return this._runServiceAsync(this.applicationPath+"SetAnnotationBackgroundColor"+this._urlSuffix,data,successCallback,errorCallback,!1)},resizeAnnotationAsync:function(connectionId,userId,privateKey,fileId,annotationGuid,width,height,successCallback,errorCallback){var data={connectionId:connectionId,userId:userId,privateKey:privateKey,fileId:fileId,annotationGuid:annotationGuid,width:width,height:height};return this._runServiceAsync(this.applicationPath+"ResizeAnnotation"+this._urlSuffix,data,successCallback,errorCallback,!1)},exportAnnotationsAsync:function(connectionId,fileId,format,mode,successCallback,errorCallback){var data={connectionId:connectionId,fileId:fileId,format:format,mode:mode};return this._runServiceAsync(this.applicationPath+"ExportAnnotations"+this._urlSuffix,data,successCallback,errorCallback,!1)},importAnnotationsAsync:function(userId,privateKey,connectionId,fileId,saveCurrentAnnotations,successCallback,errorCallback){var data={connectionId:connectionId,fileGuid:fileId,userId:userId,privateKey:privateKey,saveCurrentAnnotations:saveCurrentAnnotations};return this._runServiceAsync(this.applicationPath+"ImportAnnotations"+this._urlSuffix,data,successCallback,errorCallback,!1)},getPdfVersionOfDocumentAsync:function(connectionId,fileId,successCallback,errorCallback){var data={connectionId:connectionId,fileId:fileId};return this._runServiceAsync(this.applicationPath+"GetPdfVersionOfDocument"+this._urlSuffix,data,successCallback,errorCallback,!1)},addDocumentReviewerAsync:function(userId,privateKey,fileId,reviewerEmail,reviewerFirstName,reviewerLastName,reviewerInvitationMessage,successCallback,errorCallback){var data={userId:userId,privateKey:privateKey,fileId:fileId,reviewerEmail:reviewerEmail,reviewerFirstName:reviewerFirstName,reviewerLastName:reviewerLastName,reviewerInvitationMessage:reviewerInvitationMessage};return this._runServiceAsync(this.applicationPath+"AddDocumentReviewer",data,successCallback,errorCallback,!1)},getDocumentCollaboratorsAsync:function(userId,privateKey,fileId,successCallback,errorCallback){var data={userId:userId,privateKey:privateKey,fileId:fileId};return this._runServiceAsync(this.applicationPath+"GetDocumentCollaborators"+this._urlSuffix,data,successCallback,errorCallback,!1)},getDocumentCollaboratorsSync:function(userId,privateKey,fileId){var r=null,data={userId:userId,privateKey:privateKey,fileId:fileId},successCallback=function(response){r=response},errorCallback=function(response){r={error:response}};return this._runService(this.applicationPath+"GetDocumentCollaborators"+this._urlSuffix,data,!1,successCallback,errorCallback,!1),r},setReviewerContactsAsync:function(userId,privateKey,reviewerContacts,successCallback,errorCallback){},getFile:function(fileId,successCallback,errorCallback,useCache){successCallback({fileId:fileId,url:this.applicationPath+this.urlPrefix+"/GetFile"+this._urlSuffix+"?path="+fileId})},getDocumentPrintViewAsync:function(connectionId,fileId,options,successCallback,errorCallback){var data={connectionId:connectionId,fileId:fileId,options:options};return this._runServiceAsync(this.applicationPath+"GetPrintView"+this._urlSuffix,data,successCallback,errorCallback,!1)}}),function($,undefined){var GuestUser={Name:"groupdocs@groupdocs.com",DisplayName:"guest"},englishLocale={ago:"ago",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",day:"day",days:"days",week:"week",weeks:"weeks",lessThanAMinuteAgo:"less than a minute ago"},ToolDeactivationMode={Manual:0,Auto:1};AnnotationReply=function(reply,serverTime){this._init(reply,serverTime||new Date)},$.extend(AnnotationReply.prototype,{guid:null,index:-1,text:null,repliedOn:null,userGuid:null,userName:null,parentReply:null,replyLevel:0,baseAvatarUrl:null,avatarUrl:null,childReplies:null,_init:function(reply,serverTime){this.guid=ko.observable(reply.guid),this.repliedOn=reply.repliedOn;var replyDateTime=new Date(this.repliedOn),now=serverTime,difference=now.getTime()-replyDateTime.getTime();difference=difference>0?difference:0;var daysDifference=Math.floor(difference/1e3/60/60/24);difference-=1e3*daysDifference*60*60*24;var hoursDifference=Math.floor(difference/1e3/60/60);difference-=1e3*hoursDifference*60*60;var minutesDifference=Math.floor(difference/1e3/60);difference-=1e3*minutesDifference*60,hoursDifference>0&&(minutesDifference>15&&45>minutesDifference&&(hoursDifference+=.5),minutesDifference>=45&&(hoursDifference+=1,hoursDifference>=24&&(daysDifference+=1)));var localization=$.extend(!0,{},englishLocale,window.localizedStrings||{}),localizedAgo=localization.ago,localizedHour=localization.hour,localizedHours=localization.hours,localizedDay=localization.day,localizedDays=localization.days,localizedWeek=localization.week,localizedWeeks=localization.weeks;if(7>daysDifference)if(0==daysDifference)if(0==hoursDifference)if(0==minutesDifference)this.displayDateTime=localization.lessThanAMinuteAgo;else{var localizedMin=localization.minute,localizedMins=localization.minutes;this.displayDateTime=window.jGroupdocs.stringExtensions.format("{0} {1} {2}",minutesDifference,1==minutesDifference?localizedMin:localizedMins,localizedAgo)}else this.displayDateTime=window.jGroupdocs.stringExtensions.format("{0} {1} {2}",hoursDifference,1==hoursDifference?localizedHour:localizedHours,localizedAgo);else this.displayDateTime=window.jGroupdocs.stringExtensions.format("{0} {1} {2} {3} {4}",daysDifference,1==daysDifference?localizedDay:localizedDays,hoursDifference,1==hoursDifference?localizedHour:localizedHours,localizedAgo);else this.displayDateTime=window.jGroupdocs.stringExtensions.format("{0} {1} {2} {3} {4}",Math.floor(daysDifference/7),1==Math.floor(daysDifference/7)?localizedWeek:localizedWeeks,daysDifference%7,daysDifference%7==1?localizedDay:localizedDays,localizedAgo);this.userGuid=reply.userGuid,this.userName=reply.userName==GuestUser.Name?GuestUser.DisplayName:reply.userName||GuestUser.DisplayName,this.text=ko.observable(reply.text),this.parentReplyGuid=ko.observable(reply.parentReplyGuid),this.replyLevel=reply.replyLevel,this.avatarUrl=reply.isAvatarExist===!1?null:this.baseAvatarUrl+reply.userGuid,this.childReplies=ko.observableArray([]),this.isEmpty=ko.computed(function(){return!(this.guid()&&this.guid().length)},this)},clone:function(){return new AnnotationReply(ko.toJS(this),new Date)},restore:function(source){return source&&source.guid()==this.guid()?(this.text(source.text()),!0):!1}}),Annotation=function(annotation,serverTime){this._init(annotation,serverTime)},$.extend(Annotation.prototype,{guid:null,creatorGuid:null,type:null,access:null,bounds:null,displayBounds:null,annotationPosition:null,annotationOriginalTextBoxDisplayPosition:null,annotationSideIconDisplayPosition:null,textRange:null,createdOn:null,documentGuid:null,sessionGuid:null,comments:null,replies:null,activeReply:null,activeReplyData:null,svgPath:null,displaySvgPath:null,connectingLine:null,annotationIsPublic:null,startingPoint:null,text:null,fontSize:null,fontFamily:null,isBeingDeleted:null,fontColor:null,penColor:null,penWidth:null,penStyle:null,backgroundColor:null,selectionCounter:null,connectorPosition:0,AnnotationType:{None:-1,Text:0,Area:1,Point:2,TextStrikeout:3,Polyline:4,TextField:5,Watermark:6,TextReplacement:7,TextRemoval:8,Arrow:9,TextRedaction:10,ResourcesRedaction:11,TextUnderline:12,Distance:13},AnnotationExportMode:{Append:0,TrackChanges:1},AnnotationAccess:{Public:0,Private:1},ConnectorPosition:{Middle:0,Bottom:1},_init:function(annotation,serverTime){this.guid=annotation.guid,this.type=annotation.type,this.access=annotation.access,this.pageNumber=annotation.pageNumber,this.bounds=ko.observable(new jSaaspose.Rect(annotation.box.x,annotation.box.y,annotation.box.x+annotation.box.width,annotation.box.y+annotation.box.height,!1)),this.displayBounds=ko.observable(new jSaaspose.Rect(0,0,0,0)),this.annotationPosition=ko.observable(new jSaaspose.Point(annotation.annotationPosition.x,annotation.annotationPosition.y)),this.annotationOriginalTextBoxDisplayPosition=ko.observable(new jSaaspose.Point(0,0)),this.annotationSideIconDisplayPosition=ko.observable(new jSaaspose.Point(0,0)),this.createdOn=annotation.createdOn,this.documentGuid=annotation.documentGuid,this.sessionGuid=annotation.sessionGuid,this.replies=ko.observableArray([]),this.comments=ko.observableArray([]),this.activeReply=ko.observable(-1),this.svgPath=annotation.svgPath,this.displaySvgPath="",this.annotationIsPublic=ko.observable(annotation.access==Annotation.prototype.AnnotationAccess.Public),this.creatorGuid=annotation.creatorGuid,this.startingPoint=annotation.startingPoint,this.text=annotation.fieldText,this.fontFamily=annotation.fontFamily,this.fontSize=annotation.fontSize,this.isBeingDeleted=ko.observable(!1),this.fontColor=ko.observable(annotation.fontColor||0),this.selectionCounter=annotation.selectionCounter,this.penColor=annotation.penColor||(annotation.drawingOptions?annotation.drawingOptions.penColor:undefined),
this.penWidth=annotation.penWidth||(annotation.drawingOptions?annotation.drawingOptions.penWidth:undefined),this.penStyle=annotation.penStyle||(annotation.drawingOptions?annotation.drawingOptions.penStyle:undefined),this.backgroundColor=ko.observable(annotation.backgroundColor||(annotation.drawingOptions?annotation.drawingOptions.brushColor:undefined)),annotation.range&&(this.textRange={position:annotation.range.position,length:annotation.range.length}),this.commentsEnabled=this.type!=Annotation.prototype.AnnotationType.TextStrikeout&&this.type!=Annotation.prototype.AnnotationType.TextField&&this.type!=Annotation.prototype.AnnotationType.Watermark,this.sortReplies(annotation.replies,serverTime),this.replyCount=ko.computed(function(){return $.grep(this.replies(),function(r){return!r.isEmpty()}).length},this),this.activeReply.subscribe(function(newValue){var reply=this.getReplyAt(newValue);reply&&(this.activeReplyData=reply.clone())},this)},boundingBox:function(){return this.bounds().top()<0&&(this.bounds().setTop(0),this.bounds(this.bounds())),this.bounds()},sortReplies:function(inputReplies,serverTime){var i,reply,unsortedReplies=[];for(i=0;i<inputReplies.length;i++){var r=new AnnotationReply(inputReplies[i],serverTime);unsortedReplies.push(r)}var parentReplyGuid;for(i=0;i<unsortedReplies.length;i++)reply=unsortedReplies[i],this.calculateReplyLevel(reply,unsortedReplies);var sortedReplies=[],replyLevel=0,repliesMoved=0;parentReplyGuid=null;for(var repliesMovedForThisLevel=!1,replyQuantity=unsortedReplies.length,parentReplyGuids=[];replyQuantity>repliesMoved;){do for(repliesMovedForThisLevel=!1,i=0;i<unsortedReplies.length;i++)if(reply=unsortedReplies[i],reply.replyLevel==replyLevel&&(reply.parentReplyGuid()==parentReplyGuid||0==replyLevel)){sortedReplies.push(reply),repliesMoved++,repliesMovedForThisLevel=!0,parentReplyGuids.push(parentReplyGuid),parentReplyGuid=reply.guid(),unsortedReplies.splice(i,1),replyLevel++;break}while(repliesMovedForThisLevel);parentReplyGuid=parentReplyGuids.pop(),replyLevel--}for(i=0;i<sortedReplies.length;i++)this.pushReply(sortedReplies[i])},activateLastReply:function(){var count=this.replies().length;this.activeReply(count-1)},deactivateActiveReply:function(){this.activeReply(-1)},pushReply:function(reply){reply.index=this.replies().length,this.replies.push(reply),0!=reply.replyLevel||reply.isEmpty()||(this.comments.push(reply),this.comments.sort(function(left,right){var leftTime=left.repliedOn,rightTime=right.repliedOn;return leftTime==rightTime?0:leftTime>rightTime?1:-1}))},addReply:function(userGuid,userName){var reply=new AnnotationReply({userGuid:userGuid,userName:userName,text:"",repliedOn:new Date});this.pushReply(reply),this.activateLastReply()},addReplyFromAnotherUser:function(reply){1==this.replies().length&&this.replies()[0].userGuid==reply.userGuid&&(this.replies.remove(this.replies[0]),this.replies().length=0),reply.guid=reply.replyGuid;var r=new AnnotationReply(reply,new Date(reply.serverTime));this.calculateReplyLevel(r,this.replies());var replyCount=this.replies().length;return replyCount>0&&this.replies()[replyCount-1].isEmpty()?(this.replies()[replyCount-1].index++,this.activeReply()>=replyCount-1&&this.activeReply(this.activeReply()+1),r.index=replyCount-1,this.replies.splice(-1,0,r),0==r.replyLevel&&this.comments.push(r)):(this.pushReply(r),this.deactivateActiveReply()),r},getActiveReply:function(){var index=this.activeReply();return this.getReplyAt(index)},setActiveReply:function(reply){var index=$.inArray(reply,this.replies());this.activeReply(index)},setActiveReplyIndex:function(replyIndex){this.activeReply(replyIndex)},getReplyAt:function(index){return 0>index||index>=this.replies().length?null:this.replies()[index]},updateReply:function(replyGuid,text){var reply=this.findReply(replyGuid);reply&&reply.text(text)},deleteAllReplies:function(){this.replies.removeAll(),this.comments.removeAll()},makeEmpty:function(){var reply=new AnnotationReply({text:"",repliedOn:"",userName:""});this.replies([reply])},findReply:function(replyGuid){for(var i=0;i<this.replies().length;i++)if(this.replies()[i].guid()==replyGuid)return this.replies()[i];return null},findReplyInArray:function(array,replyGuid){for(var i=0;i<array.length;i++)if(array[i].guid()==replyGuid)return array[i];return null},createConnectingLine:function(canvas,startX,startY,endX,endY,skipX,endX2){this.removeConnectingLine();var offsetLeft=20,offsetRight=10;this.displayBounds();this.connectingLine=canvas.path(window.jGroupdocs.stringExtensions.format("M{0},{1}L{2},{3}L{4},{5}L{6},{7}m{8},0L{9},{7}",startX,startY,endX-offsetLeft,startY,endX-offsetRight,endY,endX,endY,skipX,endX2)),this.connectingLine.attr({"stroke-opacity":1}),this.connectingLine.attr({"stroke-width":1}),this.setLineColorToInactive()},setLineColorToActive:function(){this.changeConnectingLineColor("#D3480D"),this.changeConnectingLineDash("")},setLineColorToInactive:function(){this.changeConnectingLineColor("#000"),this.changeConnectingLineDash(". ")},changeConnectingLineColor:function(color){null!=this.connectingLine&&this.connectingLine.attr({stroke:color})},changeConnectingLineDash:function(dashString){null!=this.connectingLine&&this.connectingLine.attr({"stroke-dasharray":dashString})},removeConnectingLine:function(){null!=this.connectingLine&&(this.connectingLine.remove(),this.connectingLine=null)},insertReplyAfterAnotherReply:function(existingReply,newReply){if(null==existingReply)this.pushReply(newReply);else{for(var existingReplyIndex=this.replies.indexOf(existingReply),lastChildOfParent=existingReplyIndex,i=0;i<this.replies().length;i++)this.replies()[i].parentReplyGuid()==existingReply.guid()&&(lastChildOfParent=i);this.replies.splice(lastChildOfParent+1,0,newReply)}},calculateReplyLevel:function(reply,replyArray){reply.replyLevel=0;for(var parentReplyGuid=reply.parentReplyGuid();null!=parentReplyGuid;){var parentReply=this.findReplyInArray(replyArray,parentReplyGuid);null==parentReply?parentReplyGuid=null:(0==reply.replyLevel&&parentReply.childReplies.push(reply),parentReplyGuid=parentReply.parentReplyGuid(),reply.replyLevel++)}},checkReplyHasChildren:function(replyGuid){for(var i=0;i<this.replies().length;i++)if(this.replies()[i].parentReplyGuid()==replyGuid)return!0;return!1},getReplyDescendants:function(replyGuid){for(var parentGuids=[replyGuid],replies=[];parentGuids.length>0;)for(var parentReplyGuid=parentGuids.pop(),i=0;i<this.replies().length;i++){var r=this.replies()[i];r.isEmpty()||r.parentReplyGuid()!=parentReplyGuid||(replies.push(r),parentGuids.push(r.guid()))}return replies}}),annotationModel=function(options){$.extend(this,options),this._init()},$.extend(annotationModel.prototype,docViewerModel.prototype,{createAnnotation:function(fileId,type,message,pageNumber,rectangle,annotationPosition,range,svgPath,drawingOptions,font,callback,errorCallback){this._portalService.createAnnotationAsync($.connection.hub.id,this.userId,this.userKey,fileId,type,message,pageNumber,rectangle,annotationPosition,range,svgPath,drawingOptions,font,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},deleteAnnotation:function(fileId,annotationGuid,callback,errorCallback){this._portalService.deleteAnnotationAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},addAnnotationReply:function(fileId,annotationGuid,message,parentReplyGuid,callback,errorCallback){this._portalService.addAnnotationReplyAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,message,parentReplyGuid,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},editAnnotationReply:function(fileId,annotationGuid,replyGuid,message,callback,errorCallback){this._portalService.editAnnotationReplyAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,replyGuid,message,function(response){response.data&&0!=response.data.success?callback.apply(this,[response]):errorCallback.apply(this,[response.data||{}])}.bind(this),function(error){errorCallback.apply(this,[error])})},restoreAnnotationReplies:function(fileId,annotationGuid,replies,callback,errorCallback){this._portalService.restoreAnnotationRepliesAsync($.connection.hub.id,fileId,annotationGuid,replies,function(response){response.data&&0!=response.data.success?callback.apply(this,[response]):errorCallback.apply(this,[response.data||{}])}.bind(this),function(error){errorCallback.apply(this,[error])})},deleteAnnotationReply:function(fileId,annotationGuid,replyGuid,callback,errorCallback){this._portalService.deleteAnnotationReplyAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,replyGuid,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},listAnnotations:function(fileId,callback,errorCallback){this._portalService.listAnnotationsAsync($.connection.hub.id,this.userId,this.userKey,fileId,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},exportAnnotations:function(fileId,format,mode,callback,errorCallback){this._portalService.exportAnnotationsAsync($.connection.hub.id,fileId,format,mode,function(response){callback.apply(this,[response.data])}.bind(this),function(error){errorCallback.apply(this,[error])}.bind(this))},importAnnotations:function(fileId,saveCurrentAnnotations,callback,errorCallback){this._portalService.importAnnotationsAsync(this.userId,this.userKey,$.connection.hub.id,fileId,saveCurrentAnnotations,function(response){callback.apply(this,[response.data])}.bind(this),function(error){errorCallback.apply(this,[error])}.bind(this))},getPdfVersionOfDocument:function(fileGuid,callback,errorCallback){this._portalService.getPdfVersionOfDocumentAsync($.connection.hub.id,fileGuid,function(response){callback.apply(this,[response.data])}.bind(this),function(error){errorCallback.apply(this,[error])}.bind(this))},getJobOutDoc:function(jobId,callback,errorCallback){this._portalService.getJobOutDocAsync(this.userId,this.userKey,jobId,function(response){callback.apply(this,[response.data])}.bind(this),function(error){errorCallback.apply(this,[error])}.bind(this),!1).Subscribe()},moveAnnotation:function(fileId,annotationGuid,left,top,callback,errorCallback){this._portalService.moveAnnotationAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,left,top,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},resizeAnnotation:function(fileId,annotationGuid,width,height,callback,errorCallback){this._portalService.resizeAnnotationAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,width,height,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},moveAnnotationMarker:function(fileId,annotationGuid,left,top,pageNumber,callback,errorCallback){this._portalService.moveAnnotationMarkerAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,left,top,pageNumber,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},setAnnotationAccess:function(fileId,annotationGuid,annotationAccess,callback,errorCallback){this._portalService.setAnnotationAccessAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,annotationAccess,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},getDocumentCollaborators:function(fileId,successCallback){var response={};return response=this._portalService.getDocumentCollaboratorsSync(this.userId,this.userKey,fileId)},setDocumentCollaborators:function(fileId,collaboratorNames,successCallback,errorCallback){this._portalService.setDocumentCollaboratorsAsync(this.userId,this.userKey,fileId,"2",collaboratorNames,function(response){successCallback.apply(this,[response])}.bind(this),function(error){errorCallback.apply(this,[error.Reason])})},addDocumentReviewer:function(fileId,reviewerEmail,reviewerFirstName,reviewerLastName,reviewerInvitationMessage,successCallback,errorCallback){jSaaspose.utils.validateEmail(reviewerEmail)?this._portalService.addDocumentReviewerAsync(this.userId,this.userKey,fileId,reviewerEmail,reviewerFirstName,reviewerLastName,reviewerInvitationMessage,function(response){successCallback.apply(this,[response])}.bind(this),function(error){errorCallback.apply(this,[error.Reason])}):errorCallback.apply(this,["You should enter a valid email"])},deleteDocumentReviewer:function(fileId,reviewerId,successCallback,errorCallback){this._portalService.deleteDocumentReviewerAsync(this.userId,this.userKey,fileId,reviewerId,function(response){successCallback.apply(this,[response])}.bind(this),function(error){errorCallback.apply(this,[error.Reason])})},setReviewerRights:function(fileId,collaborators,successCallback,errorCallback){this._portalService.setReviewerRightsAsync($.connection.hub.id,this.userId,this.userKey,fileId,collaborators,function(response){successCallback.apply(this,[response])}.bind(this),function(error){errorCallback.apply(this,[error.Reason])})},setSharedLinkAccessRights:function(fileId,sharedLinkAccessRights,successCallback,errorCallback){this._portalService.setSharedLinkAccessRightsAsync(this.userId,this.userKey,fileId,sharedLinkAccessRights,function(response){successCallback.apply(this,[response])}.bind(this),function(error){errorCallback.apply(this,[error.Reason])})},getReviewerContacts:function(successCallback){this._portalService.getReviewerContactsAsync(this.userId,this.userKey,function(response){successCallback.apply(this,[response])},function(error){jerror("An error has occurred: "+error.Reason)})},setReviewerContacts:function(reviewerContacts,successCallback,errorCallback){this._portalService.setReviewerContactsAsync(this.userId,this.userKey,reviewerContacts,function(response){successCallback.apply(this,[response])}.bind(this),function(error){errorCallback.apply(this,[error.Reason])})},getDocumentPrintView:function(fileId,options,successCallback,errorCallback){var self=this;self._portalService.getDocumentPrintViewAsync($.connection.hub.id,fileId,options,function(response){successCallback.apply(this,[response])}.bind(self),function(error){errorCallback.apply(this,[error.Reason])}.bind(self))}}),annotationViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(annotationViewModel.prototype,docViewerViewModel.prototype,{annotations:ko.observableArray([]),activeAnnotation:null,hoveredAnnotation:null,prevHoveredAnnotation:null,userName:"guest@groupdocs.com",annotationModeObservable:ko.observable(null),_containerElement:null,_designVersion:2,_collaborators:null,newCollaborator:null,newCollaboratorFirstName:null,newCollaboratorLastName:null,reviewerContacts:null,newReviewerContactEmail:null,newReviewerContactFirstName:null,newReviewerContactLastName:null,invited:null,busySavingReviewerRights:null,busySavingReviewerContacts:null,busyAddingReviewer:null,reviewerAutocompleteInputField:null,linkToCollaborate:null,canRedact:null,canDelete:null,canExport:null,canDownload:null,canAnnotate:null,canView:null,currentUserIsDocumentOwner:null,isAnonymousUser:!1,reviewerInvitationMessage:null,iconHeight:22,minimumDistance:45,fixedIconShift:45,draggedMarker:!0,embeddedAnnotation:!1,alwaysOnePageInRow:!0,fullSynchronization:!1,busyDeletingReviewer:null,horizontalCursorPointShift:-10,verticalCursorPointShift:5,isRightPanelEnabled:!0,isTextAnnotationButtonEnabled:!0,isRectangleAnnotationButtonEnabled:!0,isPointAnnotationButtonEnabled:!0,isStrikeoutAnnotationButtonEnabled:!0,isPolylineAnnotationButtonEnabled:!0,isTypewriterAnnotationButtonEnabled:!0,isWatermarkAnnotationButtonEnabled:!0,isTextReplacementAnnotationButtonEnabled:!0,isArrowAnnotationButtonEnabled:!0,isTextRedactionAnnotationButtonEnabled:!0,isResourceRedactionAnnotationButtonEnabled:!0,isTextUnderlineAnnotationButtonEnabled:!0,isDistanceAnnotationButtonEnabled:!0,isMouseBroadcastEnabled:!0,isMasterOfBroadcast:!1,storeAnnotationCoordinatesRelativeToPages:!1,saveReplyOnFocusLoss:!1,anyToolSelection:!0,scrollOnFocus:!0,disconnectUncommented:!1,_undoRedo:null,_create:function(options){this._model=new annotationModel(options),this._init(options)},_init:function(options){var self=this;this.embeddedAnnotation&&(this.pageImageWidth=this.getImageWidthWithoutRightPanel(),this.fullSynchronization&&this.isMasterOfBroadcast&&(this.zoomToFitHeight=!0)),this._undoRedo=new jGroupdocs.AnnotationUndoManager,this.annotations=ko.observableArray([]),this.annotationModeObservable=ko.observable(null),this.newCollaborator=ko.observable(""),this.newCollaboratorFirstName=ko.observable(""),this.newCollaboratorLastName=ko.observable(""),this.invited=ko.observable(!1),this._containerElement=options.graphicsContainerElement,this._collaborators=ko.observableArray([]),this.reviewerContacts=ko.observableArray([]),this.newReviewerContactEmail=ko.observable(""),this.newReviewerContactFirstName=ko.observable(""),this.newReviewerContactLastName=ko.observable(""),this.activeAnnotationInternal=ko.observable(null),this.hoveredAnnotation=ko.observable(null),this.prevHoveredAnnotation=ko.observable(null),this.hoveredAnnotation.subscribe(function(newValue){newValue&&self.prevHoveredAnnotation(newValue)}),this.activeAnnotation=ko.computed({read:function(){return this.activeAnnotationInternal()},write:function(value){var activeAnnotation=this.activeAnnotationInternal();null!=activeAnnotation&&activeAnnotation!=value&&activeAnnotation.setLineColorToInactive&&activeAnnotation.setLineColorToInactive(),null!=value&&(value.setLineColorToActive&&value.setLineColorToActive(),this.scrollToVisible(value)),this.activeAnnotationInternal(value)},owner:this}),this.activeAnnotation(null),this.busySavingReviewerRights=ko.observable(!1),this.busySavingReviewerContacts=ko.observable(!1),this.busyAddingReviewer=ko.observable(!1),this.busyDeletingReviewer=ko.observable(!1),this.canRedact=ko.observable(!1),this.canDelete=ko.observable(!1),this.canExport=ko.observable(!1),this.canDownload=ko.observable(!1),this.canAnnotate=ko.observable(!1),this.canView=ko.observable(!1),this.currentUserIsDocumentOwner=ko.observable(!1),this.isAnonymousUser=ko.observable(!1),this.reviewerInvitationMessage=ko.observable(""),this.draggedMarker=!1,this.embeddedAnnotation&&(this.fixedIconShift=35),this.setupChromeMouseWheelHandler(),this.getCanvas(),AnnotationReply.prototype.baseAvatarUrl=this.baseAvatarUrl,docViewerViewModel.prototype._init.call(this,options)},loadDocument:function(fileId){docViewerViewModel.prototype.loadDocument.call(this,fileId);for(var reviewerContacts=[],i=0;i<this.reviewerContacts().length;i++)reviewerContacts.push(this.reviewerContacts()[i].emailAddress);this.reviewerAutocompleteInputField&&this.reviewerAutocompleteInputField.autocomplete({source:reviewerContacts,select:function(event,ui){$(this).val(ui.item.value),$(this).focus(),$(this).trigger(jQuery.Event("keypress",{which:13}))}}),this._clearAnnotations(),this.getReviewerContacts()},getCanvas:function(){if(null==this._canvas){var raphaelWrapper=$("<div/>").appendTo(this._containerElement).addClass("raphaelWrapper");this._canvas=Raphael(raphaelWrapper[0],"100%","100%")}return this._canvas},setFileId:function(fileId){this.fileId=fileId},listAnnotations:function(){this._model.listAnnotations(this.fileId,function(response){this._onAnnotationsReceived(response.data)}.bind(this),function(error){this._onError(error)}.bind(this))},removeActiveAnnotation:function(){var ann=this.activeAnnotation();ann.isBeingDeleted()||this.removeAnnotation(ann)},removeAnnotation:function(annotation,e){if(null!=annotation.guid){annotation.isBeingDeleted&&annotation.isBeingDeleted(!0);var bounds=annotation.bounds(),pos=annotation.annotationPosition(),annotationGuid=annotation.guid,activeReply=annotation.getActiveReply(),data={creatorGuid:this.userId,guid:annotation.guid,type:annotation.type,fieldText:annotation.fieldText,pageNumber:annotation.pageNumber,box:bounds?{x:bounds.left(),y:bounds.top(),width:bounds.width(),height:bounds.height()}:null,annotationPosition:pos?{x:pos.x,y:pos.y}:null,range:annotation.range,svgPath:annotation.svgPath,drawingOptions:annotation.drawingOptions,replies:annotation.replies(),access:annotation.access,startingPoint:annotation.startingPoint,selectionCounter:annotation.selectionCounter},replies=annotation.getReplyDescendants(null),deleteCommand=new DeleteAnnotationCommand(this._model,this.fileId,data,{onDone:function(response){annotation.isBeingDeleted(!1),null!=activeReply&&null!=activeReply.initialText&&activeReply.initialText.length>=0&&(activeReply.text(activeReply.initialText),activeReply.initialText=null),this._onAnnotationRemoved(annotation)}.bind(this),onDoFailed:this._onError.bind(this),onUndone:function(response){annotationGuid=data.guid=response.data.annotationGuid,annotation.guid=annotationGuid,this._addAnnotation(annotation),this.activeAnnotation(annotation)}.bind(this),onUndoFailed:this._onError.bind(this),onIdsFixedUp:function(ids){if(annotationGuid==ids.oldId)annotationGuid=ids.newId,annotation.guid=annotationGuid;else for(var i=0;i<replies.length;i++)replies[i].guid()==ids.oldId&&replies[i].guid(ids.newId)}.bind(this)},replies);this._undoRedo.executeAsync(deleteCommand)}},deleteActiveAnnotation:function(){var annotation=this.activeAnnotation();annotation.isBeingDeleted()||this.removeAnnotation(annotation)},_onAnnotationRemoved:function(annotation){this.activeAnnotation()==annotation&&this.activeAnnotation(null),annotation.commentsEnabled&&(annotation.removeConnectingLine(),this.deselectTextInRect(annotation.bounds(),!0,annotation.pageNumber,annotation.selectionCounter)),this.annotations.remove(annotation),$(this).trigger("onAnnotationRemoved",[annotation]),annotation.commentsEnabled&&this.preventIconsFromOverlapping()},moveAnnotation:function(annotation,position){null!=annotation.guid&&this._model.moveAnnotation(this.fileId,annotation.guid,position.x,position.y,function(response){}.bind(this),function(error){this._onError(error)}.bind(this))},resizeAnnotation:function(annotation,width,height,originalSize){if(null!=annotation.guid){var oldSize=originalSize,annotationGuid=annotation.guid,resizeCommand=new ResizeAnnotationCommand(this._model,this.fileId,annotation,{onDone:function(response){this.setTextFieldSize(annotation,width,height)}.bind(this),onUndone:function(response){this.setTextFieldSize(annotation,oldSize.width,oldSize.height)}.bind(this),onDoFailed:function(response){this.setTextFieldSize(annotation,oldSize.width,oldSize.height),this._onError.bind(this)}.bind(this),onIdsFixedUp:function(ids){annotationGuid=ids.newId,annotation=this.findAnnotation(annotationGuid)}.bind(this),onUndoFailed:this._onError.bind(this)},{width:width,height:height},oldSize);this._undoRedo.executeAsync(resizeCommand)}},moveAnnotationMarker:function(annotation,position,originalPos){if(null!=annotation.guid){var annotationGuid=annotation.guid,oldPosition=originalPos,triggerEvent=annotation.type==Annotation.prototype.AnnotationType.Area||annotation.type==Annotation.prototype.AnnotationType.Polyline||annotation.type==Annotation.prototype.AnnotationType.ResourcesRedaction||annotation.type==Annotation.prototype.AnnotationType.Arrow||annotation.type==Annotation.prototype.AnnotationType.Distance,moveCommand=new MoveAnnotationCommand(this._model,this.fileId,annotation,{onDone:function(response){this._moveAnnotationMarkerTo(annotation,position,null,triggerEvent)}.bind(this),onUndone:function(response){this._moveAnnotationMarkerTo(annotation,originalPos,null,triggerEvent)}.bind(this),onDoFailed:function(response){this._moveAnnotationMarkerTo(annotation,originalPos,null,triggerEvent),this._onError.bind(this)}.bind(this),onIdsFixedUp:function(ids){annotationGuid=ids.newId,annotation=this.findAnnotation(annotationGuid)}.bind(this),onUndoFailed:this._onError.bind(this)},position,oldPosition);this._undoRedo.executeAsync(moveCommand)}},createTextAnnotation:function(pageNumber,bounds,position,length,selectionCounter,rects){var color="string"==typeof this.highlightColor?parseInt(this.highlightColor.replace("#","0x")):null;this.createAnnotation(Annotation.prototype.AnnotationType.Text,pageNumber,bounds,position,length,null,null,selectionCounter,{brushColor:color},rects,null,null)},createAnnotation:function(type,pageNumber,bounds,position,length,markerFigure,svgPath,selectionCounter,drawingOptions,rects,fieldText,font){markerFigure||(markerFigure=null);var startingPoint,box={x:bounds.left(),y:bounds.top(),width:bounds.width(),height:bounds.height()},offsets=this.getPageImageOffsets(type),annotationTextBoxPosition={x:this.pageWidth(),y:bounds.top()},containerWidth=this.graphicsContainerElement.width(),textBoxWidth=265,margin=10,scrollbarWidth=10,scale=this.scale();if(annotationTextBoxPosition.x*scale+textBoxWidth>containerWidth-scrollbarWidth)if(annotationTextBoxPosition.x=(containerWidth-scrollbarWidth-textBoxWidth-offsets.offsetX)/scale,markerFigure){var boundingBox=markerFigure.getBBox(!1),screenBounds=new jSaaspose.Rect(boundingBox.x,boundingBox.y,boundingBox.x+boundingBox.width,boundingBox.y+boundingBox.height),selectable=this.getSelectableInstance(),startingPointRaphael=markerFigure.getPointAtLength(0);startingPoint=new jSaaspose.Point(startingPointRaphael.x,startingPointRaphael.y);var absoluteBounds=selectable.convertRectToAbsoluteCoordinates(screenBounds,startingPoint);annotationTextBoxPosition.y=absoluteBounds.bottom()+margin/scale}else annotationTextBoxPosition.y=box.y+box.height+margin;var range=null;if(null!=position&&null!=length&&(range={position:position,length:length}),rects&&rects.length){var points=[],h=this.unscaledPageHeight;$.each(rects,function(){points.push({x:this.left(),y:h-this.top()}),points.push({x:this.right(),y:h-this.top()}),points.push({x:this.left(),y:h-this.bottom()}),points.push({x:this.right(),y:h-this.bottom()})}),svgPath=JSON.stringify(points)}var annotation=null,annotationGuid="",data={guid:"",type:type,fieldText:fieldText,pageNumber:pageNumber,box:box,annotationPosition:annotationTextBoxPosition,range:range,svgPath:svgPath,drawingOptions:drawingOptions,fontFamily:font?font.family:null,fontSize:font?font.size:null},createCommand=new CreateAnnotationCommand(this._model,this.fileId,data,{onDone:function(response){annotationGuid=response.data.annotationGuid,annotation=new Annotation($.extend(data,{guid:annotationGuid,replies:[],creatorGuid:this.userId,access:Annotation.prototype.AnnotationAccess.Public,startingPoint:startingPoint,selectionCounter:selectionCounter})),this.updateAnnotationDisplayPosition(annotation),this._onAnnotationCreated(annotation,markerFigure),this.toolDeactivationMode==ToolDeactivationMode.Auto&&this.setHandToolMode()}.bind(this),onDoFailed:this._onError.bind(this),onUndone:function(response){this._onAnnotationRemoved(annotation),annotationGuid="",markerFigure=null}.bind(this),onUndoFailed:this._onError.bind(this),onIdsFixedUp:function(ids){annotationGuid=annotation.guid=ids.newId,annotation=this.findAnnotation(annotationGuid),markerFigure=null}.bind(this)});this._undoRedo.executeAsync(createCommand)},_onAnnotationCreated:function(annotation,markerFigure){if(!annotation.commentsEnabled)return this.annotations.push(annotation),void $(this).trigger("onAnnotationCreated",[annotation]);annotation.addReply(this.userId,this.userName),this.annotations.push(annotation),this.preventIconsFromOverlapping();var color=annotation.backgroundColor();annotation.selectionCounter=this.selectTextInRect(annotation.bounds(),this.markerClickHandler.bind(this,annotation),annotation.pageNumber,annotation.selectionCounter,color&&color!==undefined?this.getRgbColorFromInteger(color):null,{mouseenter:function(){this.hoveredAnnotation(annotation)}.bind(this),mouseleave:function(){this.hoveredAnnotation(null)}.bind(this)}),this.createConnectingLineAndIcon(annotation),this.activeAnnotation(annotation),$(this).trigger("onAnnotationCreated",[annotation,markerFigure]),annotation.activeReply(0)},createClickHandler:function(markerElement,annotation){$(markerElement).click(this.markerClickHandler.bind(this,annotation))},editAnnotationReply:function(annotationGuid,replyGuid,annotationMessage){var annotation=this.findAnnotation(annotationGuid),reply=annotation.findReply(replyGuid),newText=reply.text(),oldText=annotation.activeReplyData.text(),editReplyCommand=new EditAnnotationReplyCommand(this._model,this.fileId,annotation,{onDone:function(response){reply.text(newText)}.bind(this),onUndone:function(response){reply.text(oldText)}.bind(this),onDoFailed:function(response){reply.text(oldText),this._onError.bind(this)}.bind(this),onUndoFailed:this._onError.bind(this)},reply,newText,oldText);this._undoRedo.executeAsync(editReplyCommand)},restoreAnnotationReplies:function(annotationGuid,replies){this._model.restoreAnnotationReplies(this.fileId,annotationGuid,replies,function(response){}.bind(this),this._onError.bind(this))},deleteAnnotationReply:function(annotationGuid,replyGuid){var annotation=this.findAnnotation(annotationGuid),reply=annotation.findReply(replyGuid),replyDescendants=annotation.getReplyDescendants(replyGuid);deleteReplyCommand=new DeleteAnnotationReplyCommand(this._model,this.fileId,annotation,{onDone:function(response){this._onAnnotationReplyRemoved(response)}.bind(this),onUndone:function(response){this._onAnnotationReplyAdded(annotation,reply,!0,!0);for(var i=0;i<replyDescendants.length;i++)this._onAnnotationReplyAdded(annotation,replyDescendants[i],!0,!0)}.bind(this),onIdsFixedUp:function(ids){if(replyGuid==ids.oldId)replyGuid=ids.newId,reply=annotation.findReply(replyGuid);else if(annotationGuid==ids.oldId)annotationGuid=ids.newId,annotation=this.findAnnotation(annotationGuid);else for(var i=0;i<replyDescendants.length;i++)replyDescendants[i].guid()==ids.oldId?replyDescendants[i].guid(ids.newId):replyDescendants[i].parentReplyGuid()==ids.oldId&&replyDescendants[i].parentReplyGuid(ids.newId)}.bind(this),onDoFailed:this._onError.bind(this),onUndoFailed:this._onError.bind(this)},reply),this._undoRedo.executeAsync(deleteReplyCommand)},_onAnnotationReplyRemoved:function(response){var annotation=this.findAnnotation(response.data.annotationGuid);annotation.deleteAllReplies(),annotation.sortReplies(response.data.replies,new Date(response.data.serverTime)),0==annotation.replies().length&&(annotation.addReply(this.userId,this.userName),annotation.activeReply(0)),this.disconnectUncommented&&0==annotation.replyCount()&&annotation.removeConnectingLine()},deleteReply:function(reply){var annotation=this.activeAnnotation(),replies=annotation.replies();(replies.length>1||1==replies.length&&replies[0].guid())&&annotation.replies.remove(reply),1!=replies.length||replies[0].guid()||reply.text(""),this.disconnectUncommented&&0==annotation.replyCount()&&annotation.removeConnectingLine()},addAnnotationReply:function(annotation,reply,keepFocusedReply){if(annotation.guid&&reply&&reply.text().length){var replyGuid=reply.guid()||"",annotationGuid=annotation.guid,addReplyCommand=new CreateAnnotationReplyCommand(this._model,this.fileId,annotation,{onDone:function(response){reply.guid(response.data.replyGuid),reply.repliedOn=response.data.repliedOn;var redone=null!=replyGuid&&replyGuid!==undefined&&replyGuid.length>0&&replyGuid!=reply.guid();replyGuid=reply.guid(),this._onAnnotationReplyAdded(annotation,reply,keepFocusedReply,redone)}.bind(this),onUndone:function(response){this._onAnnotationReplyRemoved(response)}.bind(this),onIdsFixedUp:function(ids){replyGuid==ids.oldId?(replyGuid=ids.newId,annotation.findReply(replyGuid)):annotationGuid==ids.oldId&&(annotationGuid=ids.newId,annotation=this.findAnnotation(annotationGuid))}.bind(this),onDoFailed:this._onError.bind(this),onUndoFailed:this._onError.bind(this)},reply);this._undoRedo.executeAsync(addReplyCommand)}},commitAnnotationReplyOnBlur:function(annotation,keepFocusedReply,reply){
return this.saveReplyOnFocusLoss?this.commitAnnotationReply(annotation,keepFocusedReply,reply):void 0},commitAnnotationReply:function(annotation,keepFocusedReply,reply){var activeReply=reply;if(activeReply||(activeReply=annotation.getActiveReply()),activeReply)if(annotation.deactivateActiveReply(),activeReply.guid()&&activeReply.guid().length){var text=jGroupdocs.html.toText(activeReply.text());this.editAnnotationReply(annotation.guid,activeReply.guid(),text)}else this.addAnnotationReply(annotation,activeReply,keepFocusedReply)},activateAnnotationReply:function(annotation,replyInex){var reply=annotation.getReplyAt(replyInex);reply&&reply.userName==this.userName&&annotation.activeReply(replyInex)},exportAnnotations:function(){this.exportingAnnotationsProgress.modal("show"),this._model.exportAnnotations(this.fileId,"Pdf",Annotation.prototype.AnnotationExportMode.Append,function(response){response.success?this._onExportJobScheduled(response.jobId):(this.exportingAnnotationsProgress.modal("hide"),this._onError({Reason:response.error}))}.bind(this),function(error){this._onError(error)})},chooseImportFormat:function(){this.choosingImportFormat.modal("show")},importAnnotations:function(format){this.importDocumentAnnotations(this.fileId,format)},importDocumentAnnotations:function(fileId,format){this.choosingImportFormat&&this.choosingImportFormat.modal("hide"),this.importingAnnotationsProgress&&this.importingAnnotationsProgress.modal("show"),this._model.importAnnotations(fileId,format,function(response){response.success?this._onAnnotationsImported(response):(this.importingAnnotationsProgress.modal("hide"),this._onError({Reason:response.error}))}.bind(this),function(error){this._onError(error)}.bind(this))},_onAnnotationsImported:function(response){this.importingAnnotationsProgress.modal("hide")},getPdfVersionOfDocument:function(){this.exportingAnnotationsProgress.modal("show"),this._model.getPdfVersionOfDocument(this.fileId,function(response){response.success?response.original?(this.exportingAnnotationsProgress.modal("hide"),window.location.href=response.original):this._onExportJobScheduled(response.jobId):(this.exportingAnnotationsProgress.modal("hide"),this._onError({Reason:response.error}))}.bind(this),function(error){this._onError(error)})},setAnnotationMode:function(mode){var selectable=this.getSelectable();null!=selectable&&(selectable.dvselectable("setMode",mode),selectable.dvselectable("setTextSelectionMode",this.textSelectionByCharModeEnabled))},setTextAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectText),this.annotationModeObservable(Annotation.prototype.AnnotationType.Text)},setAreaAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectRectangle),this.annotationModeObservable(Annotation.prototype.AnnotationType.Area)},setPointAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.ClickPoint),this.annotationModeObservable(Annotation.prototype.AnnotationType.Point)},setStrikeoutTextMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectTextToStrikeout),this.annotationModeObservable(Annotation.prototype.AnnotationType.TextStrikeout)},setPolylineAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.TrackMouseMovement),this.annotationModeObservable(Annotation.prototype.AnnotationType.Polyline)},setTextFieldAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectRectangle),this.annotationModeObservable(Annotation.prototype.AnnotationType.TextField)},setWatermarkAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectRectangle),this.annotationModeObservable(Annotation.prototype.AnnotationType.Watermark)},setHandToolMode:function(){this.setAnnotationMode(this.textSelectionEnabled===!0?$.ui.dvselectable.prototype.SelectionModes.SelectText:$.ui.dvselectable.prototype.SelectionModes.DoNothing),this.annotationModeObservable(null)},addAnnotationFromAnotherUser:function(data){var annotation=new Annotation({pageNumber:data.pageNumber,box:data.box,annotationPosition:data.annotationPosition,documentGuid:this.fileId,guid:data.annotationGuid,replies:[],type:data.annotationType,svgPath:data.svgPath,creatorGuid:data.userGuid,access:data.access,penColor:data.drawingOptions?data.drawingOptions.penColor:null,penWidth:data.drawingOptions?data.drawingOptions.penWidth:null,penStyle:data.drawingOptions?data.drawingOptions.penStyle:null,backgroundColor:data.drawingOptions?data.drawingOptions.brushColor:null,fontSize:data.font?data.font.size:null,fontFamily:data.font?data.font.family:null},new Date(data.serverTime));return this.updateAnnotationDisplayPosition(annotation),this.annotations.push(annotation),annotation.commentsEnabled&&(annotation.addReply(this.userId,this.userName),this.preventIconsFromOverlapping(),(annotation.type==Annotation.prototype.AnnotationType.Text||annotation.type==Annotation.prototype.AnnotationType.TextReplacement)&&this.selectTextForAnnotation(annotation),this.createConnectingLineAndIcon(annotation)),annotation},findAnnotation:function(guid){for(var annotation=null,i=0;i<this.annotations().length;i++)if(this.annotations()[i].guid==guid){annotation=this.annotations()[i];break}return annotation},_indexOfAnnotation:function(guid){for(var i=0;i<this.annotations().length;i++)if(this.annotations()[i].guid==guid)return i;return-1},_getAnnotationAt:function(index){return index>=0&&index<this.annotations().length?this.annotations()[index]:null},addAnnotationReplyFromAnotherUser:function(rawReply){var annotation=this.findAnnotation(rawReply.annotationGuid);annotation.addReplyFromAnotherUser(rawReply);1==annotation.replyCount()&&this.createConnectingLineAndIcon(annotation)},editAnnotationReplyOnClient:function(annotationGuid,replyGuid,message){this.findAnnotation(annotationGuid).updateReply(replyGuid,message)},deleteAnnotationReplyOnClient:function(annotationGuid,replyGuid,replies){var annotation=this.findAnnotation(annotationGuid);annotation.deleteAllReplies(),annotation.sortReplies(replies),0==annotation.replies().length&&annotation.addReply(this.userId,this.userName),this.disconnectUncommented&&0==annotation.replyCount()&&annotation.removeConnectingLine()},clearAllAnnotationOnClient:function(){for(;this.annotations().length>0;){var annotation=this.annotations()[0];this.deleteAnnotationOnClient(annotation.guid)}},deleteAnnotationOnClient:function(annotationGuid){for(var i=0;i<this.annotations().length;i++){var annotation=this.annotations()[i];if(annotation.guid==annotationGuid){this.activeAnnotation()==annotation&&this.activeAnnotation(null),this.deselectTextInRect(annotation.bounds(),!0,annotation.pageNumber,annotation.selectionCounter),annotation.removeConnectingLine(),this.annotations.splice(i,1);break}}},setAnnotationAccessOnClient:function(annotationGuid,annotationAccess,annotation){var screenAnnotation=this.findAnnotation(annotationGuid);null!=screenAnnotation&&screenAnnotation.creatorGuid==this.userId?screenAnnotation.annotationIsPublic(annotationAccess==Annotation.prototype.AnnotationAccess.Public):annotationAccess==Annotation.prototype.AnnotationAccess.Private?null!=screenAnnotation&&this.deleteAnnotationOnClient(annotationGuid):annotationAccess==Annotation.prototype.AnnotationAccess.Public&&this._onAnnotationsReceived({annotations:[annotation]},!0)},_onAnnotationsReceived:function(response,appendOnly){var list=[],selectable=this.getSelectableInstance(),pages=selectable.getPages(),pageCount=pages?pages.length:0;if(response.annotations)for(var i=0;i<response.annotations.length;i++)if(!(response.annotations[i].pageNumber>=pageCount)){var annotation=new Annotation(response.annotations[i],new Date(response.serverTime));this._onAnnotationReceived(annotation),list.push(annotation)}appendOnly?list=this.annotations().concat(list):this._clearAnnotations(),this.annotations(list),this.preventIconsFromOverlapping(),$(this).trigger("onAnnotationsReceived",[list])},_onAnnotationReceived:function(annotation){this.updateAnnotationDisplayPosition(annotation),annotation.commentsEnabled&&(0==annotation.replies().length?(annotation.addReply(this.userId,this.userName),annotation.setActiveReplyIndex(0)):annotation.setActiveReplyIndex(-1),(annotation.type==Annotation.prototype.AnnotationType.Text||annotation.type==Annotation.prototype.AnnotationType.TextReplacement)&&this.selectTextForAnnotation(annotation),this.createConnectingLineAndIcon(annotation)),$(this).trigger("onAnnotationReceived",[annotation])},_addAnnotation:function(annotation){this._onAnnotationReceived(annotation),this.annotations.push(annotation),this.preventIconsFromOverlapping(),$(this).trigger("onAnnotationsReceived",[annotation])},_clearAnnotations:function(){for(var annotations=this.annotations(),j=0;j<annotations.length;j++)annotations[j].removeConnectingLine(),$(this).trigger("onAnnotationRemoved",[annotations[j]]);this.activeAnnotation(null),this.annotations.removeAll(),this._undoRedo.clear()},markerClickHandler:function(annotation){this.anyToolSelection!==!0&&null!=this.annotationModeObservable()||this.draggedMarker||this.activeAnnotation(annotation),this.draggedMarker=!1},_onAnnotationReplyAdded:function(annotation,reply,keepFocusedReply,redone){var replyCount=annotation.replyCount();0==replyCount&&annotation.deleteAllReplies(),redone&&annotation.pushReply(reply),(1==replyCount||redone&&0==replyCount)&&(redone||annotation.comments.push(reply),this.createConnectingLineAndIcon(annotation)),$(this).trigger("onAnnotationReplyAdded",[annotation,reply])},_onExportJobScheduled:function(jobId){this._model.getJobOutDoc(jobId,function(doc){doc?(this.exportingAnnotationsProgress.modal("hide"),doc.error?jerror("Sorry, the conversion is failed. A notification has been sent to the GroupDocs Support Team."):window.location.href=doc.url):window.setTimeout(function(){this._onExportJobScheduled(jobId)}.bind(this),2e3)}.bind(this),function(node,error){this.inprogress(!1),jerror()})},selectTextForAnnotation:function(annotation){var selectable=this.getSelectable(),selectionMode=selectable.dvselectable("getMode"),color=annotation.backgroundColor();selectable.dvselectable("setMode",$.ui.dvselectable.prototype.SelectionModes.SelectText,!0),annotation.selectionCounter=this.selectTextInRect(annotation.bounds(),this.markerClickHandler.bind(this,annotation),annotation.pageNumber,undefined,color&&color!==undefined?this.getRgbColorFromInteger(color):null,{mouseenter:function(){this.hoveredAnnotation(annotation)}.bind(this),mouseleave:function(){this.hoveredAnnotation(null)}.bind(this)}),selectable.dvselectable("setMode",selectionMode)},getPageImageOffsets:function(annotationType){var offsets={offsetX:0,offsetY:0};return annotationType!=Annotation.prototype.AnnotationType.TextStrikeout&&annotationType!=Annotation.prototype.AnnotationType.TextField&&annotationType!=Annotation.prototype.AnnotationType.Watermark&&annotationType!=Annotation.prototype.AnnotationType.TextRemoval&&annotationType!=Annotation.prototype.AnnotationType.TextRedaction&&annotationType!=Annotation.prototype.AnnotationType.TextUnderline&&(offsets.offsetX=this.getPageImageHorizontalOffset(),offsets.offsetY=this.getPageImageVerticalOffset()),offsets},getPageImageHorizontalOffset:function(){var leftImageMargin=34;return leftImageMargin},getPageImageVerticalOffset:function(){var pagePadding=6;return pagePadding},moveAnnotationOnClient:function(annotationGuid,position){var annotation=this.findAnnotation(annotationGuid);null!=annotation&&(annotation.annotationPosition(new jSaaspose.Point(position.x,position.y)),this.createConnectingLineAndIcon(annotation,!1))},moveAnnotationMarkerOnClient:function(annotationGuid,position,pageNumber){var annotationBounds,annotation=this.findAnnotation(annotationGuid);null!=annotation&&(annotationBounds=annotation.bounds().clone(),this._moveAnnotationMarkerTo(annotation,position,pageNumber,!1)),$(this).trigger("onAnnotationMarkerMovedOnClient",[annotationGuid,position,pageNumber,annotationBounds])},_moveAnnotationMarkerTo:function(annotation,position,pageNumber,triggerEvent,responseData){var annotationBounds=annotation.bounds().clone();annotation.bounds(new jSaaspose.Rect(position.x,position.y,position.x+annotationBounds.width(),position.y+annotationBounds.height())),pageNumber&&(annotation.pageNumber=pageNumber),this.updateAnnotationDisplayPosition(annotation),this.preventIconsFromOverlapping(),this.createConnectingLineAndIcon(annotation),1==triggerEvent&&$(this).trigger("onAnnotationMarkerMovedOnClient",[annotation.guid,position,pageNumber||annotation.pageNumber,annotationBounds])},createConnectingLineAndIcon:function(annotation,createIcon,beforeSwitchingPanels){(0==this.disconnectUncommented||annotation.replyCount())&&annotation.commentsEnabled&&(this.createConnectingLine(annotation,beforeSwitchingPanels),createIcon&&this.createRightSideIcon(annotation))},createConnectingLine:function(annotation,beforeSwitchingPanels){var iconWidth=iconHeight=this.iconHeight,visiblePanel=this.rightSideElement.children(beforeSwitchingPanels?":hidden":":visible"),rightOffset=visiblePanel.width(),result=this.getAnnotationSideIconCoordinates(annotation),iconLeft=Math.round(this.pageLeft()+this.getAnnotationSideIconLeft()),rightEdge=Math.max(annotation.displayBounds().left(),annotation.displayBounds().right());annotation.createConnectingLine(this.getCanvas(),Math.round(rightEdge+(annotation.penWidth||2)/2),result.iconMiddle,iconLeft,Math.round(annotation.annotationSideIconDisplayPosition().y+iconHeight/2),iconWidth,this.documentSpace.outerWidth()-rightOffset),this.activeAnnotation()==annotation&&annotation.setLineColorToActive()},redrawConnectingLines:function(beforeSwitchingPanels){for(var i=0;i<this.annotations().length;i++)this.createConnectingLineAndIcon(this.annotations()[i],!1,beforeSwitchingPanels)},createRightSideIcon:function(annotation){var result=this.getAnnotationSideIconCoordinates(annotation);annotation.annotationOriginalTextBoxDisplayPosition(new jSaaspose.Point(this.getAnnotationSideIconLeft(),result.iconTop))},getAnnotationSideIconCoordinates:function(annotation){var iconTop,iconMiddle,iconHeight=this.iconHeight,bounds=annotation.displayBounds();if(this.connectorPosition!=Annotation.prototype.ConnectorPosition.Middle||annotation.type!=Annotation.prototype.AnnotationType.Text&&annotation.type!=Annotation.prototype.AnnotationType.TextReplacement)if(this.connectorPosition==Annotation.prototype.ConnectorPosition.Middle)iconTop=Math.round(bounds.top()-(iconHeight-bounds.height())/2),iconMiddle=Math.round(bounds.top()+bounds.height()/2);else{var offset=annotation.type==Annotation.prototype.AnnotationType.Point?14:(annotation.penWidth||1)/2-1,bottom=Math.max(bounds.top(),bounds.bottom());iconTop=Math.round(bottom-iconHeight/2+offset),iconMiddle=Math.round(bottom+offset)}else{for(var selectable=this.getSelectableInstance(),rect=null,minTop=null,maxBottom=null,rects=selectable.getRowsFromRect(bounds),i=0;i<rects.length;i++)rect=rects[i].bounds,(null==minTop||rect.top()<minTop)&&(minTop=rect.top()),(null==maxBottom||rect.bottom()>maxBottom)&&(maxBottom=rect.bottom());var annotationMarkerHeight=maxBottom-minTop;iconTop=Math.round(minTop-(iconHeight-annotationMarkerHeight)/2),iconMiddle=Math.round(minTop+annotationMarkerHeight/2)}return{iconTop:iconTop,iconMiddle:iconMiddle}},getAnnotationSideIconLeft:function(){var iconWidth=this.iconHeight;return Math.round(this.pageWidth()+this.imageHorizontalMargin-iconWidth)},setupRemoveAnnotationMenu:function(contextMenu){$("html").click(function(){return contextMenu.remove(),!1})},setZoom:function(value){var activeAnnot=this.activeAnnotation();this.activeAnnotation(null),this.redrawScreenWhenZooming(value),this.fullSynchronization&&this.isZoomBroadcastEnabled&&this.isMasterOfBroadcast&&this.broadcastDocumentScale(),this.activeAnnotation(activeAnnot)},broadcastDocumentScale:function(){var windowPercentage=this.pageHeight()/this.documentSpace[0].clientHeight*100;$.connection.annotationHub.server.broadcastDocumentScale(this.userId,this.userKey,this.fileId,windowPercentage)},redrawScreenWhenZooming:function(value){docViewerViewModel.prototype.setZoom.call(this,value,!0),this.redrawWorkingArea()},resizePagesToWindowSize:function(){if(this.embeddedAnnotation&&this.fullSynchronization&&this.isMasterOfBroadcast){var pageWidth=this.getImageWidthWithoutRightPanel();if(pageWidth!=this.initialWidth){var currentZoom=this.zoom();this.initialWidth=pageWidth,this.pageImageWidth=pageWidth,docViewerViewModel.prototype.setZoom.call(this,currentZoom,!0)}}},redrawWorkingArea:function(){this.reInitSelectable(),this.recalculatePageLeft();for(var annotationCount=this.annotations().length,i=0;annotationCount>i;i++){var annotation=this.annotations()[i];this.updateAnnotationDisplayPosition(annotation),this.createConnectingLineAndIcon(annotation)}this.preventIconsFromOverlapping(),$(this).trigger("onSetZoom",[this.zoom()])},setDocumentScaleOnClient:function(windowPercentage){var height=windowPercentage/100*this.documentSpace[0].clientHeight,zoom=height/(this.pageImageWidth*this.heightWidthRatio)*100;this.redrawScreenWhenZooming(zoom)},setDocumentScrollOnClient:function(horizontalScrollPosition,verticalScrollPosition,scale){this.setDocumentScrollCalled=!0,this.synchronizeDocumentScroll(horizontalScrollPosition,verticalScrollPosition,scale)},synchronizeDocumentScroll:function(horizontalScrollPortion,scrollTop,scale){var documentSpace=this.documentSpace[0],firstPageTop=parseInt(this._firstPage.css("padding-top")),pagePadding=firstPageTop,maxScrollLeft=documentSpace.scrollWidth-documentSpace.clientWidth,imageMargin=this.getImageMargin(),pageHeightInSenderScale=this.pageHeight()/this.scale()*scale,pageNumber=Math.floor(scrollTop/(pageHeightInSenderScale+imageMargin)),ourTop=(scrollTop-pagePadding-pageNumber*imageMargin)/scale*this.scale()+pagePadding+pageNumber*imageMargin;this.documentSpace[0].scrollLeft=maxScrollLeft*horizontalScrollPortion,this.documentSpace[0].scrollTop=ourTop},ScrollDocViewEnd:function(item,e){docViewerViewModel.prototype.ScrollDocViewEnd.call(this,item,e),this.setDocumentScrollCalled||this.broadcastDocumentScroll(),this.setDocumentScrollCalled=!1},broadcastDocumentScroll:function(){if(this.fullSynchronization&&this.isScrollBroadcastEnabled&&this.isMasterOfBroadcast){var horizontalScrollPortion,horizontalScrollPosition=this.scrollPosition[0],verticalScrollPosition=this.scrollPosition[1],scale=this.scale(),documentSpace=this.documentSpace[0],maxScrollLeft=documentSpace.scrollWidth-documentSpace.clientWidth;horizontalScrollPortion=0==maxScrollLeft?0:horizontalScrollPosition/maxScrollLeft,$.connection.annotationHub.server.broadcastDocumentScroll(this.userId,this.userKey,this.fileId,horizontalScrollPortion,verticalScrollPosition,scale)}},broadcastMouseCursorPosition:function(left,top){if(this.fullSynchronization&&this.isMasterOfBroadcast){var scale=this.scale(),scrollTop=this.documentSpace[0].scrollTop,documentSpaceTop=this.documentSpace.offset().top,documentPageLeft=this._firstPage.find(".page-image").offset().left-this._firstPage.parent().offset().left;$.connection.annotationHub.server.broadcastMouseCursorPosition(this.userId,this.userKey,this.fileId,left-documentPageLeft,top-documentSpaceTop,scale,scrollTop)}},setMousePositionOnClient:function(left,top,scale,scrollTop){var pointer=$("#cursor_hand"),documentSpaceTop=this.documentSpace.offset().top,firstPageTop=parseInt(this._firstPage.css("padding-top")),pagePadding=firstPageTop,ourLeft=left,ourTop=top;ourLeft=left/scale*this.scale();var imageMargin=this.getImageMargin(),pageHeightInSenderScale=this.pageHeight()/this.scale()*scale,pageNumber=Math.floor((scrollTop+top)/(pageHeightInSenderScale+imageMargin));ourTop=(top-pagePadding-pageNumber*imageMargin)/scale*this.scale()+pagePadding+pageNumber*imageMargin,ourLeft+=this.horizontalCursorPointShift,ourLeft+=this._firstPage.find(".page-image").offset().left-this._firstPage.parent().offset().left,ourTop+=documentSpaceTop;var ourScrollTop=this.documentSpace[0].scrollTop;ourTop+=scrollTop/scale*this.scale()-ourScrollTop,ourTop+=this.verticalCursorPointShift,pointer.css({left:ourLeft,top:ourTop})},getImageMargin:function(){var imageMargin=this._firstPage.outerHeight(!0)-this._firstPage.find(".page-image").height();return imageMargin},updateAnnotationDisplayPosition:function(annotation){var bounds=annotation.boundingBox();bounds!=annotation.bounds()&&(bounds.topLeft.y=this.unscaledPageHeight-bounds.topLeft.y,bounds.bottomRight.y=this.unscaledPageHeight-bounds.bottomRight.y),bounds=this.storeAnnotationCoordinatesRelativeToPages?this.convertPageAndRectToScreenCoordinates(annotation.pageNumber,bounds):this.convertRectToScreenCoordinates(bounds),annotation.displayBounds(bounds.round());var result=this.getAnnotationSideIconCoordinates(annotation);annotation.annotationOriginalTextBoxDisplayPosition(new jSaaspose.Point(this.getAnnotationSideIconLeft(),result.iconTop))},convertPointToAbsoluteCoordinates:function(point,pointToFindPageFor){var scale=this.scale(),left=point.x,top=point.y,selectable=this.getSelectableInstance(),page=selectable.findPageAtVerticalPosition(pointToFindPageFor.y);if(null==page)return null;left-=page.rect.left(),top-=page.rect.top();var pageOffset,pageNumber=parseInt(page.pageId)-1;pageOffset=pageNumber*this.getPageHeight(),pageOffset/=scale,left/=scale,top/=scale;var position=new jSaaspose.Point(left,top+pageOffset);return position},convertPointToRelativeToPageUnscaledCoordinates:function(point,pointToFindPageFor){var scale=this.scale(),left=point.x,top=point.y,selectable=this.getSelectableInstance(),page=selectable.findPageAtVerticalPosition(pointToFindPageFor.y);if(null==page)return null;left-=page.rect.left(),top-=page.rect.top(),left/=scale,top/=scale;var position=new jSaaspose.Point(left,top);return position},convertRectToScreenCoordinates:function(rect){var selectable=this.getSelectableInstance();return selectable.convertRectToScreenCoordinates(rect)},convertPageAndRectToScreenCoordinates:function(pageNumber,rect){var selectable=this.getSelectableInstance();return selectable.convertPageAndRectToScreenCoordinates(pageNumber,rect)},annotationIsPublicChangedHandler:function(annotation){return null!=annotation.guid&&(annotation.access=annotation.annotationIsPublic()?0:1,this._model.setAnnotationAccess(this.fileId,annotation.guid,annotation.access,function(response){}.bind(this),function(error){this._onError(error)}.bind(this))),!0},replyOnEnter:function(annotation,event){var keyCode=event.which?event.which:event.keyCode;return 13===keyCode?(this.commitAnnotationReply(annotation),!1):!0},focusOutHandler:function(annotation,reply,e){var target=e&&e.target||e&&e.srcElement;return $(target).is(".annotationButton")||annotation.activeReply()==reply.index&&this.commitAnnotationReply(annotation,!0),!0},saveReplyIfClickedOnAnotherReply:function(clickedAnnotation,clickedReply,event){null==this.activeAnnotation()||this.activeAnnotation()==clickedAnnotation&&clickedAnnotation.activeReply()==clickedReply.index||this.commitAnnotationReply(this.activeAnnotation(),!0),this.activeAnnotation(clickedAnnotation),this.activateAnnotationReply(clickedAnnotation,clickedReply.index)},getDocumentCollaborators:function(fileId){if((fileId||this.fileId)&&!this.anonymousAnnotation){var response=this._model.getDocumentCollaborators(fileId||this.fileId);response.error&&jerror(response.error.Reason);var owner=response.data.owner;this.createReviewersFromResponse(response),this.currentUserIsDocumentOwner(null!=owner&&owner.guid==this.userId),response.data.shared_link_access_rights?this._setAccessRights(response.data.shared_link_access_rights||-1):owner&&this._setAccessRights(owner.access_rights||-1)}},_resetAccessRights:function(){},_setAccessRights:function(access){var canRedact=(32&access)>0,canDelete=(16&access)>0,canExport=(8&access)>0,canDownload=(4&access)>0,canAnnotate=(2&access)>0,canView=(1&access)>0;this.canRedact(canRedact),this.canDelete(canDelete),this.canExport(canExport),this.canDownload(canDownload),this.canAnnotate(canAnnotate),this.canView(canView)},setDocumentCollaborators:function(setReviewerContacts,newCollaborator){if(newCollaborator&&this.newCollaborator(newCollaborator),""!=this.newCollaborator()){this.busyAddingReviewer(!0);var i,collaborator,serverCollaborators=[];for(i=0;i<this._collaborators().length;i++)collaborator=this._collaborators()[i],serverCollaborators.push(collaborator.emailAddress);serverCollaborators.push(this.newCollaborator()),setReviewerContacts&&(this.newReviewerContactEmail(this.newCollaborator()),this.setReviewerContacts()),this._model.setDocumentCollaborators(this.fileId,serverCollaborators,function(response){this.busyAddingReviewer(!1),this.newCollaborator(""),this.createReviewersFromResponse(response),this.invited(!0)}.bind(this),function(error){this.busyAddingReviewer(!1),this.invited(!1),jerror(error)}.bind(this))}},addDocumentReviewer:function(){""!=this.newCollaborator()&&(this.busyAddingReviewer(!0),this._model.addDocumentReviewer(this.fileId,this.newCollaborator(),this.newCollaboratorFirstName(),this.newCollaboratorLastName(),this.reviewerInvitationMessage(),function(response){this.newReviewerContactEmail(this.newCollaborator()),this.newReviewerContactFirstName(""),this.newReviewerContactLastName(""),this.setReviewerContacts(),this.busyAddingReviewer(!1),this.newCollaborator(""),this.createReviewersFromResponse(response),this.invited(!0)}.bind(this),function(error){this.busyAddingReviewer(!1),this.invited(!1),jerror(error)}.bind(this)))},deleteDocumentReviewer:function(reviewer){this.busyDeletingReviewer(!0),this._model.deleteDocumentReviewer(this.fileId,reviewer.id,function(response){this.busyDeletingReviewer(!1),this._collaborators.remove(reviewer)}.bind(this),function(error){this.busyDeletingReviewer(!1),jerror(error)}.bind(this))},createReviewersFromResponse:function(response){function alwaysTrue(){return!0}var canAnnotate,canDownload,canView,canExport,canDelete,canRedact,access,emailAddress,displayName,isOwner,newItems=[],owner=response.data.owner,ownerIsSet=!1,ownerSuffix=" (Owner)",viewModel=this;$.each(response.data.collaborators,function(index,value){access=value.access_rights,emailAddress=value.primary_email,displayName=null!=value.firstName&&null!=value.lastName&&""!=value.firstName&&""!=value.lastName?value.firstName+" "+value.lastName:value.primary_email,owner&&emailAddress==owner.primary_email?(ownerIsSet=!0,canAnnotate=canDownload=canView=canExport=canDelete=canRedact=alwaysTrue,displayName+=ownerSuffix,isOwner=!0):(canRedact=ko.observable((32&access)>0),canDelete=ko.observable((16&access)>0),canExport=ko.observable((8&access)>0),canDownload=ko.observable((4&access)>0),canAnnotate=ko.observable((2&access)>0),canView=ko.observable((1&access)>0),isOwner=!1),value.guid==viewModel.userId&&viewModel._setAccessRights(access>0?access:-1);var reviewer={emailAddress:emailAddress,displayName:displayName,color:ko.observable(value.color),id:value.id,guid:value.guid,canAnnotate:canAnnotate,canDownload:canDownload,canView:canView,canExport:canExport,canDelete:canDelete,canRedact:canRedact,isOwner:isOwner,avatar:value.avatar,avatarUrl:viewModel.baseAvatarUrl+value.guid};isOwner?newItems.splice(0,0,reviewer):newItems.push(reviewer)}),!ownerIsSet&&owner&&(displayName=null!=owner.firstName&&null!=owner.lastName&&""!=owner.firstName&&""!=owner.lastName?owner.firstName+" "+owner.lastName:owner.primary_email,newItems.splice(0,0,{emailAddress:owner.primary_email,displayName:displayName+ownerSuffix,color:ko.observable(owner.color),id:null,guid:owner.guid,canAnnotate:alwaysTrue,canDownload:alwaysTrue,canView:alwaysTrue,canExport:alwaysTrue,canDelete:alwaysTrue,canRedact:alwaysTrue,isOwner:!0,avatarUrl:viewModel.baseAvatarUrl+owner.guid})),this._collaborators(newItems)},getReviewerContacts:function(){this.fileId&&!this.anonymousAnnotation&&this._model.getReviewerContacts(function(response){var newItems=[];$.each(response.data.reviewerContacts,function(index,value){newItems.push({emailAddress:value.emailAddress,firstName:null==value.firstName?"":value.firstName,lastName:null==value.lastName?"":value.lastName})}),this.reviewerContacts(newItems);for(var reviewerContacts=[],i=0;i<this.reviewerContacts().length;i++)reviewerContacts.push(this.reviewerContacts()[i].emailAddress);this.reviewerAutocompleteInputField&&this.reviewerAutocompleteInputField.autocomplete("option","source",reviewerContacts)}.bind(this))},setReviewerContacts:function(){if(""!=this.newReviewerContactEmail()){this.busySavingReviewerContacts(!0);var i,reviewerContact,serverReviewerContacts=[];for(i=0;i<this.reviewerContacts().length;i++)reviewerContact=this.reviewerContacts()[i],serverReviewerContacts.push(reviewerContact);serverReviewerContacts.push({emailAddress:this.newReviewerContactEmail(),firstName:this.newReviewerContactFirstName(),lastName:this.newReviewerContactLastName()}),this._model.setReviewerContacts(serverReviewerContacts,function(response){this.busySavingReviewerContacts(!1);var newItems=[];$.each(response.data.reviewerContacts,function(index,value){newItems.push({emailAddress:value.emailAddress,firstName:null==value.firstName?"":value.firstName,lastName:null==value.lastName?"":value.lastName})}),this.reviewerContacts(newItems),this.newReviewerContactEmail(""),this.newReviewerContactFirstName(""),this.newReviewerContactLastName(""),this.invited(!0)}.bind(this),function(error){this.busySavingReviewerContacts(!1),this.invited(!1),jerror(error)}.bind(this))}},findCollaborator:function(collaboratorGuid){for(var reviewer=null,i=0;i<this._collaborators().length;i++)if(this._collaborators()[i].guid==collaboratorGuid){reviewer=this._collaborators()[i];break}return reviewer},findReviewerByEmail:function(reviewerEmailAddress){for(var reviewer=null,i=0;i<this._collaborators().length;i++)if(this._collaborators()[i].emailAddress==reviewerEmailAddress){reviewer=this._collaborators()[i];break}return reviewer},getLastReplyColor:function(annotation){var replies=annotation.replies();if(replies.length>0){var userGuid=replies[replies.length-1].userGuid;return this.getRgbColorOfReviewer(userGuid)}return jSaaspose.utils.getHexColor(this.getDefaultColor())},getDefaultColor:function(){return 1201033},getLastReplyText:function(annotation){var replies=annotation.replies();if(replies.length>0){var replyText=replies[replies.length-1].text();return jGroupdocs.html.toText(replyText)}return""},_getReviewerColor:function(userGuid){var reviewer=this.findCollaborator(userGuid),color=null;return color=null==reviewer?this.getDefaultColor():reviewer.color()},_getHexReviewerColor:function(userGuid){var color=this._getReviewerColor(userGuid);return null==color?null:jSaaspose.utils.getHexColor(color)},getRgbColorOfReviewer:function(userGuid){var color=this._getReviewerColor(userGuid);return this.getRgbColorFromInteger(color)},getRgbColorFromInteger:function(color){return isNaN(color)?"rgb(255, 255, 255)":"rgb("+(color>>16&255)+","+(color>>8&255)+","+(255&color)+")"},setReviewerRights:function(){this.busySavingReviewerRights(!0);for(var serverCollaborators=[],i=0;i<this._collaborators().length;i++){var collaborator=this._collaborators()[i],serverCollaborator={primary_email:collaborator.emailAddress,color:collaborator.color(),id:collaborator.id,guid:collaborator.guid,access_rights:(collaborator.canRedact()&&collaborator.canView()?32:0)|(collaborator.canDelete()&&collaborator.canView()?16:0)|(collaborator.canExport()&&collaborator.canView()?8:0)|(collaborator.canDownload()&&collaborator.canView()?4:0)|(collaborator.canAnnotate()&&collaborator.canView()?2:0)|(collaborator.canView()?1:0)};serverCollaborators.push(serverCollaborator)}this._model.setReviewerRights(this.fileId,serverCollaborators,function(response){this.currentUserIsDocumentOwner()?this.applySharedLinkAccessRights():this.busySavingReviewerRights(!1)}.bind(this),function(error){
this.busySavingReviewerRights(!1),jerror(error)}.bind(this))},applySharedLinkAccessRights:function(){if(this.currentUserIsDocumentOwner()){this.busySavingReviewerRights(!0);var sharedLinkAccessRights=(this.canRedact()&&this.canView()?32:0)|(this.canDelete()&&this.canView()?16:0)|(this.canExport()&&this.canView()?8:0)|(this.canDownload()&&this.canView()?4:0)|(this.canAnnotate()&&this.canView()?2:0)|(this.canView()?1:0);this._model.setSharedLinkAccessRights(this.fileId,sharedLinkAccessRights,function(response){this.triggerOnReviewerColorsChanged(),this.busySavingReviewerRights(!1)}.bind(this),function(error){this.busySavingReviewerRights(!1),jerror(error)}.bind(this))}},addChildReply:function(annotation,parentReplyGuid){var parentReply=annotation.findReply(parentReplyGuid),replyLevel=0;null!=parentReply&&(replyLevel=parentReply.replyLevel+1);var newReply=new AnnotationReply({parentReplyGuid:parentReplyGuid,userName:this.userName,repliedOn:(new Date).getTime(),userGuid:this.userId,replyLevel:replyLevel});null!=parentReply&&(parentReply.childReplies.push(newReply),annotation.insertReplyAfterAnotherReply(parentReply,newReply)),annotation.setActiveReply(newReply);var scrollbar=$("#comments_scroll, .comments_scroll");scrollbar.length>0&&scrollbar.tinyscrollbar_update("relative")},setReviewersColorsOnClient:function(reviewerDescriptions){for(var i=0;i<reviewerDescriptions.length;i++){var reviewer=this.findReviewerByEmail(reviewerDescriptions[i].emailAddress);null!=reviewer&&reviewer.color(reviewerDescriptions[i].color)}this.triggerOnReviewerColorsChanged()},setReviewersRightsOnClient:function(reviewerDescriptions){for(var i=0;i<reviewerDescriptions.length;i++){var reviewer=this.findReviewerByEmail(reviewerDescriptions[i].emailAddress);if(null!=reviewer){var access=reviewerDescriptions[i].accessRights;reviewer.canRedact((32&access)>0),reviewer.canDelete((16&access)>0),reviewer.canExport((8&access)>0),reviewer.canDownload((4&access)>0),reviewer.canAnnotate((2&access)>0),reviewer.canView((1&access)>0),reviewer.guid==this.userId&&this._setAccessRights(access)}}},triggerOnReviewerColorsChanged:function(){$(this).trigger("onReviewerColorsChanged",[])},preventIconsFromOverlapping:function(){this.annotations.sort(function(left,right){var leftY=left.annotationOriginalTextBoxDisplayPosition().y,rightY=right.annotationOriginalTextBoxDisplayPosition().y;return leftY>rightY?1:rightY>leftY?-1:leftY==rightY?0:void 0});for(var annotation,distance,previousY=null,previousOriginalY=null,minimumDistance=this.minimumDistance,i=0;i<this.annotations().length;i++)annotation=this.annotations()[i],annotation.commentsEnabled&&(null==previousY?annotation.annotationSideIconDisplayPosition().y=annotation.annotationOriginalTextBoxDisplayPosition().y:(distance=annotation.annotationOriginalTextBoxDisplayPosition().y-previousOriginalY,minimumDistance>distance?(distance=minimumDistance,annotation.annotationSideIconDisplayPosition().y=previousY+distance):annotation.annotationOriginalTextBoxDisplayPosition().y>=previousY+minimumDistance?annotation.annotationSideIconDisplayPosition().y=annotation.annotationOriginalTextBoxDisplayPosition().y:(distance=minimumDistance,annotation.annotationSideIconDisplayPosition().y=previousY+distance)),previousY=annotation.annotationSideIconDisplayPosition().y,previousOriginalY=annotation.annotationOriginalTextBoxDisplayPosition().y,annotation.annotationSideIconDisplayPosition().x=annotation.annotationOriginalTextBoxDisplayPosition().x,annotation.annotationSideIconDisplayPosition(annotation.annotationSideIconDisplayPosition()),this.createConnectingLineAndIcon(annotation,!1))},getImageWidthWithoutRightPanel:function(){var rightOffset,visiblePanel=this.rightSideElement.children(":visible");rightOffset=this.isRightPanelEnabled?Math.round(visiblePanel.width()):0;var fixedDistanceBetweenPageAndRightPanel=68;return this.embeddedAnnotation&&this.fullSynchronization&&(this.isRightPanelEnabled?(rightOffset*=2,fixedDistanceBetweenPageAndRightPanel*=2):fixedDistanceBetweenPageAndRightPanel=40),this.documentSpace.width()-rightOffset-fixedDistanceBetweenPageAndRightPanel},setImageWidthWithoutRightPanel:function(){var ratio=null;if(this.embeddedAnnotation){var requiredWidth=this.getImageWidthWithoutRightPanel();ratio=requiredWidth/this.pageImageWidth*100}return ratio},setDocumentScroll:function(verticalScrollPosition){var documentSpace=this.documentSpace[0];documentSpace.scrollTop=verticalScrollPosition},scrollToVisible:function(annotation){var displayPos=null;if(this.scrollOnFocus&&annotation.annotationSideIconDisplayPosition&&null!=(displayPos=annotation.annotationSideIconDisplayPosition())){var topOffset=annotation.replyCount()>0?165:190,scrollTop=Math.max(displayPos.y-topOffset,0),documentSpace=this.documentSpace[0];(displayPos.y<documentSpace.scrollTop||displayPos.y>documentSpace.scrollTop+documentSpace.clientHeight)&&this.setDocumentScroll(scrollTop)}},setupChromeMouseWheelHandler:function(){function chromeMouseWheelHandler(incomingEvent){var delta=0,event=incomingEvent;if(incomingEvent.originalEvent&&(event=incomingEvent.originalEvent),event||(event=window.event),event.wheelDelta?delta=event.wheelDelta/120:event.detail&&(delta=-event.detail/3),delta&&mouseWheelStepPixels>0){var st=self.documentSpace.scrollTop();st-=delta*mouseWheelStepPixels,st<self.documentSpace[0].scrollHeight-self.documentSpace.height()&&$(this).trigger("onBeforeScrollDocView",{position:st})}previousScrollTop=self.documentSpace.scrollTop(),wheelDelta=delta,mouseWheelFired=!0}function chromeScrollHandler(){if(mouseWheelFired&&0!=wheelDelta){var st=self.documentSpace.scrollTop();st<self.documentSpace[0].scrollHeight-self.documentSpace.height()&&(mouseWheelStepPixels=(self.documentSpace.scrollTop()-previousScrollTop)/wheelDelta,0>mouseWheelStepPixels&&(mouseWheelStepPixels=-mouseWheelStepPixels)),mouseWheelFired=!1}}var browserIsChrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase());if(browserIsChrome){var self=this,mouseWheelStepPixels=0,mouseWheelFired=!1,previousScrollTop=0,wheelDelta=0;this.documentSpace.bind("scroll",chromeScrollHandler),this.documentSpace.bind("mousewheel",chromeMouseWheelHandler)}},broadcastMasterResolution:function(){this.fullSynchronization&&this.isMasterOfBroadcast&&this.broadcastDocumentScale()},slaveConnectedHandlerOnClient:function(){this.fullSynchronization&&this.isMasterOfBroadcast&&(this.broadcastDocumentScroll(),this.broadcastDocumentScale())},broadcastSlaveConnected:function(){this.fullSynchronization&&!this.isMasterOfBroadcast&&$.connection.annotationHub.server.broadcastSlaveConnected(this.fileId)},isThereActiveAnnotation:function(){return null!=this.activeAnnotation()},activateNextAnnotation:function(){return this._activateAnnotation(1)},activatePrevAnnotation:function(){return this._activateAnnotation(-1)},_activateAnnotation:function(direction){var annotationCount=this.annotations().length;if(0>=annotationCount)return null;var annotation=this.activeAnnotation();if(null!=annotation){var idx=this._indexOfAnnotation(annotation.guid);annotation=this._getAnnotationAt(idx+direction)}return null==annotation&&(annotation=direction>=0?this.annotations()[0]:this.annotations()[annotationCount-1]),this.activeAnnotation(annotation),annotation}}),$.widget("ui.docAnnotationViewer",$.ui.docViewer,{_create:function(){$.ui.docViewer.prototype._create.call(this);var viewModel=this.getViewModel();viewModel.fileId&&""!==viewModel.fileId||$(".loading_overlay_message").hide(),ko.bindingHandlers.makeDraggable={init:function(element,valueAccessor,allBindingsAccessor,marker){valueAccessor()&&$(element).draggable(valueAccessor())}},ko.bindingHandlers.htmlValue={init:function(element,valueAccessor,allBindingsAccessor){function updateHandler(onToolbar){var modelValue=valueAccessor(),elementValue=$(element).html();if(ko.isWriteableObservable(modelValue))modelValue(elementValue);else{var allBindings=allBindingsAccessor();allBindings._ko_property_writers&&allBindings._ko_property_writers.htmlValue&&allBindings._ko_property_writers.htmlValue(elementValue)}onToolbar?$(element).trigger("koValueUpdatedOnToolbar"):$(element).trigger("koValueUpdated",element)}function updateHandlerNotToolbar(){updateHandler(!1)}function updateHandlerToolbar(){updateHandler(!0)}ko.utils.registerEventHandler(element,"clickoutside",updateHandlerNotToolbar),ko.utils.registerEventHandler(element,"clickoutsideOnToolbar",updateHandlerToolbar),ko.utils.registerEventHandler(element,"blur",updateHandler),ko.utils.registerEventHandler(element,"keyup",updateHandler),ko.utils.registerEventHandler(element,"input",updateHandler)},update:function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor())||"",newInnerHtml=value&&value.length?value.replace(/\n/g,"<br/>"):"";newInnerHtml!=element.innerHTML&&(element.innerHTML=newInnerHtml);var scrollbar=$("#comments_scroll, .comments_scroll");scrollbar.length>0&&scrollbar.tinyscrollbar_update("relative")}},$(document).bind("mousedown",function(event){var activeElement=$(document.activeElement),target=event&&event.target||event&&event.srcElement,activeToolbar=$(".text_area_toolbar").has(activeElement),toolbarWasActive=activeToolbar.length>0;target==document.activeElement||!(activeElement.is("input")||activeElement.is("textarea")||activeElement.is("[contenteditable='true']")||toolbarWasActive)||$(target).is(".annotationButton")||$(target).is(".ta_resize_box")||toolbarWasActive&&activeToolbar.parent().has(target).length>0&&$(target).is(".doc_text_area_text")||(0==$(".text_area_toolbar").has(target).length?activeElement.trigger("clickoutside"):activeElement.trigger("clickoutsideOnToolbar"));var visibleToolbars=$(".text_area_toolbar:visible");return 0!=$(".text_area_toolbar").has(target).length||$(target).is(".doc_text_area_text")||visibleToolbars.trigger("clickoutside"),!0})},_createViewModel:function(){return new annotationViewModel(this.options)}})}(jQuery),jGroupdocs.AnnotationUndoManager=function(){jGroupdocs.UndoManager.prototype.constructor.apply(this,arguments),this.canRedoObservable=ko.observable(!1),this.canUndoObservable=ko.observable(!1),this.busy=ko.computed(function(){return this.canRedoObservable()&&this.canUndoObservable()},this)},$.extend(jGroupdocs.AnnotationUndoManager.prototype,jGroupdocs.UndoManager.prototype,{canRedoObservable:ko.observable(!1),canUndoObservable:ko.observable(!1),busy:null,_onDone:function(command){jGroupdocs.UndoManager.prototype._onDone.apply(this,arguments),this._fixupIds(command),this._refreshObservables()},_onUndone:function(command){jGroupdocs.UndoManager.prototype._onUndone.apply(this,arguments),this._fixupIds(command),this._refreshObservables()},_onDoUndoFailed:function(command){jGroupdocs.UndoManager.prototype._onDoUndoFailed.apply(this,arguments),this._refreshObservables()},_onExecuting:function(){this._refreshObservables()},_refreshObservables:function(){this.canRedoObservable(this.canRedo()),this.canUndoObservable(this.canUndo())},_fixupIds:function(command){var j,maps=command.idsMap();for(j=0;j<maps.length;j++){var ids=maps[j],newIdExists=null!=ids.newId&&void 0!==ids.newId&&ids.newId.length>0;if(!(null==ids.oldId||ids.oldId.length<=0)&&newIdExists&&ids.oldId!=ids.newId)for(var i=0;i<this._commands.length;i++)this._commands[i]!=command&&this._commands[i].fixupIds(ids)&&this._commands[i].onIdsFixedUp(ids)}for(j=0;j<maps.length;j++){var ids=maps[j],newIdExists=null!=ids.newId&&void 0!==ids.newId&&ids.newId.length>0;newIdExists&&command.fixupIds(ids)&&command.onIdsFixedUp(ids)}}}),AnnotationCommand=function(model,fileId,annotation,callbacks){jGroupdocs.AsyncCommand.prototype.constructor.apply(this,[callbacks]),this._model=model,this._fileId=fileId,this._annotation=annotation,this._annotationId=annotation?annotation.guid:null,this._idsMap={oldId:annotation.guid,newId:annotation.guid}},$.extend(AnnotationCommand.prototype,jGroupdocs.AsyncCommand.prototype,{_model:null,_fileId:null,_annotation:null,_annotationId:null,_idsMap:{oldId:"",newId:""},idsMap:function(){return[this._idsMap]},fixupIds:function(ids,preserveIdsMap){return this._annotationId!=ids.oldId?this._annotationId==ids.newId:(this._annotationId=ids.newId,this._annotation.guid=ids.newId,preserveIdsMap||(this._idsMap.newId=this._idsMap.oldId=ids.newId),!0)},onIdsFixedUp:function(ids){this._callbacks&&this._callbacks.onIdsFixedUp&&this._callbacks.onIdsFixedUp(ids)}}),CreateAnnotationCommand=function(model,fileId,annotation,callbacks){AnnotationCommand.prototype.constructor.apply(this,arguments)},$.extend(CreateAnnotationCommand.prototype,AnnotationCommand.prototype,{executeAsync:function(){this._model.createAnnotation(this._fileId,this._annotation.type,this._annotation.fieldText,this._annotation.pageNumber,this._annotation.box,this._annotation.annotationPosition,this._annotation.range,this._annotation.svgPath,this._annotation.drawingOptions,{family:this._annotation.fontFamily,size:this._annotation.fontSize},this._onDone.bind(this),this._onDoFailed.bind(this))}}),RestoreAnnotationRepliesCommand=function(model,fileId,annotation,callbacks,replies){AnnotationCommand.prototype.constructor.apply(this,arguments),this._replies=replies},$.extend(RestoreAnnotationRepliesCommand.prototype,AnnotationCommand.prototype,{_replies:null,executeAsync:function(){this._model.restoreAnnotationReplies(this._fileId,this._annotationId,this._replies,this._onDone.bind(this),this._onDoFailed.bind(this))},_onDone:function(response){AnnotationCommand.prototype._onDone.apply(this,arguments)}}),RestoreAnnotationCommand=function(model,fileId,annotation,callbacks,replies){if(AnnotationCommand.prototype.constructor.apply(this,arguments),this._replies=[],replies&&replies.length)for(var i=0;i<replies.length;i++){var rd=replies[i];this._replies.push({guid:rd.guid(),message:rd.text(),userGuid:rd.userGuid,parentReplyGuid:rd.parentReplyGuid(),repliedOn:rd.repliedOn})}},$.extend(RestoreAnnotationCommand.prototype,AnnotationCommand.prototype,{_replies:null,_replyIdsMap:null,executeAsync:function(){var callbacks={onDone:this._onAnnotationCreated.bind(this),onDoFailed:this._onDoFailed.bind(this)},createCmd=new CreateAnnotationCommand(this._model,this._fileId,this._annotation,callbacks);createCmd.executeAsync()},idsMap:function(){var map=AnnotationCommand.prototype.idsMap.apply(this,arguments);return map.push.apply(map,this._replyIdsMap||[]),map},_onAnnotationCreated:function(response){this._annotation.guid=response.data.annotationGuid;var callbacks={onDone:this._onDone.bind(this),onDoFailed:this._onDoFailed.bind(this)},restoreRepliesCmd=new RestoreAnnotationRepliesCommand(this._model,this._fileId,this._annotation,callbacks,this._replies);restoreRepliesCmd.executeAsync()},_onDone:function(response){this._replyIdsMap=[];for(var i=0;i<response.data.ids.length;i++)this._replyIdsMap.push({oldId:this._replies[i].guid,newId:response.data.ids[i]});this._idsMap.newId=response.data.annotationGuid,AnnotationCommand.prototype._onDone.apply(this,arguments)},_onDoFailed:function(response){this._idsMap.newId="",AnnotationCommand.prototype._onDoFailed.apply(this,arguments)}}),DeleteAnnotationCommand=function(model,fileId,annotation,callbacks,replies){AnnotationCommand.prototype.constructor.apply(this,arguments),this._replies=replies},$.extend(DeleteAnnotationCommand.prototype,AnnotationCommand.prototype,{_replies:null,_undoCmd:null,executeAsync:function(){this._undoCmd=null,this._model.deleteAnnotation(this._fileId,this._annotationId,this._onDone.bind(this),this._onDoFailed.bind(this))},undoCommand:function(){var callbacks={onDone:this._onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return this._undoCmd=new RestoreAnnotationCommand(this._model,this._fileId,this._annotation,callbacks,this._replies),this._undoCmd},idsMap:function(){return null!=this._undoCmd?this._undoCmd.idsMap():AnnotationCommand.prototype.idsMap.apply(this,arguments)},_onDone:function(response){this._idsMap.newId="",AnnotationCommand.prototype._onDone.apply(this,arguments)},_onUndone:function(response){this._idsMap.newId=response.data.annotationGuid,AnnotationCommand.prototype._onUndone.apply(this,arguments)}}),$.extend(CreateAnnotationCommand.prototype,{undoCommand:function(){var callbacks={onDone:this._onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new DeleteAnnotationCommand(this._model,this._fileId,this._annotation,callbacks)},_onDone:function(response){this._idsMap.newId=response.data.annotationGuid,AnnotationCommand.prototype._onDone.apply(this,arguments)},_onUndone:function(response){this._idsMap.newId="",AnnotationCommand.prototype._onUndone.apply(this,arguments)}}),MoveAnnotationCommand=function(model,fileId,annotation,callbacks,newPosition,oldPosition){AnnotationCommand.prototype.constructor.apply(this,arguments),this._newPosition=newPosition,this._oldPosition=oldPosition},$.extend(MoveAnnotationCommand.prototype,AnnotationCommand.prototype,{_newPosition:null,_oldPosition:null,executeAsync:function(){this._model.moveAnnotationMarker(this._fileId,this._annotation.guid,this._newPosition.x,this._newPosition.y,this._annotation.pageNumber,this._onDone.bind(this),this._onDoFailed.bind(this))},undoCommand:function(){var callbacks={onDone:this._callbacks.onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new MoveAnnotationCommand(this._model,this._fileId,this._annotation,callbacks,this._oldPosition,null)}}),ResizeAnnotationCommand=function(model,fileId,annotation,callbacks,newSize,oldSize){AnnotationCommand.prototype.constructor.apply(this,arguments),this._newSize=newSize,this._oldSize=oldSize},$.extend(ResizeAnnotationCommand.prototype,AnnotationCommand.prototype,{_newSize:null,_oldSize:null,executeAsync:function(){this._model.resizeAnnotation(this._fileId,this._annotation.guid,this._newSize.width,this._newSize.height,this._onDone.bind(this),this._onDoFailed.bind(this))},undoCommand:function(){var callbacks={onDone:this._callbacks.onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new ResizeAnnotationCommand(this._model,this._fileId,this._annotation,callbacks,this._oldSize,null)}}),SetAnnotationColorCommand=function(model,fileId,annotation,callbacks,newColor,oldColor){AnnotationCommand.prototype.constructor.apply(this,arguments),this._newColor=newColor,this._oldColor=oldColor},$.extend(SetAnnotationColorCommand.prototype,AnnotationCommand.prototype,{_newColor:null,_oldColor:null,executeAsync:function(){this._model.setTextFieldColor(this._fileId,this._annotation.guid,this._newColor,this._onDone.bind(this),this._onDoFailed.bind(this))},undoCommand:function(){var callbacks={onDone:this._callbacks.onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new SetAnnotationColorCommand(this._model,this._fileId,this._annotation,callbacks,this._oldColor,null)}}),AnnotationReplyCommand=function(model,fileId,annotation,callbacks,reply){AnnotationCommand.prototype.constructor.apply(this,arguments),this._reply=reply,this._replyId=reply&&reply.guid?reply.guid():"",this._idsMap.newId=this._idsMap.oldId=this._replyId},$.extend(AnnotationReplyCommand.prototype,AnnotationCommand.prototype,{_reply:null,_replyId:null,fixupIds:function(ids,preserveIdsMap){return AnnotationCommand.prototype.fixupIds.apply(this,[ids,!0])?!0:this._replyId!=ids.oldId?this._replyId==ids.newId:(this._replyId=ids.newId,this._reply.guid(ids.newId),preserveIdsMap||(this._idsMap.newId=this._idsMap.oldId=ids.newId),!0)}}),DeleteAnnotationReplyCommand=function(model,fileId,annotation,callbacks,reply){if(AnnotationReplyCommand.prototype.constructor.apply(this,arguments),this._replyDescendants=[],this._replyDescendants.push({guid:reply.guid(),message:reply.text(),userGuid:reply.userGuid,parentReplyGuid:reply.parentReplyGuid(),repliedOn:reply.repliedOn}),annotation.getReplyDescendants)for(var replyDescendants=annotation.getReplyDescendants(this._replyId),i=0;i<replyDescendants.length;i++){var rd=replyDescendants[i];this._replyDescendants.push({guid:rd.guid(),message:rd.text(),userGuid:rd.userGuid,parentReplyGuid:rd.parentReplyGuid(),repliedOn:rd.repliedOn})}},$.extend(DeleteAnnotationReplyCommand.prototype,AnnotationReplyCommand.prototype,{_replyDescendants:null,_descendantIdsMap:null,executeAsync:function(){this._model.deleteAnnotationReply(this._fileId,this._annotationId,this._replyId,this._onDone.bind(this),this._onDoFailed.bind(this))},fixupIds:function(ids,preserveIdsMap){for(var result=AnnotationReplyCommand.prototype.fixupIds.apply(this,arguments),i=0;i<this._replyDescendants.length;i++)this._replyDescendants[i].guid==ids.oldId?(this._replyDescendants[i].guid=ids.newId,result=!0):this._replyDescendants[i].parentReplyGuid==ids.oldId&&(this._replyDescendants[i].parentReplyGuid=ids.newId);return result},idsMap:function(){var map=AnnotationReplyCommand.prototype.idsMap.apply(this,arguments);return map.push.apply(map,this._descendantIdsMap||[]),map}}),CreateAnnotationReplyCommand=function(model,fileId,annotation,callbacks,reply){AnnotationReplyCommand.prototype.constructor.apply(this,arguments)},$.extend(CreateAnnotationReplyCommand.prototype,AnnotationReplyCommand.prototype,{executeAsync:function(){var text=jGroupdocs.html.toText(this._reply.text());this._model.addAnnotationReply(this._fileId,this._annotationId,text,this._reply.parentReplyGuid(),this._onDone.bind(this),this._onDoFailed.bind(this))},undoCommand:function(){var callbacks={onDone:this._onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new DeleteAnnotationReplyCommand(this._model,this._fileId,this._annotation,callbacks,this._reply)},_onDone:function(response){this._idsMap.newId=response.data.replyGuid,AnnotationReplyCommand.prototype._onDone.apply(this,arguments)},_onUndone:function(response){this._idsMap.newId="",AnnotationReplyCommand.prototype._onUndone.apply(this,arguments)}}),$.extend(DeleteAnnotationReplyCommand.prototype,{undoCommand:function(){var callbacks={onDone:this._onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new RestoreAnnotationRepliesCommand(this._model,this._fileId,this._annotation,callbacks,this._replyDescendants)},_onDone:function(response){this._idsMap.newId="",AnnotationReplyCommand.prototype._onDone.apply(this,arguments)},_onUndone:function(response){this._idsMap.newId=response.data.replyGuid,this._descendantIdsMap=[];for(var i=0;i<response.data.ids.length;i++)this._descendantIdsMap.push({oldId:this._replyDescendants[i].guid,newId:response.data.ids[i]});AnnotationReplyCommand.prototype._onUndone.apply(this,arguments)}}),EditAnnotationReplyCommand=function(model,fileId,annotation,callbacks,reply,newText,oldText){AnnotationReplyCommand.prototype.constructor.apply(this,arguments),this._newText=newText,this._oldText=oldText},$.extend(EditAnnotationReplyCommand.prototype,AnnotationReplyCommand.prototype,{_newText:null,_oldText:null,executeAsync:function(){var text=jGroupdocs.html.toText(this._newText);this._model.editAnnotationReply(this._fileId,this._annotationId,this._replyId,text,this._onDone.bind(this),this._onDoFailed.bind(this))},undoCommand:function(){var callbacks={onDone:this._callbacks.onUndone.bind(this),onDoFailed:this._callbacks.onUndoFailed.bind(this)};return new EditAnnotationReplyCommand(this._model,this._fileId,this._annotation,callbacks,this._reply,this._oldText,null)}}),function($){var Area=function(left,top,width,height,raphaelRect){this._init(left,top,width,height,raphaelRect)};$.extend(Area.prototype,{guid:"",left:0,top:0,width:0,height:0,annotation:null,raphaelRect:null,_init:function(left,top,width,height,raphaelRect){this.left=left,this.top=top,this.width=width,this.height=height,this.raphaelRect=raphaelRect},setAnnotation:function(annotation){this.annotation=annotation},deleteScreenRect:function(){this.raphaelRect.remove()}}),areaAnnotationModel=function(options){$.extend(this,options),this._init()},$.extend(areaAnnotationModel.prototype,annotationModel.prototype,{}),areaAnnotationViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(areaAnnotationViewModel.prototype,annotationViewModel.prototype,{_areas:null,_canvas:null,_dasharray:["","-",".","-.","-..",". ","- ","--","- .","--.","--.."],_create:function(options){this._model=new areaAnnotationModel(options),this._init(options)},_init:function(options){annotationViewModel.prototype._init.call(this,options),this._areas=[];var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){(annotation.type==Annotation.prototype.AnnotationType.Area||annotation.type==Annotation.prototype.AnnotationType.ResourcesRedaction)&&self.deleteAreaByAnnotationGuid(annotation.guid)}}),$(this).bind({onAnnotationReceived:function(e,annotation){(annotation.type==Annotation.prototype.AnnotationType.Area||annotation.type==Annotation.prototype.AnnotationType.ResourcesRedaction)&&self.receiveAreaAnnotationHandler(annotation)}}),$(this).bind({onAnnotationCreated:function(e,annotation){self.createAreaAnnotationHandler(annotation)}}),$(this).bind({onReviewerColorsChanged:function(e){self.reviewerColorsChangedHandlerArea()}}),$(this).bind({onAnnotationMarkerMovedOnClient:function(e,annotationGuid,position,pageNumber){self.areaAnnotationMarkerMovedHandler(annotationGuid,position,pageNumber)}}),$(this).bind({onSetZoom:function(e,scale){self.setAreaZoom(scale)}})},createAreaAnnotation:function(pageNumber,bounds){var drawingOptions=this._getDrawingOptions(null,this.areaToolOptions);this.createAnnotation(Annotation.prototype.AnnotationType.Area,pageNumber,bounds,null,null,null,null,null,drawingOptions)},createResourcesRedactionAnnotation:function(pageNumber,bounds){var drawingOptions=this._getDrawingOptions(null,this.redactionToolOptions);this.createAnnotation(Annotation.prototype.AnnotationType.ResourcesRedaction,pageNumber,bounds,null,null,null,null,null,drawingOptions)},createAreaAnnotationHandler:function(annotation){if(annotation.type==Annotation.prototype.AnnotationType.Area||annotation.type==Annotation.prototype.AnnotationType.ResourcesRedaction){var bounds=annotation.displayBounds(),selectable=this.getSelectableInstance();null!=selectable._findPageAt(bounds.topLeft)?annotation.startingPoint=bounds.topLeft:null!=selectable._findPageAt(bounds.bottomRight)&&(annotation.startingPoint=bounds.bottomRight);var rectangle=this.getCanvas().rect(bounds.left(),bounds.top(),bounds.width(),bounds.height()).attr({fill:"#f00","fill-opacity":0,cursor:"pointer"}),drawingOptions=this._getDrawingOptions(annotation);rectangle.attr({stroke:this.getRgbColorFromInteger(drawingOptions.penColor)}),rectangle.attr({"stroke-width":drawingOptions.penWidth}),rectangle.attr({"stroke-dasharray":this._dasharray[drawingOptions.penStyle]}),rectangle.attr({"stroke-opacity":.5}),isNaN(drawingOptions.brushColor)||rectangle.attr({fill:this.getRgbColorFromInteger(drawingOptions.brushColor),"fill-opacity":drawingOptions.opacity||1}),this.createMenu(rectangle.node,annotation),this.createClickHandler(rectangle.node,annotation),this._makeDraggable(annotation,rectangle);var area=new Area(bounds.left(),bounds.top(),bounds.width(),bounds.height(),rectangle);area.setAnnotation(annotation),this._areas.push(area)}},_makeDraggable:function(annotation,figure,bbox){function onDragStarted(x,y,event){return selectionMode=selectable.getMode(),selectable.setMode($.ui.dvselectable.prototype.SelectionModes.DoNothing),initialX=this.attr("x"),initialY=this.attr("y"),initialBounds=annotation.displayBounds(),originalPos=annotation.bounds().topLeft.clone(),prevDx=prevDy=0,!1}function onDragging(dx,dy,x,y,event){if(null!=self.annotationModeObservable())return!1;this.attr({x:initialX+dx,y:initialY+dy});var currentOrigin,currentDisplayBounds=initialBounds.clone().add(new jSaaspose.Point(dx,dy));if(self.storeAnnotationCoordinatesRelativeToPages){var page=self.getSelectableInstance().findPageAtVerticalPosition(currentDisplayBounds.top());page&&(annotation.pageNumber=parseInt(page.pageId)-1),currentOrigin=self.convertPointToRelativeToPageUnscaledCoordinates(currentDisplayBounds.topLeft,currentDisplayBounds.topLeft)}else currentOrigin=self.convertPointToAbsoluteCoordinates(currentDisplayBounds.topLeft,currentDisplayBounds.topLeft);var annotationBounds=annotation.bounds().clone();return annotation.bounds(new jSaaspose.Rect(currentOrigin.x,currentOrigin.y,currentOrigin.x+annotationBounds.width(),currentOrigin.y+annotationBounds.height())),self.updateAnnotationDisplayPosition(annotation),self.preventIconsFromOverlapping(),self.createConnectingLineAndIcon(annotation),bbox&&(figure.transform("...T"+(dx-prevDx)+","+(dy-prevDy)),prevDx=dx,prevDy=dy,self.updateSvgPathAfterMove(annotation,currentOrigin.x-annotationBounds.left(),currentOrigin.y-annotationBounds.top())),!1}function onDragEnded(event){(initialX!=this.attr("x")||initialY!=this.attr("y"))&&(self.draggedMarker=!0,self.moveAnnotationMarker(annotation,{x:annotation.bounds().topLeft.x,y:annotation.bounds().topLeft.y},originalPos)),selectable.setMode(selectionMode)}var initialBounds,originalPos,initialX=0,initialY=0,prevDx=0,prevDy=0,self=this,selectable=this.getSelectableInstance(),selectionMode=$.ui.dvselectable.prototype.SelectionModes.DoNothing;(bbox||figure).drag(onDragging,onDragStarted,onDragEnded),(bbox||figure).hover(function(){this.hoveredAnnotation(annotation)},function(){this.hoveredAnnotation(null)},this,this)},_getDrawingOptions:function(annotation,drawingOptions){var strokeColor=this._getReviewerColor?this._getReviewerColor(annotation?annotation.creatorGuid:this.userId):16737792,strokeWidth=1,strokeStyle=0,brushColor=void 0,opacity=null!=annotation&&annotation.type!=Annotation.prototype.AnnotationType.ResourcesRedaction?.5:1;return drawingOptions&&drawingOptions.pen&&(drawingOptions.pen.color&&(strokeColor=drawingOptions.pen.color),strokeWidth=drawingOptions.pen.width,strokeStyle=drawingOptions.pen.dashStyle),drawingOptions&&drawingOptions.brush&&drawingOptions.brush.color&&(brushColor=drawingOptions.brush.color),annotation&&(isNaN(annotation.penColor)||(strokeColor=annotation.penColor),isNaN(annotation.penWidth)||(strokeWidth=annotation.penWidth),isNaN(annotation.penStyle)||(strokeStyle=annotation.penStyle),annotation.backgroundColor&&!isNaN(annotation.backgroundColor())&&(brushColor=annotation.backgroundColor())),{penColor:strokeColor,penWidth:strokeWidth,penStyle:strokeStyle,brushColor:brushColor,opacity:opacity}},createMenu:function(markerElement,annotation){var viewModel=this;$(markerElement).bind("contextmenu",function(e){function clickHandler(){return viewModel.removeAnnotation(annotation,null),$(this).remove(),!1}var contextMenu=$("<div/>").text("Delete").addClass("figureContextMenu").css("left",e.originalEvent.layerX-10).css("top",e.originalEvent.layerY-10).appendTo(viewModel._containerElement.children(".raphaelWrapper")).click(clickHandler).bind("contextmenu",clickHandler);return viewModel.setupRemoveAnnotationMenu(contextMenu),!1})},deleteAnnotationHandler:function(e,annotation){this.deleteAreaByAnnotationGuid(annotation.guid)},receiveAreaAnnotationHandler:function(annotation){(annotation.type==Annotation.prototype.AnnotationType.Area||annotation.type==Annotation.prototype.AnnotationType.ResourcesRedaction)&&this.createAreaAnnotationHandler(annotation)},addAnnotationFromAnotherUser:function(data){var newAnnotation=annotationViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return(newAnnotation.type==Annotation.prototype.AnnotationType.Area||newAnnotation.type==Annotation.prototype.AnnotationType.ResourcesRedaction)&&this.createAreaAnnotationHandler(newAnnotation),newAnnotation},clearAllAnnotationOnClient:function(){for(;this._areas.length>0;){var area=this._areas[0];this.deleteAreaByAnnotationGuid(area.annotation.guid)}annotationViewModel.prototype.clearAllAnnotationOnClient.call(this)},deleteAnnotationOnClient:function(annotationGuid){this.deleteAreaByAnnotationGuid(annotationGuid),annotationViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid);
},deleteAreaByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._areas.length;i++){var area=this._areas[i];if(area.annotation.guid==annotationGuid){area.deleteScreenRect(),this._areas.splice(i,1);break}}},setAreaZoom:function(){var i,areaCount=this._areas.length,annotations=[];for(i=0;areaCount>i;i++){var area=this._areas[i];area.deleteScreenRect(),annotations.push(area.annotation)}for(this._areas.length=0,i=0;i<annotations.length;i++)this.createAreaAnnotationHandler(annotations[i])},reviewerColorsChangedHandlerArea:function(){for(var i=0;i<this._areas.length;i++){var colorOfReviewer=this.getRgbColorOfReviewer&&this.getRgbColorOfReviewer(this._areas[i].annotation.creatorGuid);colorOfReviewer&&this._areas[i].raphaelRect.attr({stroke:colorOfReviewer})}},areaAnnotationMarkerMovedHandler:function(annotationGuid,position,pageNumber){this.deleteAreaByAnnotationGuid(annotationGuid);var annotation=this.findAnnotation(annotationGuid);null!=annotation&&(annotation.pageNumber=pageNumber,this.createAreaAnnotationHandler(annotation))},setResourcesRedactionAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectRectangle),this.annotationModeObservable(Annotation.prototype.AnnotationType.ResourcesRedaction)},updateSvgPathAfterMove:function(annotation,dx,dy){var svgPath=annotation.svgPath;if(svgPath){for(var pattern=" l",re=new RegExp(pattern,"g"),resultingSvgPath="M",segmentArray=svgPath.toLowerCase().substring(1,svgPath.length).replace(re,"l").split("l"),segmentCount=segmentArray.length,i=0;segmentCount>i;i++){var coordinateArray=segmentArray[i].split(","),x=parseFloat(coordinateArray[0]),y=parseFloat(coordinateArray[1]);0==i?(x+=dx,y+=dy,resultingSvgPath+=window.jGroupdocs.stringExtensions.format("{0},{1}",x,y)):resultingSvgPath+=window.jGroupdocs.stringExtensions.format("l{0},{1}",x,y)}annotation.svgPath=resultingSvgPath}}}),$.widget("ui.docAreaAnnotationViewer",$.ui.docAnnotationViewer,{_createViewModel:function(){return new areaAnnotationViewModel(this.options)},_create:function(){$.ui.docAnnotationViewer.prototype._create.call(this)}})}(jQuery),function($){var AnnotationPoint=function(annotation){this._init(annotation)};$.extend(AnnotationPoint.prototype,{annotation:null,deleteIconIsVisible:null,markerWidth:26,markerHeight:27,_init:function(annotation){this.deleteIconIsVisible=ko.observable(!1),this.annotation=annotation}}),pointAnnotationModel=function(options){$.extend(this,options),this._init()},$.extend(pointAnnotationModel.prototype,areaAnnotationModel.prototype,{}),pointAnnotationViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(pointAnnotationViewModel.prototype,areaAnnotationViewModel.prototype,{_points:null,_create:function(options){this._model=new pointAnnotationModel(options),this._init(options)},_init:function(options){areaAnnotationViewModel.prototype._init.call(this,options),this._points=ko.observableArray([]);var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.Point&&self.deletePointByAnnotationGuid(annotation.guid)}}),$(this).bind({onAnnotationReceived:function(e,annotation){self.receivePointAnnotationHandler(annotation)}}),$(this).bind({onAnnotationCreated:function(e,annotation){self.createPointAnnotationHandler(annotation)}}),$(this).bind({onSetZoom:function(e,scale){self.setPointZoom(scale)}})},createPointAnnotation:function(pageNumber,bounds){this.createAnnotation(Annotation.prototype.AnnotationType.Point,pageNumber,bounds,null,null,null,null)},deleteAnnotationHandler:function(e,annotation){this.deletePointByAnnotationGuid(annotation.guid)},receivePointAnnotationHandler:function(annotation){annotation.type==Annotation.prototype.AnnotationType.Point&&this.createPointAnnotationHandler(annotation)},createPointAnnotationHandler:function(annotation){if(annotation.type==Annotation.prototype.AnnotationType.Point){var annotationPoint=new AnnotationPoint(annotation);this._points.push(annotationPoint)}},getDraggableOptions:function(annotation){var initialBounds,originalPos,self=this;return{start:function(event,ui){return null!=self.annotationModeObservable()?!1:(self.draggedMarker=!0,initialBounds=annotation.displayBounds(),void(originalPos=annotation.bounds().topLeft.clone()))},drag:function(event,ui){var currentOrigin,width=26,height=27,currentDisplayOrigin=new jSaaspose.Point(ui.position.left+width/2,ui.position.top+height/2);if(self.storeAnnotationCoordinatesRelativeToPages){var page=self.getSelectableInstance().findPageAtVerticalPosition(currentDisplayOrigin.y);page&&(annotation.pageNumber=parseInt(page.pageId)-1),currentOrigin=self.convertPointToRelativeToPageUnscaledCoordinates(currentDisplayOrigin,currentDisplayOrigin)}else currentOrigin=self.convertPointToAbsoluteCoordinates(currentDisplayOrigin,currentDisplayOrigin);var annotationBounds=annotation.bounds();annotation.bounds(new jSaaspose.Rect(currentOrigin.x,currentOrigin.y,currentOrigin.x+annotationBounds.width(),currentOrigin.y+annotationBounds.height())),self.updateAnnotationDisplayPosition(annotation),self.preventIconsFromOverlapping(),self.createConnectingLineAndIcon(annotation)},stop:function(event,ui){(initialBounds.left()!=annotation.displayBounds().left()||initialBounds.top()!=annotation.displayBounds().top())&&(self.draggedMarker=!0,self.moveAnnotationMarker(annotation,{x:annotation.bounds().topLeft.x,y:annotation.bounds().topLeft.y},originalPos))}}},addAnnotationFromAnotherUser:function(data){var newAnnotation=areaAnnotationViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return newAnnotation.type==Annotation.prototype.AnnotationType.Point&&this.createPointAnnotationHandler(newAnnotation),newAnnotation},clearAllAnnotationOnClient:function(){this._points.removeAll(),areaAnnotationViewModel.prototype.clearAllAnnotationOnClient.call(this)},deleteAnnotationOnClient:function(annotationGuid){this.deletePointByAnnotationGuid(annotationGuid),areaAnnotationViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},deletePointByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._points().length;i++){var point=this._points()[i];if(point.annotation.guid==annotationGuid){this._points.splice(i,1);break}}},setPointZoom:function(value){var i,markerCount=this._points().length,annotations=[];for(i=0;markerCount>i;i++){var marker=this._points()[i];annotations.push(marker.annotation)}for(this._points().length=0,i=0;i<annotations.length;i++)this.createPointAnnotationHandler(annotations[i])}}),$.widget("ui.docPointAnnotationViewer",$.ui.docAreaAnnotationViewer,{_createViewModel:function(){return new pointAnnotationViewModel(this.options)},_create:function(){$.ui.docAreaAnnotationViewer.prototype._create.call(this)}})}(jQuery),function($){StrikeoutMode={Strikeout:0,Remove:1};var TextStrikeout=function(bounds){this._init(bounds)};$.extend(TextStrikeout.prototype,{bounds:null,_init:function(bounds){this.bounds=bounds}});var TextStrikeoutGroup=function(textStrikeouts,annotation){this._init(textStrikeouts,annotation)};$.extend(TextStrikeoutGroup.prototype,{_textStrikeouts:null,firstStrikeoutRightSide:null,firstStrikeoutTopSide:null,color:null,annotation:null,_init:function(textStrikeouts,annotation){this._textStrikeouts=textStrikeouts,this.annotation=annotation;var minTop=0,strikeoutTop=0,minTopNotInitialized=!0;this.firstStrikeoutRightSide=ko.observable(0),this.firstStrikeoutTopSide=ko.observable(0),this.color=ko.observable(jSaaspose.utils.getHexColor(annotation.penColor));for(var i=0;i<this._textStrikeouts.length;i++)strikeoutTop=this._textStrikeouts[i].bounds.top(),(minTopNotInitialized||minTop>strikeoutTop)&&(minTopNotInitialized=!1,minTop=strikeoutTop,this.firstStrikeoutRightSide(this._textStrikeouts[i].bounds.right()),this.firstStrikeoutTopSide(this._textStrikeouts[i].bounds.top()))}}),textStrikeoutModel=function(options){$.extend(this,options),this._init()},$.extend(textStrikeoutModel.prototype,pointAnnotationModel.prototype,{}),textStrikeoutViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(textStrikeoutViewModel.prototype,pointAnnotationViewModel.prototype,{_textUnderlines:null,_textStrikeouts:null,_textStrikeoutGroups:null,strikeOutColor:null,underlineColor:null,strikeoutMode:StrikeoutMode.Strikeout,_create:function(options){this._model=new textStrikeoutModel(options),this._init(options)},_init:function(options){pointAnnotationViewModel.prototype._init.call(this,options),this._textUnderlines=ko.observableArray([]),this._textStrikeouts=ko.observableArray([]),this._textStrikeoutGroups=ko.observableArray([]),this.strikeoutMode=options.strikeoutMode||StrikeoutMode.Strikeout;var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.TextStrikeout||annotation.type==Annotation.prototype.AnnotationType.TextRemoval?self.deleteTextStrikeoutGroupHandler(annotation.guid):annotation.type==Annotation.prototype.AnnotationType.TextUnderline&&self._deleteTextUnderline(annotation.guid)}}),$(this).bind({onAnnotationReceived:function(e,annotation){self.receiveTextStrikeoutHandler(annotation)}}),$(this).bind({onAnnotationCreated:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.TextStrikeout||annotation.type==Annotation.prototype.AnnotationType.TextRemoval?self.createTextStrikeoutHandler(annotation):annotation.type==Annotation.prototype.AnnotationType.TextUnderline&&self._onTextUnderlineCreated(annotation)}}),$(this).bind({onReviewerColorsChanged:function(e){}}),$(this).bind({onDocumentLoaded:function(e){self.clearStrikeouts(),self._clearUnderlines()}}),$(this).bind({onSetZoom:function(e,scale){self.setTextStrikeoutZoom(scale),self._onUnderlinesZoomChanged(scale)}})},createTextStrikeout:function(pageNumber,bounds,position,length,selectionCounter,rects){var annotationType=this.strikeoutMode==StrikeoutMode.Remove?Annotation.prototype.AnnotationType.TextRemoval:Annotation.prototype.AnnotationType.TextStrikeout,color=this._getStrikeoutColor(this.userId,!1);this.createAnnotation(annotationType,pageNumber,bounds,null,null,null,null,selectionCounter,{penColor:color},rects)},createTextUnderline:function(pageNumber,bounds,position,length,selectionCounter,rects){var color=this._getStrikeoutColor(this.userId,!0);this.createAnnotation(Annotation.prototype.AnnotationType.TextUnderline,pageNumber,bounds,null,null,null,null,selectionCounter,{penColor:color},rects)},createTextStrikeoutHandler:function(annotation){var bounds=annotation.bounds(),selectable=this.getSelectableInstance(),pageNumber=annotation.pageNumber,offsets=this.getPageImageOffsets(annotation.type),underlineText=annotation.type==Annotation.prototype.AnnotationType.TextUnderline;this.storeAnnotationCoordinatesRelativeToPages?bounds=this.convertPageAndRectToScreenCoordinates(pageNumber,annotation.bounds()):(bounds=this.convertRectToScreenCoordinates(annotation.bounds()),pageNumber=parseInt(selectable.findPageAtVerticalPosition(annotation.bounds().top()).pageId)-1),bounds=bounds.round();for(var rect=null,rects=selectable.getRowsFromRect(bounds),textStrikeoutArray=[],textStrikeout=null,i=0;i<rects.length;i++)rect=rects[i].bounds,rect.add(new jSaaspose.Point(offsets.offsetX,Math.round(rect.height/2))),textStrikeout=new TextStrikeout(rect),textStrikeoutArray.push(textStrikeout);annotation.firstRectBounds=rects[0].bounds,(null==annotation.penColor||void 0===annotation.penColor)&&(annotation.penColor=this._getStrikeoutColor(annotation.creatorGuid,underlineText)),(underlineText?this._textUnderlines:this._textStrikeoutGroups).push(new TextStrikeoutGroup(textStrikeoutArray,annotation)),this.deselectTextInRect(annotation.bounds(),!0,pageNumber,annotation.selectionCounter),this.deselectTextInRect(annotation.bounds(),!1,pageNumber,annotation.selectionCounter)},addAnnotationFromAnotherUser:function(data){var newAnnotation=pointAnnotationViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return data.annotationType==Annotation.prototype.AnnotationType.TextStrikeout||data.annotationType==Annotation.prototype.AnnotationType.TextRemoval?this.createTextStrikeoutHandler(newAnnotation):data.annotationType==Annotation.prototype.AnnotationType.TextUnderline&&this._onTextUnderlineCreated(newAnnotation),newAnnotation},deleteTextStrikeout:function(textStrikeout){this._textStrikeouts.remove(textStrikeout)},deleteTextStrikeoutGroupHandler:function(textStrikeoutGroupGuid){for(var textStrikeoutGroupsLength=this._textStrikeoutGroups().length,i=0;textStrikeoutGroupsLength>i;i++){var textStrikeoutGroup=this._textStrikeoutGroups()[i];if(textStrikeoutGroup.annotation.guid==textStrikeoutGroupGuid){this._textStrikeouts.removeAll(textStrikeoutGroup._textStrikeouts),this._textStrikeoutGroups.splice(i,1);break}}},receiveTextStrikeoutHandler:function(annotation){annotation.type==Annotation.prototype.AnnotationType.TextStrikeout||annotation.type==Annotation.prototype.AnnotationType.TextRemoval?this.createTextStrikeoutHandler(annotation):annotation.type==Annotation.prototype.AnnotationType.TextUnderline&&this._onTextUnderlineCreated(annotation)},deleteAnnotationOnClient:function(annotationGuid){this.deleteTextStrikeoutGroupHandler(annotationGuid),this._deleteTextUnderline(annotationGuid),pointAnnotationViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},clearAllAnnotationOnClient:function(){this.clearStrikeouts(),this._clearUnderlines(),pointAnnotationViewModel.prototype.clearAllAnnotationOnClient.call(this)},setTextStrikeoutZoom:function(value){var i,annotationCount=this._textStrikeoutGroups().length,annotations=[];for(i=0;annotationCount>i;i++){var textStrikeoutGroup=this._textStrikeoutGroups()[i];annotations.push(textStrikeoutGroup.annotation)}for(this._textStrikeouts.removeAll(),this._textStrikeoutGroups.splice(0,annotationCount),i=0;i<annotations.length;i++)this.createTextStrikeoutHandler(annotations[i]);this.reviewerColorsChangedHandlerStrikeout()},deleteTextStrikeoutGroup:function(viewModel,textStrikeoutGroup){viewModel.removeAnnotation(textStrikeoutGroup.annotation),viewModel._textStrikeouts.removeAll(textStrikeoutGroup._textStrikeouts),viewModel._textStrikeoutGroups.remove(textStrikeoutGroup)},reviewerColorsChangedHandlerStrikeout:function(){for(var i=0;i<this._textStrikeoutGroups().length;i++){var colorOfReviewer=this.getRgbColorOfReviewer(this._textStrikeoutGroups()[i].annotation.creatorGuid);colorOfReviewer&&this._textStrikeoutGroups()[i].color(colorOfReviewer)}},clearStrikeouts:function(){this._textStrikeouts.removeAll(),this._textStrikeoutGroups.removeAll()},setTextUnderlineAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectText),this.annotationModeObservable(Annotation.prototype.AnnotationType.TextUnderline)},_onTextUnderlineCreated:function(annotation){this.createTextStrikeoutHandler(annotation)},_deleteTextUnderline:function(guid){for(var count=this._textUnderlines().length,i=0;count>i;i++){var underline=this._textUnderlines()[i];if(underline.annotation.guid==guid){this._textUnderlines.splice(i,1);break}}},_clearUnderlines:function(){this._textUnderlines.removeAll()},_updateUnderlinesColor:function(){for(var i=0;i<this._textUnderlines().length;i++){var color=this.getRgbColorOfReviewer(this._textUnderlines()[i].creatorGuid);color&&this._textUnderlines()[i].color(color)}},_onUnderlinesZoomChanged:function(value){var i,count=this._textUnderlines().length,annotations=[];for(i=0;count>i;i++)annotations.push(this._textUnderlines()[i].annotation);for(this._textUnderlines.splice(0,count),i=0;i<annotations.length;i++)this._onTextUnderlineCreated(annotations[i]);this._updateUnderlinesColor()},_getStrikeoutColor:function(userId,underlineText){var color=this._getHexReviewerColor(userId)||(underlineText?this.underlineColor:this.strikeOutColor)||jSaaspose.utils.getHexColor(this.getDefaultColor());return parseInt(color.replace("#","0x"))}}),$.widget("ui.docTextStrikeoutViewer",$.ui.docPointAnnotationViewer,{_createViewModel:function(){return new textStrikeoutViewModel(this.options)},_create:function(){$("<!-- ko foreach: _textStrikeoutGroups -->  <!-- ko if: (annotation.type == Annotation.prototype.AnnotationType.TextStrikeout) -->   <a class='anno_del small_button blue_button popupa' data-bind=\"style: {left: $root.pageLeft() + firstStrikeoutRightSide() + 'px',                                                                            top: firstStrikeoutTopSide() + 'px'},                                                                    click: $root.deleteTextStrikeoutGroup.bind($data, $root) \"       href='#'>Delete</a>  <!-- /ko -->   <!-- ko foreach: _textStrikeouts -->       <div class='textStrikeout' data-bind=\"style: { left: $root.pageLeft() + bounds.left() + 'px',                                                        top: bounds.top() + 'px',                                                        width: bounds.width() + 'px',                                                        height: bounds.height() + 'px'},                                                       event: { mouseenter: function() { $root.hoveredAnnotation($parent.annotation); }, mouseleave: function() { $root.hoveredAnnotation(null); } },                                              click: function () { var a = $parent.annotation; $root.markerClickHandler(a); } \">           <div class='textStrikeoutLine' data-bind=\"style: { backgroundColor: $parent.color(), top: bounds.height() / 2 + 'px'} \"></div>       </div>   <!-- /ko --><!-- /ko --><!-- ko foreach: _textUnderlines -->  <!-- ko foreach: _textStrikeouts -->    <div class='textStrikeout' data-bind=\"style: { left: $root.pageLeft() + bounds.left() + 'px',                                                     top: bounds.top() + 'px',                                                     width: bounds.width() + 'px',                                                     height: bounds.height() + 'px' },                                                    event: { mouseenter: function() { $root.hoveredAnnotation($parent.annotation); }, mouseleave: function() { $root.hoveredAnnotation(null); } },                                           click: function () { var a = $parent.annotation; $root.markerClickHandler(a); } \">      <div class='textStrikeoutLine' data-bind=\"style: { backgroundColor: $parent.color(), top: bounds.height() + 'px'} \"></div>    </div>  <!-- /ko --><!-- /ko -->").appendTo(this.options.graphicsContainerElement),$.ui.docPointAnnotationViewer.prototype._create.call(this)}})}(jQuery),function($){AnnotationPolyline=function(raphaelFigure,boundingBox){this._init(raphaelFigure,boundingBox)},$.extend(AnnotationPolyline.prototype,{annotation:null,raphaelFigure:null,_init:function(raphaelFigure,boundingBox){this.raphaelFigure=raphaelFigure,this.boundingBox=boundingBox},setAnnotation:function(annotation){this.annotation=annotation},deleteScreenFigure:function(){this.raphaelFigure.remove(),this.boundingBox&&this.boundingBox.remove()},setSvgPath:function(svgPath){this.raphaelFigure.attr("path",svgPath)}}),window.polylineAnnotationModel=function(options){$.extend(this,options),this._init()},$.extend(polylineAnnotationModel.prototype,textStrikeoutModel.prototype,{}),window.polylineAnnotationViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(polylineAnnotationViewModel.prototype,textStrikeoutViewModel.prototype,{_polylines:null,_create:function(options){this._model=new polylineAnnotationModel(options),this._init(options)},_init:function(options){textStrikeoutViewModel.prototype._init.call(this,options),this._polylines=[];var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.Polyline&&self.deletePolylineByAnnotationGuid(annotation.guid)}}),$(this).bind({onAnnotationReceived:function(e,annotation){self.receivePolylineAnnotationHandler(annotation)}}),$(this).bind({onAnnotationCreated:function(e,annotation,markerFigure){self.createPolylineAnnotationHandler(annotation,markerFigure)}}),$(this).bind({onReviewerColorsChanged:function(e){self.reviewerColorsChangedHandlerPolyline()}}),$(this).bind({onSetZoom:function(e,scale){self.setPolylineZoom(scale)}}),$(this).bind({onAnnotationMarkerMovedOnClient:function(e,annotationGuid,position,pageNumber,originalPosition){self.moveAnnotationMarkerOnClientPolyline(annotationGuid,position,pageNumber,originalPosition)}})},addPart:function(raphaelElement,point){var pathParts=raphaelElement.attr("path")||[];$.isArray(pathParts)?pathParts.push(point):pathParts+=point[0]+point[1]+","+point[2],raphaelElement.attr("path",pathParts)},setFigureLook:function(raphaelFigure,annotation,toolOptions){var drawingOptions=this._getDrawingOptions(annotation,toolOptions);raphaelFigure.attr({stroke:this.getRgbColorFromInteger(drawingOptions.penColor)}),raphaelFigure.attr({"stroke-width":drawingOptions.penWidth}),raphaelFigure.attr({"stroke-dasharray":this._dasharray[drawingOptions.penStyle]}),raphaelFigure.attr({"stroke-opacity":1})},createPolylineAnnotation:function(pageNumber,point){var selectableElement=this.getSelectable(),pathString=window.jGroupdocs.stringExtensions.format("M{0},{1}",point.left,point.top),markerFigure=this.getCanvas().path(pathString).attr({fill:"#f00","fill-opacity":0});this.setFigureLook(markerFigure,null,this.polylineToolOptions);var position,self=this,previousPoint=point,startingPoint=new jSaaspose.Point(point.left,point.top);if(position=this.storeAnnotationCoordinatesRelativeToPages?this.convertPointToRelativeToPageUnscaledCoordinates(startingPoint,startingPoint):this.convertPointToAbsoluteCoordinates(startingPoint,startingPoint),null!=position){var scale=this.scale(),markerSvgPath=window.jGroupdocs.stringExtensions.format("M{0},{1}",position.x,position.y);selectableElement.bind("onMouseDrag",function(event,mouseDragPoint){var deltaX=mouseDragPoint.left-previousPoint.left,deltaY=mouseDragPoint.top-previousPoint.top;self.addPart(markerFigure,["l",deltaX,deltaY]);var unscaledDeltaX=deltaX/scale,unscaledDeltaY=deltaY/scale;markerSvgPath+=window.jGroupdocs.stringExtensions.format("l{0},{1}",unscaledDeltaX,unscaledDeltaY),previousPoint=mouseDragPoint}),selectableElement.bind("onMouseMoveStopped",function(){selectableElement.unbind("onMouseMoveStopped"),selectableElement.unbind("onMouseDrag");var absoluteBounds,boundingBox=markerFigure.getBBox(!1),bounds=new jSaaspose.Rect(boundingBox.x,boundingBox.y,boundingBox.x+boundingBox.width,boundingBox.y+boundingBox.height),selectable=self.getSelectableInstance();absoluteBounds=self.storeAnnotationCoordinatesRelativeToPages?selectable.convertRectToRelativeToPageUnscaledCoordinates(bounds,startingPoint):selectable.convertRectToAbsoluteCoordinates(bounds,startingPoint);var drawingOptions=self._getDrawingOptions(null,self.polylineToolOptions);self.createAnnotation(Annotation.prototype.AnnotationType.Polyline,pageNumber,absoluteBounds,null,null,markerFigure,markerSvgPath,null,drawingOptions)})}},createPolylineAnnotationHandler:function(annotation,markerFigure){if(annotation.type==Annotation.prototype.AnnotationType.Polyline){if(!markerFigure&&annotation.svgPath){for(var pageHeight,pageNumber,svgPath=annotation.svgPath,scale=this.scale(),selectable=this.getSelectableInstance(),resultingSvgPath="M",segmentArray=svgPath.substring(1,svgPath.length-1).split("l"),segmentCount=segmentArray.length,i=0;segmentCount>i;i++){var coordinateArray=segmentArray[i].split(","),x=parseFloat(coordinateArray[0]),y=parseFloat(coordinateArray[1]);x*=scale,y*=scale,0==i?(this.storeAnnotationCoordinatesRelativeToPages?pageNumber=annotation.pageNumber:(pageHeight=selectable.options.pageHeight,pageNumber=Math.floor(y/pageHeight),y-=pageNumber*pageHeight),x+=selectable.pages[pageNumber].rect.topLeft.x,y+=selectable.pages[pageNumber].rect.topLeft.y,annotation.startingPoint=new jSaaspose.Point(x,y),resultingSvgPath+=window.jGroupdocs.stringExtensions.format("{0},{1}",x,y)):resultingSvgPath+=window.jGroupdocs.stringExtensions.format("l{0},{1}",x,y)}annotation.displaySvgPath=resultingSvgPath,markerFigure=this.getCanvas().path(annotation.displaySvgPath),this.setFigureLook(markerFigure,annotation,this.polylineToolOptions)}var bbox=this.getCanvas().rect(annotation.displayBounds().left(),annotation.displayBounds().top(),annotation.displayBounds().width(),annotation.displayBounds().height()).attr({stroke:"none",fill:"#f00","fill-opacity":0,cursor:"pointer"});this.createMenu((bbox||markerFigure).node,annotation),this.createClickHandler((bbox||markerFigure).node,annotation),this._makeDraggable(annotation,markerFigure,bbox);var annotationPolyline=new AnnotationPolyline(markerFigure,bbox);annotationPolyline.setAnnotation(annotation),this._polylines.push(annotationPolyline)}},deleteAnnotationHandler:function(e,annotation){this.deletePolylineByAnnotationGuid(annotation.guid)},receivePolylineAnnotationHandler:function(annotation){annotation.type==Annotation.prototype.AnnotationType.Polyline&&this.createPolylineAnnotationHandler(annotation)},addAnnotationFromAnotherUser:function(data){var newAnnotation=textStrikeoutViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return newAnnotation.type==Annotation.prototype.AnnotationType.Polyline&&this.createPolylineAnnotationHandler(newAnnotation),newAnnotation},deleteAnnotationOnClient:function(annotationGuid){this.deletePolylineByAnnotationGuid(annotationGuid),textStrikeoutViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},clearAllAnnotationOnClient:function(){for(;this._polylines.length>0;){var polyline=this._polylines[0];this.deletePolylineByAnnotationGuid(polyline.annotation.guid)}textStrikeoutViewModel.prototype.clearAllAnnotationOnClient.call(this)},deletePolylineByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._polylines.length;i++){var polyline=this._polylines[i];if(polyline.annotation.guid==annotationGuid){polyline.deleteScreenFigure(),this._polylines.splice(i,1);break}}},setPolylineZoom:function(value){var i,markerCount=this._polylines.length,annotations=[];for(i=0;markerCount>i;i++){var marker=this._polylines[i];marker.deleteScreenFigure(),annotations.push(marker.annotation)}for(this._polylines.length=0,i=0;i<annotations.length;i++){var annotation=annotations[i];this.createPolylineAnnotationHandler(annotation)}},reviewerColorsChangedHandlerPolyline:function(){for(var i=0;i<this._polylines.length;i++){var colorOfReviewer=this.getRgbColorOfReviewer&&this.getRgbColorOfReviewer(this._polylines[i].annotation.creatorGuid);colorOfReviewer&&this._polylines[i].raphaelFigure.attr({stroke:colorOfReviewer})}},findPolylineByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._polylines.length;i++){var polyline=this._polylines[i];if(polyline.annotation.guid==annotationGuid)return polyline}return null},moveAnnotationMarkerOnClientPolyline:function(annotationGuid,position,pageNumber,originalPosition){var polyline=this.findPolylineByAnnotationGuid(annotationGuid);if(null!=polyline){var annotation=polyline.annotation;this.updateSvgPathAfterMove(annotation,position.x-originalPosition.left(),position.y-originalPosition.top()),this.deletePolylineByAnnotationGuid(annotationGuid),this.createPolylineAnnotationHandler(annotation)}}}),$.widget("ui.docPolylineAnnotationViewer",$.ui.docTextStrikeoutViewer,{_createViewModel:function(){return new polylineAnnotationViewModel(this.options)},_create:function(){$.ui.docTextStrikeoutViewer.prototype._create.call(this)}})}(jQuery),function($){window.TextField=function(left,top,width,height,text,fontFamily,fontSize){this._init(left,top,width,height,text,fontFamily,fontSize)},$.extend(TextField.prototype,{guid:"",bounds:null,annotation:null,text:null,selectedFontFamily:null,selectedFontSize:null,fontFamilies:["Arial","Verdana","Microsoft Sans Serif"],fontSizes:[10,11,12,13,14,15,16,17],toolbarIsVisible:null,mouseIsOver:null,activated:null,_init:function(left,top,width,height,annotation){this.bounds=ko.observable(new jSaaspose.Rect(left,top,left+width,top+height)),this.text=ko.observable(annotation.text),this.selectedFontFamily=ko.observable(annotation.fontFamily||this.fontFamilies[0]),this.selectedFontSize=ko.observable(annotation.fontSize||this.fontSizes[0]),this.annotation=annotation,this.toolbarIsVisible=ko.observable(!0),this.mouseIsOver=ko.observable(!1),this.activated=ko.observable(!0)}}),window.textFieldModel=function(options){$.extend(this,options),this._init()},$.extend(textFieldModel.prototype,polylineAnnotationModel.prototype,{saveTextField:function(fileId,annotationGuid,text,fontFamily,fontSize,callback,errorCallback){this._portalService.saveTextFieldAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,text,fontFamily,fontSize,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},setTextFieldColor:function(fileId,annotationGuid,fontColor,callback,errorCallback){this._portalService.setTextFieldColorAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,fontColor,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})},setAnnotationBackgroundColor:function(fileId,annotationGuid,color,callback,errorCallback){this._portalService.setAnnotationBackgroundColorAsync($.connection.hub.id,fileId,annotationGuid,color,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})}}),window.textFieldViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(textFieldViewModel.prototype,polylineAnnotationViewModel.prototype,{_textFields:null,fontFamilies:null,fontSizes:null,fontColors:null,_create:function(options){this._model=new textFieldModel(options),this._init(options)},_init:function(options){polylineAnnotationViewModel.prototype._init.call(this,options),this._textFields=ko.observableArray([]),this.fontColors=ko.observableArray([0,16711680,16753920,65280,255]);var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.TextField&&self.deleteTextFieldByAnnotationGuid(annotation.guid)}}),$(this).bind({onAnnotationReceived:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.TextField&&self.receiveTextFieldHandler(annotation)}}),$(this).bind({onAnnotationCreated:function(e,annotation){self.createTextFieldHandler(annotation)}}),$(this).bind({onDocumentLoaded:function(e){self.clearTextFields()}}),$(this).bind({onSetZoom:function(e,scale){self.setTextFieldZoom(scale)}}),$(this).bind({onAnnotationMarkerMovedOnClient:function(e,annotationGuid,position,pageNumber){self.moveAnnotationMarkerOnClientTextField(annotationGuid,position,pageNumber)}})},createTextField:function(pageNumber,bounds){this.createAnnotation(Annotation.prototype.AnnotationType.TextField,pageNumber,bounds,null,null,null,null,null,null,null,null,this.typewriterFont)},createTextFieldHandler:function(annotation){if(annotation.type==Annotation.prototype.AnnotationType.TextField){var bounds=annotation.displayBounds(),selectable=this.getSelectableInstance();null!=selectable._findPageAt(bounds.topLeft)?annotation.startingPoint=bounds.topLeft:null!=selectable._findPageAt(bounds.bottomRight)&&(annotation.startingPoint=bounds.bottomRight);var textField=new TextField(bounds.left(),bounds.top(),bounds.width(),bounds.height(),annotation);textField.annotation.backgroundColor(parseInt((this.textFieldBackgroundColor||"#FFFFFF").replace("#","0x"))),this._textFields.push(textField)}},getDraggableOptionsForTextFields:function(textField){var initialBounds,originalPos,self=this,annotation=textField.annotation;return{start:function(event,ui){self.draggedMarker=!0,initialBounds=annotation.displayBounds(),originalPos=annotation.bounds().topLeft.clone()},drag:function(event,ui){var currentOrigin,currentDisplayOrigin=(self.pageLeft(),new jSaaspose.Point(ui.position.left,ui.position.top));
if(self.storeAnnotationCoordinatesRelativeToPages){var page=self.getSelectableInstance().findPageAtVerticalPosition(currentDisplayOrigin.y);page&&(annotation.pageNumber=parseInt(page.pageId)-1),currentOrigin=self.convertPointToRelativeToPageUnscaledCoordinates(currentDisplayOrigin,currentDisplayOrigin)}else currentOrigin=self.convertPointToAbsoluteCoordinates(currentDisplayOrigin,currentDisplayOrigin);var annotationBounds=annotation.bounds();annotation.bounds(new jSaaspose.Rect(currentOrigin.x,currentOrigin.y,currentOrigin.x+annotationBounds.width(),currentOrigin.y+annotationBounds.height())),self.updateAnnotationDisplayPosition(annotation),textField.bounds(annotation.bounds())},stop:function(event,ui){(initialBounds.left()!=annotation.displayBounds().left()||initialBounds.top()!=annotation.displayBounds().top())&&(self.draggedMarker=!0,self.moveAnnotationMarker(annotation,{x:annotation.bounds().topLeft.x,y:annotation.bounds().topLeft.y},originalPos))},handle:$(".ta_move")}},getDraggableOptionsForResizeMarker:function(textField){var initialBounds,originalSize,previousPosition,self=this,annotation=textField.annotation;return{start:function(event,ui){self.draggedMarker=!0,initialBounds=annotation.displayBounds(),originalSize={width:annotation.bounds().width(),height:annotation.bounds().height()}},drag:function(event,ui){var textBox=ui.helper.parent().find(".doc_text_area_text"),textBoxWidth=textBox.width(),textBoxHeight=textBox.height(),currentWidth=ui.position.left,currentHeight=ui.position.top;0>currentWidth&&(currentWidth=0,ui.position.left=textBoxWidth),0>currentHeight&&(currentHeight=0,ui.position.top=textBoxHeight);var rightBottom,annotationBounds=annotation.bounds(),annotationDisplayBounds=annotation.displayBounds(),displayRightBottom=new jSaaspose.Point(annotationDisplayBounds.left()+currentWidth,annotationDisplayBounds.top()+currentHeight);rightBottom=self.storeAnnotationCoordinatesRelativeToPages?self.convertPointToRelativeToPageUnscaledCoordinates(displayRightBottom,displayRightBottom):self.convertPointToAbsoluteCoordinates(displayRightBottom,displayRightBottom),annotation.bounds(new jSaaspose.Rect(annotationBounds.left(),annotationBounds.top(),rightBottom.x,rightBottom.y)),self.updateAnnotationDisplayPosition(annotation),textField.bounds(annotation.bounds()),textBoxWidth-1>currentWidth&&previousPosition&&(ui.position.left=textBoxWidth),textBoxHeight-1>currentHeight&&previousPosition&&(ui.position.top=textBoxHeight),previousPosition=ui.position},stop:function(event,ui){(initialBounds.width()!=annotation.displayBounds().width()||initialBounds.height()!=annotation.displayBounds().height())&&self.resizeAnnotation(annotation,annotation.bounds().width(),annotation.bounds().height(),originalSize)}}},deleteAnnotationHandler:function(e,annotation){this.deleteTextFieldByAnnotationGuid(annotation.guid)},receiveTextFieldHandler:function(annotation){annotation.type==Annotation.prototype.AnnotationType.TextField&&this.createTextFieldHandler(annotation)},addAnnotationFromAnotherUser:function(data){var newAnnotation=window.polylineAnnotationViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return newAnnotation.type==Annotation.prototype.AnnotationType.TextField&&this.createTextFieldHandler(newAnnotation),newAnnotation},deleteAnnotationOnClient:function(annotationGuid){this.deleteTextFieldByAnnotationGuid(annotationGuid),window.polylineAnnotationViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},clearAllAnnotationOnClient:function(){this._textFields.removeAll(),window.polylineAnnotationViewModel.prototype.clearAllAnnotationOnClient.call(this)},deleteTextFieldByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._textFields().length;i++){var textField=this._textFields()[i];if(textField.annotation.guid==annotationGuid){this._textFields.splice(i,1);break}}},saveTextField:function(textField){if(textField.annotation.guid){var text=jGroupdocs.html.toText(textField.text());this._model.saveTextField(this.fileId,textField.annotation.guid,text,textField.selectedFontFamily(),textField.selectedFontSize(),function(response){}.bind(this),function(error){this._onError(error)}.bind(this))}},setTextFieldColor:function(textField){textField.annotation.guid&&this._model.setTextFieldColor(this.fileId,textField.annotation.guid,textField.annotation.fontColor(),function(response){}.bind(this),function(error){this._onError(error)}.bind(this))},setAnnotationBackgroundColor:function(annotation){annotation.guid&&this._model.setAnnotationBackgroundColor(this.fileId,annotation.guid,annotation.backgroundColor(),function(response){}.bind(this),function(error){this._onError(error)}.bind(this))},updateTextFieldOnClient:function(annotationGuid,text,fontFamily,fontSize){var textField=this.findTextFieldByAnnotationGuid(annotationGuid);null!=textField&&(textField.text(text),textField.selectedFontFamily(fontFamily),textField.selectedFontSize(fontSize))},findTextFieldByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._textFields().length;i++){var textField=this._textFields()[i];if(textField.annotation.guid==annotationGuid)return textField}return null},setTextFieldZoom:function(value){this.updateTextFieldsDisplayPosition(this._textFields,this.createTextFieldHandler)},updateTextFieldsDisplayPosition:function(textFieldsObservableArray,createTextFieldHandler){var i,textFieldCount=textFieldsObservableArray().length;for(i=0;textFieldCount>i;i++){var textField=textFieldsObservableArray()[i],annotation=textField.annotation;this.updateAnnotationDisplayPosition(annotation);var bounds=annotation.bounds().clone();annotation.bounds(bounds)}},clearTextFields:function(){this._textFields.removeAll()},convertRectToScreenCoordinatesForPage:function(rect,resultPageNumber){var pageNumber,selectable=this.getSelectableInstance(),scale=this.scale(),pageHeight=this.getPageHeight();rect.top()<0&&rect.setTop(0),pageNumber=Math.floor(rect.top()*scale/pageHeight);var bounds;return bounds=rect.clone(),bounds.scale(scale),bounds.subtract(new jSaaspose.Point(0,pageNumber*pageHeight)),bounds.add(selectable.pages[resultPageNumber].rect.topLeft),bounds},moveAnnotationMarkerOnClientTextField:function(annotationGuid,position,pageNumber){var textField=this.findTextFieldByAnnotationGuid(annotationGuid);if(null!=textField){var annotation=textField.annotation,annotationBounds=annotation.bounds();annotation.bounds(new jSaaspose.Rect(position.x,position.y,position.x+annotationBounds.width(),position.y+annotationBounds.height())),annotation.pageNumber=pageNumber,this.updateAnnotationDisplayPosition(annotation),textField.bounds(annotation.displayBounds())}},resizeAnnotationOnClient:function(annotationGuid,width,height){var textField=this.findTextFieldByAnnotationGuid(annotationGuid);if(null!=textField){var annotation=textField.annotation;this.setTextFieldSize(annotation,width,height)}},setTextFieldSize:function(annotation,width,height){var annotationBounds=annotation.bounds();annotation.bounds(new jSaaspose.Rect(annotationBounds.left(),annotationBounds.top(),annotationBounds.left()+width,annotationBounds.top()+height)),this.updateAnnotationDisplayPosition(annotation)},setTextFieldColorOnClient:function(annotationGuid,fontColor){var textField=this.findTextFieldByAnnotationGuid(annotationGuid);null!=textField&&textField.annotation.fontColor(fontColor)},setAnnotationBackgroundColorOnClient:function(annotationGuid,color){var textField=this.findTextFieldByAnnotationGuid(annotationGuid);null!=textField&&textField.annotation.backgroundColor(color)}}),$.widget("ui.documentWithTextFieldsViewer",$.ui.docPolylineAnnotationViewer,{_createViewModel:function(){return new textFieldViewModel(this.options)},_create:function(){$.ui.docPolylineAnnotationViewer.prototype._create.call(this)}})}(jQuery),function($){window.Watermark=function(left,top,width,height,text,fontFamily,fontSize){this._init(left,top,width,height,text,fontFamily,fontSize)},$.extend(Watermark.prototype,TextField.prototype,{}),window.watermarkModel=function(options){$.extend(this,options),this._init()},$.extend(watermarkModel.prototype,textFieldModel.prototype,{saveWatermark:function(fileId,annotationGuid,text,fontFamily,fontSize,callback,errorCallback){this._portalService.saveWatermarkAsync($.connection.hub.id,this.userId,this.userKey,fileId,annotationGuid,text,fontFamily,fontSize,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})}}),window.watermarkViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(watermarkViewModel.prototype,textFieldViewModel.prototype,{_watermarks:null,fontFamilies:null,fontSizes:null,_create:function(options){this._model=new watermarkModel(options),this._init(options)},_init:function(options){textFieldViewModel.prototype._init.call(this,options),this._watermarks=ko.observableArray([]);var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.Watermark&&self.deleteWatermarkByAnnotationGuid(annotation.guid)}}),$(this).bind({onAnnotationReceived:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.Watermark&&self.receiveWatermarkHandler(annotation)}}),$(this).bind({onAnnotationCreated:function(e,annotation){self.createWatermarkHandler(annotation)}}),$(this).bind({onDocumentLoaded:function(e){self.clearWatermarks()}}),$(this).bind({onSetZoom:function(e,scale){self.setWatermarkZoom(scale)}}),$(this).bind({onAnnotationMarkerMovedOnClient:function(e,annotationGuid,position,pageNumber){self.moveAnnotationMarkerOnClientWatermark(annotationGuid,position,pageNumber)}})},createWatermark:function(pageNumber,bounds){this.createAnnotation(Annotation.prototype.AnnotationType.Watermark,pageNumber,bounds,null,null,null,null,null,null,null,null,this.watermarkFont)},createWatermarkHandler:function(annotation){if(annotation.type==Annotation.prototype.AnnotationType.Watermark){var bounds=annotation.bounds().clone(),selectable=this.getSelectable().data("ui-dvselectable")||this.getSelectable().data("dvselectable");null!=selectable._findPageAt(bounds.topLeft)?annotation.startingPoint=bounds.topLeft:null!=selectable._findPageAt(bounds.bottomRight)&&(annotation.startingPoint=bounds.bottomRight);var watermark=new TextField(bounds.left(),bounds.top(),bounds.width(),bounds.height(),annotation);this._watermarks.push(watermark)}},deleteAnnotationHandler:function(e,annotation){this.deleteWatermarkByAnnotationGuid(annotation.guid)},receiveWatermarkHandler:function(annotation){annotation.type==Annotation.prototype.AnnotationType.Watermark&&this.createWatermarkHandler(annotation)},addAnnotationFromAnotherUser:function(data){var newAnnotation=window.textFieldViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return newAnnotation.type==Annotation.prototype.AnnotationType.Watermark&&this.createWatermarkHandler(newAnnotation),newAnnotation},deleteAnnotationOnClient:function(annotationGuid){this.deleteWatermarkByAnnotationGuid(annotationGuid),window.textFieldViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},clearAllAnnotationsOnClient:function(){this._watermarks.removeAll(),window.textFieldViewModel.prototype.clearAllAnnotationOnClient.call(this)},deleteWatermarkByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._watermarks().length;i++){var watermark=this._watermarks()[i];if(watermark.annotation.guid==annotationGuid){this._watermarks.splice(i,1);break}}},saveWatermark:function(watermark){if(watermark.annotation.guid){var text=jGroupdocs.html.toText(watermark.text());this._model.saveWatermark(this.fileId,watermark.annotation.guid,text,watermark.selectedFontFamily(),watermark.selectedFontSize(),function(response){}.bind(this),function(error){this._onError(error)}.bind(this))}},updateTextFieldOnClient:function(annotationGuid,text,fontFamily,fontSize){var watermark=this.findWatermarkByAnnotationGuid(annotationGuid);null==watermark?window.textFieldViewModel.prototype.updateTextFieldOnClient.call(this,annotationGuid,text,fontFamily,fontSize):(watermark.text(text),watermark.selectedFontFamily(fontFamily),watermark.selectedFontSize(fontSize))},findWatermarkByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._watermarks().length;i++){var watermark=this._watermarks()[i];if(watermark.annotation.guid==annotationGuid)return watermark}return null},setWatermarkZoom:function(value){this.updateTextFieldsDisplayPosition(this._watermarks,this.createWatermarkHandler)},clearWatermarks:function(){this._watermarks.removeAll()},moveAnnotationMarkerOnClientWatermark:function(annotationGuid,position,pageNumber){var watermark=this.findWatermarkByAnnotationGuid(annotationGuid);if(null!=watermark){var annotation=watermark.annotation,annotationBounds=annotation.bounds();annotation.bounds(new jSaaspose.Rect(position.x,position.y,position.x+annotationBounds.width(),position.y+annotationBounds.height())),annotation.pageNumber=pageNumber,this.updateAnnotationDisplayPosition(annotation),watermark.bounds(annotation.bounds())}},resizeAnnotationOnClient:function(annotationGuid,width,height){var watermark=this.findWatermarkByAnnotationGuid(annotationGuid);if(null!=watermark){var annotation=watermark.annotation;this.setTextFieldSize(annotation,width,height)}window.textFieldViewModel.prototype.resizeAnnotationOnClient.call(this,annotationGuid,width,height)},setTextFieldColorOnClient:function(annotationGuid,fontColor){var watermark=this.findWatermarkByAnnotationGuid(annotationGuid);null!=watermark&&watermark.annotation.fontColor(fontColor),window.textFieldViewModel.prototype.setTextFieldColorOnClient.call(this,annotationGuid,fontColor)},setAnnotationBackgroundColorOnClient:function(annotationGuid,color){var watermark=this.findWatermarkByAnnotationGuid(annotationGuid);null!=watermark&&watermark.annotation.backgroundColor(color),window.textFieldViewModel.prototype.setAnnotationBackgroundColorOnClient.call(this,annotationGuid,color)}}),$.widget("ui.documentWithAnnotationsViewer",$.ui.documentWithTextFieldsViewer,{_createViewModel:function(){return new watermarkViewModel(this.options)},_create:function(){$.ui.documentWithTextFieldsViewer.prototype._create.call(this)}})}(jQuery),function($){window.textReplacementModel=function(options){$.extend(this,options),this._init()},$.extend(textReplacementModel.prototype,watermarkModel.prototype,{}),window.textReplacementViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(textReplacementViewModel.prototype,watermarkViewModel.prototype,{_replacements:null,_margins:{top:50},_create:function(options){this._model=new textReplacementModel(options),this._init(options)},_init:function(options){watermarkViewModel.prototype._init.call(this,options);var self=this;this._replacements=ko.observableArray([]),$(this).bind({onAnnotationReceived:function(e,annotation){self._onReplacementAnnotationCreated(annotation)},onAnnotationCreated:function(e,annotation){self._onReplacementAnnotationCreated(annotation)},onAnnotationRemoved:function(e,annotation){self._onReplacementAnnotationRemoved(annotation)}})},_onReplacementAnnotationCreated:function(annotation){if(annotation.type==Annotation.prototype.AnnotationType.TextReplacement){var bounds=annotation.displayBounds(),pageNumber=annotation.pageNumber,selectable=this.getSelectableInstance();null!=selectable._findPageAt(bounds.topLeft)?annotation.startingPoint=bounds.topLeft:null!=selectable._findPageAt(bounds.bottomRight)&&(annotation.startingPoint=bounds.bottomRight),this.storeAnnotationCoordinatesRelativeToPages?bounds=this.convertPageAndRectToScreenCoordinates(pageNumber,annotation.bounds()):(bounds=this.convertRectToScreenCoordinates(annotation.bounds()),pageNumber=parseInt(selectable.findPageAtVerticalPosition(annotation.bounds().top()).pageId)-1),bounds=bounds.round();var typewriter=new TextField(bounds.left(),bounds.bottom()+this._margins.top,bounds.width(),bounds.height(),annotation);typewriter.toolbarIsVisible(!1),this._replacements.push(typewriter)}},_onReplacementAnnotationRemoved:function(annotation){if(null!=annotation&&annotation.type==Annotation.prototype.AnnotationType.TextReplacement){var i=this._indexOfReplacementAnnotation(annotation.guid);if(i>=0){this._replacements()[i];this._replacements.splice(i,1),this.deselectTextInRect(annotation.bounds(),!1,annotation.pageNumber,annotation.selectionCounter)}}},_indexOfReplacementAnnotation:function(guid){for(var i=0;i<this._replacements().length;i++){var typewriter=this._replacements()[i];if(typewriter.annotation.guid==guid)return i}return-1},setReplacementAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectText),this.annotationModeObservable(Annotation.prototype.AnnotationType.TextReplacement)},createReplacementAnnotation:function(pageNumber,bounds,position,length,selectionCounter,rects){this.createAnnotation(Annotation.prototype.AnnotationType.TextReplacement,pageNumber,bounds,null,null,null,null,selectionCounter,null,rects)},addAnnotationFromAnotherUser:function(data){var annotation=watermarkViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return this._onReplacementAnnotationCreated(annotation),annotation},deleteAnnotationOnClient:function(annotationGuid){var annotation=this.findAnnotation(annotationGuid);this._onReplacementAnnotationRemoved(annotation),watermarkViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},updateTextFieldOnClient:function(annotationGuid,text,fontFamily,fontSize){watermarkViewModel.prototype.updateTextFieldOnClient.call(this,annotationGuid,text,fontFamily,fontSize);var i=this._indexOfReplacementAnnotation(annotationGuid);if(i>=0){var typewriter=this._replacements()[i];typewriter.text(text),typewriter.selectedFontFamily(fontFamily),typewriter.selectedFontSize(fontSize)}}})}(jQuery),function($){var TextRedaction=function(bounds){this._init(bounds)};$.extend(TextRedaction.prototype,{bounds:null,_init:function(bounds){this.bounds=bounds}});var TextRedactionGroup=function(textRedactions,annotation,pageNumber){this._init(textRedactions,annotation,pageNumber)};$.extend(TextRedactionGroup.prototype,{textRedactions:null,annotation:null,_init:function(textRedactions,annotation,pageNumber){this.textRedactions=textRedactions,this.annotation=annotation,this.pageNumber=pageNumber}}),window.textRedactionModel=function(options){$.extend(this,options),this._create(options)},$.extend(textRedactionModel.prototype,textReplacementModel.prototype,{}),textRedactionViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(textRedactionViewModel.prototype,textReplacementViewModel.prototype,{_textRedactionGroups:null,_create:function(options){this._model=new textRedactionModel(options),this._init(options)},_init:function(options){textReplacementViewModel.prototype._init.call(this,options),this._textRedactionGroups=ko.observableArray([]);var self=this;$(this).bind({onAnnotationRemoved:function(e,annotation){annotation.type==Annotation.prototype.AnnotationType.TextRedaction&&self._onTextRedactionAnnotationRemoved(annotation.guid)},onAnnotationReceived:function(e,annotation){self._onTextRedactionAnnotationCreated(annotation)},onAnnotationCreated:function(e,annotation){self._onTextRedactionAnnotationCreated(annotation)},onDocumentLoaded:function(e){self._clearTextRedactions()},onSetZoom:function(e,scale){self._onTextRedactionZoomSet(scale)}})},setTextRedactionAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.SelectText),this.annotationModeObservable(Annotation.prototype.AnnotationType.TextRedaction)},createTextRedactionAnnotation:function(pageNumber,bounds,position,length,selectionCounter,rects){this.createAnnotation(Annotation.prototype.AnnotationType.TextRedaction,pageNumber,bounds,null,null,null,null,selectionCounter,null,rects)},_onTextRedactionAnnotationCreated:function(annotation){if(annotation.type==Annotation.prototype.AnnotationType.TextRedaction){var bounds=annotation.bounds(),selectable=this.getSelectableInstance(),pageNumber=annotation.pageNumber;this.storeAnnotationCoordinatesRelativeToPages?bounds=this.convertPageAndRectToScreenCoordinates(pageNumber,annotation.bounds()):(bounds=this.convertRectToScreenCoordinates(annotation.bounds()),pageNumber=parseInt(selectable.findPageAtVerticalPosition(annotation.bounds().top()).pageId)-1),bounds=bounds.round();for(var rects=selectable.getRowsFromRect(bounds),textRedactionArray=[],textRedaction=null,i=0;i<rects.length;i++)textRedaction=new TextRedaction(rects[i].bounds),textRedactionArray.push(textRedaction);annotation.firstRectBounds=rects[0].bounds,this._textRedactionGroups.push(new TextRedactionGroup(textRedactionArray,annotation,pageNumber)),this.deselectTextInRect(annotation.bounds(),!0,pageNumber,annotation.selectionCounter)}},addAnnotationFromAnotherUser:function(data){var annotation=textReplacementViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return data.annotationType==Annotation.prototype.AnnotationType.TextRedaction&&this._onTextRedactionAnnotationCreated(annotation),annotation},_onTextRedactionAnnotationRemoved:function(groupGuid){for(var i=0;i<this._textRedactionGroups().length;i++){var group=this._textRedactionGroups()[i];if(group.annotation.guid==groupGuid){this._textRedactionGroups.splice(i,1);break}}},deleteAnnotationOnClient:function(annotationGuid){this._onTextRedactionAnnotationRemoved(annotationGuid),textReplacementViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},clearAllAnnotationOnClient:function(){this._clearTextRedactions(),textReplacementViewModel.prototype.clearAllAnnotationOnClient.call(this)},_onTextRedactionZoomSet:function(value){var i,annotationCount=this._textRedactionGroups().length,annotations=[];for(i=0;annotationCount>i;i++){var textRedactionGroup=this._textRedactionGroups()[i];annotations.push(textRedactionGroup.annotation)}for(this._textRedactionGroups.splice(0,annotationCount),i=0;i<annotations.length;i++)this._onTextRedactionAnnotationCreated(annotations[i])},deleteTextRedactionGroup:function(viewModel,group){viewModel.removeAnnotation({guid:group.annotation.guid,type:group.annotation.type}),viewModel._textRedactionGroups.remove(group)},_clearTextRedactions:function(){this._textRedactionGroups.removeAll()}}),$.widget("ui.textRedactionViewer",$.ui.documentWithAnnotationsViewer,{_createViewModel:function(){return new TextRedactionViewModel(this.options)},_create:function(){$("<!-- ko foreach: _textRedactionGroups -->   <!-- ko foreach: textRedactions -->       <div class='redactiontextarea' style='z-index: 25;' data-bind=\"style: { left: $root.pageLeft() + bounds.left() + 'px',                                                        top: bounds.top() + 'px',                                                        width: bounds.width() + 'px',                                                        height: bounds.height() + 'px'},                                                       event: { mouseenter: function() { $root.hoveredAnnotation($parent.annotation); }, mouseleave: function() { $root.hoveredAnnotation(null); } },                                              click: function () { var a = $root.findAnnotation($parent.guid); $root.markerClickHandler(a); } \">       </div>   <!-- /ko --><!-- /ko -->").appendTo(this.options.graphicsContainerElement),$.ui.documentWithAnnotationsViewer.prototype._create.call(this)}})}(jQuery),Raphael.fn.arrow=function(x1,y1,x2,y2){var distance=7,halfDistance=distance/2,angle=Math.atan2(y1-y2,x1-x2),st=this.set();return st.push(this.path(Raphael.format("M{0},{1} L{2},{3}",x1,y1,x2,y2)),this.path(Raphael.format("M{0},{1} L{2},{3} {4},{5}",x2-distance,y2-halfDistance,x2,y2,x2-distance,y2+halfDistance)).transform("R"+Math.round(Raphael.deg(angle-Math.PI))+","+x2+","+y2)),st},function($){window.graphicsAnnotationModel=function(options){$.extend(this,options),this._init()},$.extend(graphicsAnnotationModel.prototype,textReplacementModel.prototype,{}),window.graphicsAnnotationViewModel=function(options){$.extend(this,options),this._create(options)},$.extend(graphicsAnnotationViewModel.prototype,textRedactionViewModel.prototype,{_graphics:null,_arrowEnd:"open-wide-long",_create:function(options){this._model=new graphicsAnnotationModel(options),this._init(options)},_init:function(options){textRedactionViewModel.prototype._init.call(this,options);var self=this;this._graphics=[],$(this).bind({onAnnotationReceived:function(e,annotation){self._onGraphicsAnnotationCreated(annotation)},onAnnotationCreated:function(e,annotation,markerFigure){self._onGraphicsAnnotationCreated(annotation,markerFigure)},onAnnotationRemoved:function(e,annotation){self._onGraphicsAnnotationRemoved(annotation)},onSetZoom:function(e,scale){self._setGraphicsZoom(scale)}}),$(this).bind({onAnnotationMarkerMovedOnClient:function(e,annotationGuid,position,pageNumber,originalPosition){self.moveAnnotationMarkerOnClientGraphic(annotationGuid,position,pageNumber,originalPosition)}})},_onGraphicsAnnotationCreated:function(annotation,markerFigure){if(annotation.type==Annotation.prototype.AnnotationType.Arrow){var bounds=annotation.displayBounds();if(!markerFigure){var selectable=this.getSelectableInstance();null!=selectable._findPageAt(bounds.topLeft)?annotation.startingPoint=bounds.topLeft:null!=selectable._findPageAt(bounds.bottomRight)&&(annotation.startingPoint=bounds.bottomRight);var canvas=this.getCanvas(),arrowPath=["M",bounds.left(),bounds.top(),"L",bounds.right(),bounds.bottom()];markerFigure=canvas.arrow(arrowPath[1],arrowPath[2],arrowPath[4],arrowPath[5])}bounds=bounds.clone().normalize();var bbox=this.getCanvas().rect(bounds.left(),bounds.top(),bounds.width(),bounds.height()).attr({stroke:"none",fill:"#f00","fill-opacity":0,cursor:"pointer"});this.setFigureLook(markerFigure,annotation,this.ArrowToolOptions),this.createClickHandler((bbox||markerFigure).node,annotation),this._makeDraggable(annotation,markerFigure,bbox);var graphics=new AnnotationPolyline(markerFigure,bbox);graphics.setAnnotation(annotation),this._graphics.push(graphics)}},_onGraphicsAnnotationRemoved:function(annotation){annotation.type==Annotation.prototype.AnnotationType.Arrow&&this._removeGraphicsAnnotation(annotation.guid)},_removeGraphicsAnnotation:function(guid){for(var i=0;i<this._graphics.length;i++){var g=this._graphics[i];if(g.annotation.guid==guid){g.deleteScreenFigure(),this._graphics.splice(i,1);break}}},_setGraphicsZoom:function(value){var i,annotations=[];for(i=0;i<this._graphics.length;i++){var marker=this._graphics[i];marker.deleteScreenFigure(),annotations.push(marker.annotation)}for(this._graphics.length=0,i=0;i<annotations.length;i++){var annotation=annotations[i];annotation.svgPath=null,this._onGraphicsAnnotationCreated(annotation)}},setArrowAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.TrackMouseMovement),this.annotationModeObservable(Annotation.prototype.AnnotationType.Arrow)},createGraphicsAnnotation:function(pageNumber,point){var position,previousPoint=point,startingPoint=new jSaaspose.Point(point.left,point.top);position=this.storeAnnotationCoordinatesRelativeToPages?this.convertPointToRelativeToPageUnscaledCoordinates(startingPoint,startingPoint):this.convertPointToAbsoluteCoordinates(startingPoint,startingPoint);var canvas=this.getCanvas(),selectable=this.getSelectable(),self=this,topLeft=new jSaaspose.Point(point.left,point.top),drawingOptions=this._getDrawingOptions(null,this.arrowToolOptions),arrowDrawPath=[point.left,point.top,point.left+1,point.top+1];arrowPath=["M",position.x,position.y,"L",position.x+1,position.y+1],arrow=canvas.arrow(position.x,position.y,position.x+1,position.y+1).attr({stroke:this.getRgbColorFromInteger(drawingOptions.penColor),"stroke-width":drawingOptions.penWidth,"stroke-dasharray":this._dasharray[drawingOptions.penStyle]}),selectable.bind("onMouseDrag",function(e,point){var scale=self.scale(),deltaX=point.left-previousPoint.left,deltaY=point.top-previousPoint.top,unscaledDeltaX=deltaX/scale,unscaledDeltaY=deltaY/scale;arrowPath[4]=unscaledDeltaX,arrowPath[5]=unscaledDeltaY,arrowDrawPath[2]=point.left,arrowDrawPath[3]=point.top,arrow.remove(),arrow=canvas.arrow(arrowDrawPath[0],arrowDrawPath[1],arrowDrawPath[2],arrowDrawPath[3])}),selectable.bind("onMouseMoveStopped",function(){selectable.unbind("onMouseMoveStopped"),selectable.unbind("onMouseDrag");var absoluteBounds,bounds=new jSaaspose.Rect(arrowDrawPath[0],arrowDrawPath[1],arrowDrawPath[2],arrowDrawPath[3]),selectableModel=self.getSelectableInstance();absoluteBounds=self.storeAnnotationCoordinatesRelativeToPages?selectableModel.convertRectToRelativeToPageUnscaledCoordinates(bounds,topLeft):selectableModel.convertRectToAbsoluteCoordinates(bounds,topLeft);var drawingOptions=self._getDrawingOptions(null,self.arrowToolOptions),svgPath=window.jGroupdocs.stringExtensions.format("M{0},{1} L{2},{3}",arrowPath[1],arrowPath[2],arrowPath[4],arrowPath[5]);self.createAnnotation(Annotation.prototype.AnnotationType.Arrow,pageNumber,absoluteBounds,null,null,arrow,svgPath,null,drawingOptions)})},addAnnotationFromAnotherUser:function(data){var annotation=textRedactionViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return annotation.type==Annotation.prototype.AnnotationType.Arrow&&this._onGraphicsAnnotationCreated(annotation),annotation},deleteAnnotationOnClient:function(annotationGuid){this._removeGraphicsAnnotation(annotationGuid),textRedactionViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},findGraphicByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._graphics.length;i++){var graphic=this._graphics[i];if(graphic.annotation.guid==annotationGuid)return graphic}return null},moveAnnotationMarkerOnClientGraphic:function(annotationGuid,position,pageNumber,originalPosition){var graphic=this.findGraphicByAnnotationGuid(annotationGuid);if(null!=graphic){var annotation=graphic.annotation;this.updateSvgPathAfterMove(annotation,position.x-originalPosition.left(),position.y-originalPosition.top()),this._removeGraphicsAnnotation(annotationGuid),this._onGraphicsAnnotationCreated(annotation)}}})}(jQuery),Raphael.fn.doubleArrow=function(x1,y1,x2,y2){var distance=7,halfDistance=distance/2,angle=Math.atan2(y1-y2,x1-x2),st=this.set();return st.push(this.path(Raphael.format("M{0},{1} L{2},{3} {4},{5}",x1+distance,y1-halfDistance,x1,y1,x1+distance,y1+halfDistance)).transform("R"+Math.round(Raphael.deg(angle-Math.PI))+","+x1+","+y1),this.path(Raphael.format("M{0},{1} L{2},{3}",x1,y1,x2,y2)),this.path(Raphael.format("M{0},{1} L{2},{3} {4},{5}",x2-distance,y2-halfDistance,x2,y2,x2-distance,y2+halfDistance)).transform("R"+Math.round(Raphael.deg(angle-Math.PI))+","+x2+","+y2)),st},Raphael.fn.ruler=function(x1,y1,x2,y2,scale){var d=25,textDistance=10,lineDistance=8,angle=1.5*Math.PI-Math.atan2(y1-y2,x1-x2),angleCos=Math.cos(angle),angleSin=Math.sin(angle),deltaX=d*angleCos,deltaY=d*angleSin,lineDeltaX=lineDistance*angleCos,lineDeltaY=lineDistance*angleSin,line={left:x1-lineDeltaX,top:y1+lineDeltaY,right:x2-lineDeltaX,bottom:y2+lineDeltaY},x0=x1-deltaX,y0=y1+deltaY,x3=x2-deltaX,y3=y2+deltaY,len=Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2)),label=Math.round(len/scale)+"px",st=this.set(),curve=this.path(Raphael.format("M{0},{1} L{2},{3} M{4},{5} L{6},{7} M{8},{9} L{10},{11}",x0,y0,x1,y1,line.left,line.top,line.right,line.bottom,x2,y2,x3,y3)),center=curve.getPointAtLength(len/2+d);return st.push(curve,this.doubleArrow(line.left,line.top,line.right,line.bottom),this.text(center.x+textDistance*angleCos,center.y-textDistance*angleSin,label).transform("R"+Math.round(Raphael.deg(Math.PI/2-angle)))),st.label=label,st},function($){window.measurementAnnotationModel=function(options){$.extend(this,options),this._init()},$.extend(measurementAnnotationModel.prototype,graphicsAnnotationModel.prototype,{}),window.measurementAnnotationViewModel=function(options){$.extend(this,options),
this._create(options)},$.extend(measurementAnnotationViewModel.prototype,graphicsAnnotationViewModel.prototype,{_measurements:null,_create:function(options){this._model=new measurementAnnotationModel(options),this._init(options)},_init:function(options){graphicsAnnotationViewModel.prototype._init.call(this,options);var self=this;this._measurements=[],$(this).bind({onAnnotationReceived:function(e,annotation){self._onMeasurementAnnotationCreated(annotation)},onAnnotationCreated:function(e,annotation,markerFigure){self._onMeasurementAnnotationCreated(annotation,markerFigure)},onAnnotationRemoved:function(e,annotation){self._onMeasurementAnnotationRemoved(annotation)},onSetZoom:function(e,scale){self._setMeasurementsZoom(scale)}}),$(this).bind({onAnnotationMarkerMovedOnClient:function(e,annotationGuid,position,pageNumber,originalPosition){self.moveAnnotationMarkerOnClientMeasurement(annotationGuid,position,pageNumber,originalPosition)}})},_onMeasurementAnnotationCreated:function(annotation,markerFigure){if(annotation.type==Annotation.prototype.AnnotationType.Distance){var canvas=this.getCanvas();if(!markerFigure){var scale=this.scale(),selectable=this.getSelectableInstance(),bounds=annotation.displayBounds(),pageOffset={x:0,y:0};if(annotation.svgPath){var pattern=" l",re=new RegExp(pattern,"g"),points=annotation.svgPath.substring(1,annotation.svgPath.length-1).replace(re,"l").split("l"),topLeft=points[0].split(","),rightBottom=points[1].split(","),left=parseFloat(topLeft[0]),top=parseFloat(topLeft[1]),offsetX=parseFloat(rightBottom[0]),offsetY=parseFloat(rightBottom[1]),pageNumber=0;if(this.storeAnnotationCoordinatesRelativeToPages)pageNumber=annotation.pageNumber;else{var pageHeight=selectable.options.pageHeight;pageNumber=Math.floor(top*scale/pageHeight),top-=pageNumber*pageHeight}pageOffset.x=selectable.pages[pageNumber].rect.left(),pageOffset.y=selectable.pages[pageNumber].rect.top(),bounds=new jSaaspose.Rect(left,top,left+(isNaN(offsetX)?0:offsetX),top+(isNaN(offsetY)?0:offsetY),!1),scale=this.scale()}markerFigure=canvas.ruler(pageOffset.x+bounds.left()*scale,pageOffset.y+bounds.top()*scale,pageOffset.x+bounds.right()*scale,pageOffset.y+bounds.bottom()*scale,this.scale())}var bboxBounds=markerFigure.getBBox(),bbox=canvas.rect(bboxBounds.x,bboxBounds.y,bboxBounds.width,bboxBounds.height).attr({stroke:"none",fill:"#f00","fill-opacity":0,cursor:"pointer"});this.setFigureLook(markerFigure,annotation),this.createClickHandler((bbox||markerFigure).node,annotation),this._makeDraggable(annotation,markerFigure,bbox);var ruler=new AnnotationPolyline(markerFigure,bbox);ruler.setAnnotation(annotation),this._measurements.push(ruler)}},_onMeasurementAnnotationRemoved:function(annotation){annotation.type==Annotation.prototype.AnnotationType.Distance&&this._removeMeasurementAnnotation(annotation.guid)},_removeMeasurementAnnotation:function(guid){for(var i=0;i<this._measurements.length;i++){var r=this._measurements[i];if(r.annotation.guid==guid){r.deleteScreenFigure(),this._measurements.splice(i,1);break}}},_setMeasurementsZoom:function(value){var i,annotations=[];for(i=0;i<this._measurements.length;i++){var marker=this._measurements[i];marker.deleteScreenFigure(),annotations.push(marker.annotation)}for(this._measurements.length=0,i=0;i<annotations.length;i++){var annotation=annotations[i];this._onMeasurementAnnotationCreated(annotation)}},setDistanceAnnotationMode:function(){this.setAnnotationMode($.ui.dvselectable.prototype.SelectionModes.TrackMouseMovement),this.annotationModeObservable(Annotation.prototype.AnnotationType.Distance)},createDistanceAnnotation:function(pageNumber,point){var canvas=this.getCanvas(),selectable=this.getSelectable(),self=this,scale=this.scale(),topLeft=new jSaaspose.Point(point.left,point.top),bottomRight=point,drawingOptions=this._getDrawingOptions(null),ruler=canvas.ruler(point.left,point.top,point.left,point.top,scale).attr({stroke:this.getRgbColorFromInteger(drawingOptions.penColor)});selectable.bind("onMouseDrag",function(e,point){bottomRight=point,ruler.remove(),ruler=canvas.ruler(topLeft.x,topLeft.y,point.left,point.top,scale)}),selectable.bind("onMouseMoveStopped",function(){selectable.unbind("onMouseMoveStopped"),selectable.unbind("onMouseDrag");var bbox=ruler.getBBox();selectableModel=self.getSelectableInstance(),bounds=new jSaaspose.Rect(bbox.x,bbox.y,bbox.x2,bbox.y2),absoluteBounds=self.storeAnnotationCoordinatesRelativeToPages?selectableModel.convertRectToRelativeToPageUnscaledCoordinates(bounds,topLeft):selectableModel.convertRectToAbsoluteCoordinates(bounds,topLeft),absoluteTopLeft=self.storeAnnotationCoordinatesRelativeToPages?self.convertPointToRelativeToPageUnscaledCoordinates(topLeft,topLeft):self.convertPointToAbsoluteCoordinates(topLeft,topLeft),drawingOptions=self._getDrawingOptions(null,self.rulerToolOptions),svgPath=window.jGroupdocs.stringExtensions.format("M{0},{1} l{2},{3}",absoluteTopLeft.x,absoluteTopLeft.y,(bottomRight.left-topLeft.x)/scale,(bottomRight.top-topLeft.y)/scale),self.createAnnotation(Annotation.prototype.AnnotationType.Distance,pageNumber,absoluteBounds,null,null,ruler,svgPath,null,drawingOptions,null,ruler.label)})},addAnnotationFromAnotherUser:function(data){var annotation=graphicsAnnotationViewModel.prototype.addAnnotationFromAnotherUser.call(this,data);return annotation.type==Annotation.prototype.AnnotationType.Distance&&this._onMeasurementAnnotationCreated(annotation),annotation},deleteAnnotationOnClient:function(annotationGuid){this._removeMeasurementAnnotation(annotationGuid),graphicsAnnotationViewModel.prototype.deleteAnnotationOnClient.call(this,annotationGuid)},findMeasurementByAnnotationGuid:function(annotationGuid){for(var i=0;i<this._measurements.length;i++){var measurement=this._measurements[i];if(measurement.annotation.guid==annotationGuid)return measurement}return null},moveAnnotationMarkerOnClientMeasurement:function(annotationGuid,position,pageNumber,originalPosition){var measurement=this.findMeasurementByAnnotationGuid(annotationGuid);if(null!=measurement){var annotation=measurement.annotation;this.updateSvgPathAfterMove(annotation,position.x-originalPosition.left(),position.y-originalPosition.top()),this._removeMeasurementAnnotation(annotationGuid),this._onMeasurementAnnotationCreated(annotation)}}}),$.widget("ui.documentAnnotation",$.ui.textRedactionViewer,{_createViewModel:function(){return new measurementAnnotationViewModel(this.options)},_create:function(){$.ui.textRedactionViewer.prototype._create.call(this)}})}(jQuery),ko.bindingHandlers.focused={init:function(element,valueAccessor,allBindingsAccessor,viewModel){$(element).focus()}},function($){var AnnotationTools={Text:1,Area:2,Point:4,TextStrikeout:8,Polyline:16,TextField:32,Watermark:64,TextReplacement:128,Arrow:256,TextRedaction:512,ResourcesRedaction:1024,TextUnderline:2048,Distance:4096};$.widget("ui.groupdocsAnnotation",$.ui.groupdocsViewer,{_viewer:null,_adapter:null,_importerUploader:null,viewerViewModel:null,options:{enableViewerInit:!1,textSelectionSynchronousCalculation:!0,usePageNumberInUrlHash:!1,variableHeightPageSupport:!0,useJavaScriptDocumentDescription:!0,saveReplyOnFocusLoss:!0,createMarkup:!0,showSearch:!0,undoEnabled:!0,tooltipsEnabled:!0,textSelectionEnabled:!1,textSelectionByCharModeEnabled:!1,use_pdf:"true",_mode:"annotatedDocument"},_create:function(){this.options.showPrint&=this.options.showHeader,this.options.showPaging&=this.options.showHeader,this.options.showZoom&=this.options.showHeader,this.options.showSearch&=this.options.showHeader,this.options.createMarkup&&this._createMarkup(),$.ui.groupdocsViewer.prototype._create.apply(this,arguments);var self=this;this._viewer=this.element.find(".doc_viewer").groupdocsAnnotationViewer($.extend(this.options,{graphicsContainerElement:self.element.find(self.options.graphicsContainerSelector),selectionContent:self.element.find(self.options.selectionContainerSelector),rightSideElement:self.element.find(self.options.sideboarContainerSelector),exportingAnnotationsProgress:self.element.find(".export_annotations_modal"),importingAnnotationsProgress:self.element.find(".importing_annotations_modal"),element:self.element,showHyperlinks:!1,storeAnnotationCoordinatesRelativeToPages:!0,baseAvatarUrl:self.applicationPath+"GetAvatar"+(self.useHttpHandlers?"Handler":"")+"?userId=",imageHorizontalMargin:0,redactionToolOptions:{pen:{width:1,color:3355443,dashStyle:0},brush:{color:3355443}}}));var viewerViewModel=this.viewerViewModel=this._viewer.groupdocsAnnotationViewer("getViewModel");this.getViewModel().viewerAdapter=this._adapter=viewerViewModel.viewerAdapter=new DocViewerAdapter({docSpaceCreator:function(){return self._viewer},docSpaceViewModel:function(){return viewerViewModel},navigation:this.options.showPaging?this.element.find(".navigation-bar"):null,navigationOptions:{createHtml:!0},zooming:this.options.showZoom?this.element.find(".zoom_wrappper"):null,zoomingOptions:{createHtml:!0},thumbnails:this.options.showThumbnails?this.element.find(".viewer_mainwrapper"):null,thumbnailsOptions:{createHtml:!0},search:this.options.showSearch?this.element.find("[name='search_wrapper']"):null,searchOptions:{createHtml:!0,viewerElement:this.element.find(".doc_viewer"),searchIsVisible:this.options.showSearch}}),this.options.showPaging||$(this.element.find(".navigation-bar")).hide(),$("html").click(function(){self._adapter.zoomViewModel&&self._adapter.zoomViewModel.showDropDownMenu(!1),viewerViewModel.exportMenuOpened(!1),viewerViewModel.printMenuOpened(!1)});var thumbsButton=this.element.find(".thumbs_btn");if(thumbsButton.click(function(){return $(this).toggleClass("thumbs_btn_slide","slow"),self.element.find(".thumbnailsContainer").toggle("slide","slow",function(){$.browser.msie&&thumbsButton.css("background-image","")}),!1}),this.element.find(".comments_sidebar_expanded").tabs({selected:2,show:!1,hide:!1,activate:function(event,ui){self.element.find(".comments_scroll").tinyscrollbar_update("relative")}}),this._viewer.bind("onTextSelected",function(e,pageNumber,bounds,position,length,selectionCounter,rects){switch(viewerViewModel.annotationModeObservable()){case Annotation.prototype.AnnotationType.TextReplacement:viewerViewModel.createReplacementAnnotation(pageNumber,bounds,position,length,selectionCounter,rects);break;case Annotation.prototype.AnnotationType.TextRedaction:viewerViewModel.createTextRedactionAnnotation(pageNumber,bounds,position,length,selectionCounter,rects);break;case Annotation.prototype.AnnotationType.TextUnderline:viewerViewModel.createTextUnderline(pageNumber,bounds,position,length,selectionCounter,rects);break;case Annotation.prototype.AnnotationType.Text:viewerViewModel.createTextAnnotation(pageNumber,bounds,position,length,selectionCounter,rects)}}),this._viewer.bind("onTextToStrikeoutSelected",function(e,pageNumber,bounds,position,length,selectionCounter,rects){viewerViewModel.createTextStrikeout(pageNumber,bounds,position,length,selectionCounter,rects)}),this._viewer.bind("onRectangleSelected",function(e,pageNumber,bounds){switch(viewerViewModel.annotationModeObservable()){case Annotation.prototype.AnnotationType.Area:viewerViewModel.createAreaAnnotation(pageNumber,bounds);break;case Annotation.prototype.AnnotationType.ResourcesRedaction:viewerViewModel.createResourcesRedactionAnnotation(pageNumber,bounds);break;case Annotation.prototype.AnnotationType.TextField:viewerViewModel.createTextField(pageNumber,bounds);break;case Annotation.prototype.AnnotationType.Watermark:viewerViewModel.createWatermark(pageNumber,bounds)}}),this._viewer.bind("onPointClicked",function(e,pageNumber,bounds){viewerViewModel.createPointAnnotation(pageNumber,bounds)}),this._viewer.bind("onMouseMoveStarted",function(e,pageNumber,point){switch(viewerViewModel.annotationModeObservable()){case Annotation.prototype.AnnotationType.Arrow:viewerViewModel.createGraphicsAnnotation(pageNumber,point);break;case Annotation.prototype.AnnotationType.Distance:viewerViewModel.createDistanceAnnotation(pageNumber,point);break;default:viewerViewModel.createPolylineAnnotation(pageNumber,point)}}),this.options.showToolbar&&ko.applyBindings(viewerViewModel,$(this.element).find("div.embed_annotation_tools").get(0)),this.options.showHeader&&(ko.applyBindings(viewerViewModel,$(this.element).find(".tools_wrapper").get(0)),ko.applyBindings(viewerViewModel,$(this.element).find(".undo-bar").get(0))),ko.applyBindings(viewerViewModel,$(this.element).find(".comments_sidebar_wrapper").get(0)),ko.applyBindings(viewerViewModel,$(this.element).find("#addCollaboratorTab").get(0)),ko.applyBindings(viewerViewModel,$(this.element).find(".viewer_alerts").get(0)),this.options.showThumbnails||$(this.element).find(".thumbs_btn").hide(),this.options.openThumbnails?($(this.element).find(".thumbs_btn").addClass("thumbs_btn_slide"),$(this.element).find(".thumbnailsContainer").css("display","block")):$(this.element).find(".thumbnailsContainer").css("display","none"),this.options.enableRightClickMenu||($(this.element).get(0).oncontextmenu=function(){return!1}),this.options.showFileExplorer){var fod=$(this.element).find(".fileOpenDialogWrapper").fileOpenDialog({hostUrl:$.ui.groupdocsViewer.prototype.applicationPath,fileExplorer:$(this.element).find(".file_browser_content"),fileUploader:$(this.element).find(".file_browser_toolbar"),resourcePrefix:this.options.resourcePrefix,urlHashEnabled:!1});fod.bind("fileSelected",function(e,metadata){viewerViewModel.onFileSelected(metadata),$(fod).modal("hide"),$(".loading_overlay_message").show()}),$(fod).css({display:"none"})}this._importerUploader=$(this.element).find(".import_file_uploader").uploader({url:self.applicationPath+"",proxy:"UploadFile"+(this.useHttpHandlers?"Handler":""),fld:"Uploads",multiple:!0,addFileBtn:$(this.element).find(".import_btn")}),this._importerUploader.bind("onStart",function(e,id,fileName,fileSize){}),this._importerUploader.bind("onComplete",function(e,id,metadata){this.viewerViewModel.importDocumentAnnotations(metadata.fileId)}.bind(this)),this.tooltipsEnabled&&($(".wt-icon").click(expandAnnotationTooltip),$(".wt-close").click(function(e){e.preventDefault(),$(this).parents(".wt-container").hide()}),$(".icon-expand").click(function(e){e.preventDefault(),$(this).parents(".overflowed").removeClass("overflowed"),$(".scrollbar").customScrollbar()})),this.initControlsAndHandlers()},_createMarkup:function(){var groupdocsViewerWrapper=this._groupdocsViewerWrapperMarkup(),viewerMarkup=this._viewerMarkup();viewerMarkup.appendTo(groupdocsViewerWrapper),this.options.showToolbar&&this._toolboxMarkup().appendTo(groupdocsViewerWrapper),this._localizeControl(this._sidebarMarkup()).appendTo(groupdocsViewerWrapper),this._modalsMarkup().appendTo(groupdocsViewerWrapper),groupdocsViewerWrapper.appendTo(this.element)},_localizeControl:function(control){var phraseMatch,sourceText=control[0].innerHTML,pattern=new RegExp("(@)(localize)(\\()((?:[a-z][a-z]+))(\\))",["i"]);do if(phraseMatch=pattern.exec(sourceText)){var phrase=phraseMatch[0],internalPattern=new RegExp(".*?(?:[a-z][a-z]+).*?((?:[a-z][a-z]+))",["i"]),key=internalPattern.exec(phrase),localizedWord=null!=this.options.localizedStrings&&this.options.localizedStrings[key[1]]?this.options.localizedStrings[key[1]]:key[1];localizedWord&&(sourceText=sourceText.replace(phrase,localizedWord),control[0].innerHTML=sourceText)}while(phraseMatch);return control},_groupdocsViewerWrapperMarkup:function(){return $('<div class="groupdocs_viewer_wrapper grpdx">')},_viewerMarkup:function(){var html="";return 0==this.element.find('[name="selection-content"]').length&&(html+='  <textarea readonly="readonly" rows="1" cols="1" style="display: block !important" id="selection-content" name="selection-content" class="mousetrap"></textarea>'),html+=""+(this.options.showHeader?this._toolbarMarkup():"")+"  <div class=\"fileOpenDialogWrapper\"></div>  <div class=\"viewer_alerts\">    <div data-bind=\"visible: !licensed()\" class=\"banner_trial\" style=\"position: inherit;\">This has been created using an unlicensed version of <a href=\"http://groupdocs.com\" target=\"_blank\">GroupDocs.Annotation</a> for Java v2.0.0 </div>  </div>  <div class=\"viewer_mainwrapper\">    <div class=\"doc_viewer\" data-bind=\"event: { scroll: function(item, e) { this.ScrollDocView(item, e); }, scrollstop: function(item, e) { this.ScrollDocViewEnd(item, e);e.returnValue = false;return true; } }\">      <div class=\"pages_container\" data-bind=\"css: { 'auto_cursor': ($root.annotationModeObservable() == null),                                        'textanno_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Text),                                        'pointanno_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Point),                                        'area_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Area),                                        'strikeout_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.TextStrikeout),                                        'polyline_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Polyline),                                        'typewritter_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.TextField),                                        'watermark_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Watermark),                                        'crossarrow_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Arrow),                                        'crossarea_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.TextRedaction),                                        'underline_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.TextUnderline),                                        'crossruler_cursor': ($root.annotationModeObservable() == Annotation.prototype.AnnotationType.Distance),                                      }\">"+(this.options.tooltipsEnabled?this._tooltipMarkupt():"")+"        <div class=\"annotationsContainer\">          <div data-bind=\"with: $root.activeAnnotation()\">            <div data-bind=\"with: displayBounds().clone().normalize()\">              <div class=\"transformtool\" data-bind=\"style: { left: left() + 'px', top: top() + 'px', width: width() + 'px', height: height() + 'px' }\">                <div class=\"bd_lr\"></div>              </div>            </div>          </div>          <!-- ko foreach: annotations -->            <span class=\"document_anno_icon\" style=\"position: absolute\"               data-bind=\"visible: commentsEnabled === true,                         css: { 'text_anno': type == 0,                                 'area_anno': type == 1,                                 'point_anno': type == 2,                                 'polyline_anno': type == 4,                                 'replacetext_anno': type == 7,                                 'replace_anno': type == 8,                                 'arrow_anno': type == 9,                                 'redtext_anno': type == 10,                                 'redarea_anno': type == 11,                                 'underline_anno': type == 12,                                 'ruler_anno': type == 13,                                 'current_anno': $data == $parent.activeAnnotation() },                         style: { left: $root.pageLeft() + annotationSideIconDisplayPosition().x + 'px',                                   top: annotationSideIconDisplayPosition().y + 'px' },                          click: function(data, e) { $root.showExpandedCommentsPanel();                                                    $root.activeAnnotation($data);                                                     $('.comments_scroll').tinyscrollbar_update('relative');                                                     return true; },                          clickBubble: false\">            </span>          <!-- /ko -->          <!-- ko foreach: _points -->            <span class=\"delete_button_x\" data-bind=\"style: {left: $data.annotation.displayBounds().left() - $data.markerWidth/2 - 15 + 'px',                   top: $data.annotation.displayBounds().top() - $data.markerHeight/2 + 5 + 'px'},                   click: function() { $root.removeAnnotation($data.annotation); }, clickBubble: false,                  visible: deleteIconIsVisible(),                  event: { mouseenter: function() { $data.deleteIconIsVisible(true); }, mouseleave: function() { $data.deleteIconIsVisible(false); } }\">            </span>            <div class=\"red_pointer\" data-bind=\"style: { left: $data.annotation.displayBounds().left() - $data.markerWidth/2 + 'px',                  top: $data.annotation.displayBounds().top() - $data.markerHeight/2 + 'px' },                  click: $root.markerClickHandler.bind($root, $data.annotation),                 event: { mouseenter: function() { $data.deleteIconIsVisible(true); $root.hoveredAnnotation($data.annotation); }, mouseleave: function() { $data.deleteIconIsVisible(false); $root.hoveredAnnotation(null); } },                 makeDraggable: $root.getDraggableOptions($data.annotation)\">              <span class=\"ta_tooltip ta_tp_move\">                <p data-bind=\"foreach: annotation.replies\"><i data-bind=\"text: userName + ': '\"></i><span data-bind=\"text: text\" /></p>                <span class=\"ta_tooltip_pointer\"></span>              </span>            </div>          <!-- /ko -->          <!-- ko foreach: _textFields -->            <div style=\"display: none;z-index:1\" class=\"doc_text_area\"                  data-bind=\"style: {left: $data.annotation.displayBounds().left() + 'px', top: $data.annotation.displayBounds().top() + 'px', display: 'block'},                  makeDraggable: $root.getDraggableOptionsForTextFields($data)\">              <div class=\"doc_text_area_text mousetrap\"                   data-bind=\"htmlValue: text,                      style: {minWidth: $data.annotation.displayBounds().width() + 'px', minHeight: $data.annotation.displayBounds().height() + 'px', display: 'block',                             fontFamily: $data.selectedFontFamily(), fontSize: $data.selectedFontSize().toString() + 'px',                             color: $root.getRgbColorFromInteger($data.annotation.fontColor() || 0),                             backgroundColor: $root.getRgbColorFromInteger($data.annotation.backgroundColor())                             },                     attr: {contenteditable: true},                     event: { koValueUpdated: function(){$root.saveTextField($data);$data.toolbarIsVisible(false);return true;},                         mouseover: function() { if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseDestroy(); } },                          mouseout: function() { if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseInit(); } }                     },                     click: function() { $data.toolbarIsVisible(true); return true; },                     hasfocus: $data.activated()\"                   spellcheck=\"false\">              </div>"+this._textfieldToolbarMarkup()+'            </div>          <!-- /ko -->          <!-- ko foreach: _replacements -->            <div style="display: none; z-index: 1" class="doc_text_area"                  data-bind="style: { left: $data.annotation.displayBounds().left() + \'px\', top: $data.annotation.displayBounds().bottom() + 34 + \'px\', display: \'block\' }, click: function () { $root.showExpandedCommentsPanel(); $data.annotation.deactivateActiveReply(); $root.activeAnnotation($data.annotation); }">              <div class="replace_tab">Replace</div>              <div class="doc_text_area_text mousetrap" data-bind="htmlValue: text,                    style: { minWidth: $data.annotation.displayBounds().width() + \'px\', minHeight: $data.annotation.displayBounds().height() + \'px\', display: \'block\' },                   attr: { contenteditable: true },                   event: { koValueUpdated: function() { $root.saveTextField($data); return true; },                       mouseover: function() { if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseDestroy(); } },                        mouseout: function() { if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseInit(); } }                   }"                   spellcheck="false">              </div>            </div>          <!-- /ko -->'+this._watermarksMarkup()+'        </div>        <!-- ko foreach: pages -->          <div class="doc-page centered_doc_page" data-bind="attr: {id: $parent.pagePrefix + number}, style: { width: $parent.pageWidth() + \'px\', height: $parent.pageWidth() * $data.prop() + \'px\', marginLeft: ($root.fullSynchronization ? \'auto\' : \'\'), marginRight: ($root.fullSynchronization ? \'auto\' : \'\') }">            <div class="viewer_loading_overlay" data-bind="style: { zIndex: ($root.inprogress() || !visible() ? 2 : 0), width: $parent.pageWidth() + \'px\', height: $root.useTabsForPages() ? \'100%\' : ($parent.pageWidth() * $data.prop() + \'px\'), backgroundColor: ($root.inprogress() || !visible() ? \'\' : \'transparent\')}" style="width: 850px; height: 1100px;position: absolute;left:0;top:0">              <div class="loading_overlay_message">                <span class="progresspin"></span>                <p data-localize="LoadingYourContent">Loading your content...</p>              </div>            </div>            <div class="button-pane"></div>            <div class="highlight-pane"></div>            <div class="custom-pane"></div>            <div class="search-pane"></div>            <img class="page-image" data-bind="attr: { id: \'img-\' + number, src: (visible() ? url : \'\') },                                            style: { width: $parent.pageWidth() + \'px\', height: $parent.pageWidth() * $data.prop() + \'px\' }"/>          </div>        <!-- /ko -->      </div>    </div>    <a class="thumbs_btn" href="#"></a>  </div>',$($.trim(html))},_toolbarMarkup:function(){return'  <div class="viewer_header header_sidescroll">    <div class="viewer_header_wrapper">      <div class="new_head_tools_wrapper left tools_wrapper" data-bind="visible: (canExport() || canDownload() || fileExplorerEnabled() || printEnabled())">        <div class="new_head_tools_dropdown_wrapper" data-bind="visible: (canExport() || canDownload())">          <a class="new_head_tools_btn head_tool_dropdown_btn h_t_i_export link_with_pointer_cursor" data-tooltip="Export"  data-localize-tooltip="Export" data-bind="click: toggleExportMenu"></a>          <ul class="dropdown-menu head_tool_dropdown head_tool_dropdown_export" style="display: none;" data-bind="style: { display: (exportMenuOpened() ? \'block\' : \'none\' )}">            <li style="display: inline" data-bind="visible: canExport()">              <a id="btnExportToDoc" class="link_with_pointer_cursor" data-bind="click: function() { exportAnnotationsTo(\'words\', Annotation.prototype.AnnotationExportMode.TrackChanges); }, visible: docType() == \'Words\'">                <span class="h_t_d_i_doc"></span>                <p  data-localize="DOCWithChangesTrack">DOC With Changes Track</p>              </a>            </li>            <li style="display: inline" data-bind="visible: canExport()">              <a id="btnExportToDoc" class="link_with_pointer_cursor" data-bind="click: function() { exportAnnotationsTo(\'words\'); }, visible: docType() == \'Words\'">                <span class="h_t_d_i_doc"></span>                <p data-localize="DOCWithComments">DOC With Comments</p>              </a>            </li>            <li style="display: inline" data-bind="visible: canExport()">              <a id="btnExport" class="link_with_pointer_cursor" data-bind="click: function() { exportAnnotationsTo(); }">                <span class="h_t_d_i_pdf"></span>                <p data-localize="PDFWithComments">PDF With Comments</p>              </a>            </li>            <li style="display: inline" data-bind="visible: canExport()">              <a id="btnExportWithoutComments" class="link_with_pointer_cursor" data-bind="click: getPdfVersionOfDocument">                <span class="h_t_d_i_pdf"></span>                <p data-localize="PDFWithoutComments">PDF W/O Comments</p>              </a>            </li>            <li style="display: inline" data-bind="visible: canDownload()">              <a id="btnExportOriginal" class="link_with_pointer_cursor" data-bind="click: downloadDocument">                <span class="h_t_d_i_normal"></span>                <p data-localize="OriginalDocument">Original Document</p>              </a>            </li>          </ul>        </div>        <a class="new_head_tools_btn h_t_i_import import_btn import_file_uploader" data-tooltip="Import annotations" data-localize-tooltip="ImportAnnotations"></a>        <a data-bind="visible: fileExplorerEnabled, click: openFileExplorer" class="btnOpen new_head_tools_btn h_t_i_browser" data-tooltip="Open file" data-localize-tooltip="OpenFile"></a>        <div class="new_head_tools_dropdown_wrapper" data-bind="visible: printEnabled">          <a class="new_head_tools_btn h_t_i_print print_button head_tool_dropdown_btn" data-bind="click: togglePrintMenu" data-tooltip="Print file" data-localize-tooltip="Print"></a>          <ul class="dropdown-menu head_tool_dropdown head_tool_dropdown_export" data-bind="style: { display: (printMenuOpened() ? \'block\' : \'none\' )}">            <li><a class="link_with_pointer_cursor" data-bind="click: printDocument"><span class="h_t_d_printclear"></span><p data-localize="PrintWithoutAnnotations">Without annotations</p></a></li>            <li><a class="link_with_pointer_cursor" data-bind="click: function () { this.printAnnotations(); }"><span class="h_t_d_printanno"></span><p data-localize="PrintWithAnnotations">With annotations</p></a></li>          </ul>        </div>      </div>      <div class="new_head_tools_wrapper navigation-bar">      </div>      <div class="new_head_tools_wrapper zoom_wrappper">      </div>      <div class="new_head_tools_wrapper undo-bar" data-bind="visible: undoEnabled">        <div class="left">          <a class="new_head_tools_btn h_t_i_undo" href="#" data-bind="click: undo, css: { disabled: !_undoRedo.canUndoObservable() }" data-tooltip="Undo" data-localize-tooltip="Undo"></a>          <a class="new_head_tools_btn h_t_i_redo" href="#" data-bind="click: redo, css: { disabled: !_undoRedo.canRedoObservable() }" data-tooltip="Redo" data-localize-tooltip="Redo"></a>        </div>      </div>      <div name="search_wrapper" class="new_head_tools_wrapper">      </div>    </div>  </div>'},_toolboxMarkup:function(){var html='<div class="tools_container embed_annotation_tools" style="top: 100px;" data-bind="style: {display: $root.canAnnotate() && ($root.isToolbarEnabled || !$root.embeddedAnnotation) ? \'\' : \'none\'}">  <span class="tools_dots"></span>  <ul class="tools_list">    <li>      <button class="tool_field hand_box" data-bind="css: {\'active\': $data.annotationModeObservable() == null }, click: setHandToolMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="SelectTool">Select tool</div>      </button>    </li>';return(this.options.enabledTools&AnnotationTools.Text)==AnnotationTools.Text&&(html+='    <li data-bind="visible: ($root.isTextAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field text_box_annotate" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Text }, click: setTextAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="TextAnnotation" >Text annotation</div>      </button>    </li>'),
(this.options.enabledTools&AnnotationTools.Area)==AnnotationTools.Area&&(html+='    <li data-bind="visible: ($root.isRectangleAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field area_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Area }, click: setAreaAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="AreaAnnotation">Area annotation</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.Point)==AnnotationTools.Point&&(html+='    <li data-bind="visible: ($root.isPointAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field point_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Point }, click: setPointAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="PointAnnotation">Point annotation</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.TextStrikeout)==AnnotationTools.TextStrikeout&&(html+='    <li data-bind="visible: ($root.isStrikeoutAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field strike_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.TextStrikeout }, click: setStrikeoutTextMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="StrikeoutText">Strikeout text</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.Polyline)==AnnotationTools.Polyline&&(html+='    <li data-bind="visible: ($root.isPolylineAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field polyline_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Polyline }, click: setPolylineAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="PolylineAnnotation">Polyline annotation</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.TextField)==AnnotationTools.TextField&&(html+='    <li data-bind="visible: ($root.isTypewriterAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field highlight_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.TextField }, click: setTextFieldAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="TypewriterTool">Typewriter tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.Watermark)==AnnotationTools.Watermark&&(html+='    <li data-bind="visible: ($root.isWatermarkAnnotationButtonEnabled || !$root.embeddedAnnotation)">      <button class="tool_field watermark_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Watermark }, click: setWatermarkAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="WatermarkTool">Watermark tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.TextReplacement)==AnnotationTools.TextReplacement&&(html+='    <li>      <button class="tool_field replace_box" data-bind="visible: $root.docType() == \'Words\', css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.TextReplacement }, click: setReplacementAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="TextReplacementTool">Text replacement tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.Arrow)==AnnotationTools.Arrow&&(html+='    <li>      <button class="tool_field arrow_tool" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Arrow }, click: setArrowAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="PointerTool">Pointer tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.TextRedaction)==AnnotationTools.TextRedaction&&(html+='    <li data-bind="visible: canRedact()">      <button class="tool_field redtext_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.TextRedaction }, click: setTextRedactionAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="TextRedactionTool">Text redaction tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.ResourcesRedaction)==AnnotationTools.ResourcesRedaction&&(html+='    <li data-bind="visible: canRedact()">      <button class="tool_field redarea_box" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.ResourcesRedaction }, click: setResourcesRedactionAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="ResourceRedactionTool">Resource redaction tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.TextUnderline)==AnnotationTools.TextUnderline&&(html+='    <li>      <button class="tool_field underline_tool" data-bind="css: {\'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.TextUnderline }, click: setTextUnderlineAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="UnderlineTextTool">Underline text tool</div>      </button>    </li>'),(this.options.enabledTools&AnnotationTools.Distance)==AnnotationTools.Distance&&(html+='    <li>      <button class="tool_field ruler_tool" data-bind="css: { \'active\': $data.annotationModeObservable() == Annotation.prototype.AnnotationType.Distance }, click: setDistanceAnnotationMode">        <div class="popupdiv-hover tool_field_tooltip small_button" data-localize="DistanceTool">Distance tool</div>      </button>    </li>'),html+="  </ul></div>",$(html)},_sidebarMarkup:function(){return $('<div style="position: absolute; right: 16px; z-index: 9999; margin-top: 5px;" class="comments_sidebar_wrapper"         data-bind="style: {display: $root.isRightPanelEnabled ? \'\' : \'none\' }">  <div style="display: none" class="comments_sidebar_expanded">    <a class="comments_togle_btn expanded_toggle_icon"></a>    <ul class="comment_tabs_buttons">      <li data-bind="visible: !embeddedAnnotation">        <a href="#tab_summary"><span class="com_sum_icon"></span></a>      </li>      <li>        <a href="#tab_comments"><span class="com_com_icon"></span></a>      </li>    </ul>    <div id="tab_summary" class="comments_content ui-tabs-panel ui-widget-content ui-corner-bottom" style="height: 492px;">      <div class="comments_scroll" style="height: 473px;">        <div class="scrollbar" style="height: 433px;">          <div class="track" style="height: 433px;">            <div class="thumb" style="height: 50px; top: 0px;">              <div class="end"></div>            </div>          </div>        </div>        <div class="viewport" style="height: 453px;">          <div class="overview" style="top: 0px;">            <div>              <h3 class="com_heading colon" data-localize="Summary">Summary:</h3>              <!-- ko foreach: annotationsByPages.pageNumbers -->                <h3 class="page_number_in_summary" data-bind="text: \'@localize(Page) \' + ($data + 1)"></h3>                <!-- ko foreach: $parent.annotationsByPages["page_" + $data].annotations -->                  <div class="collapsed_anno_box" data-bind="click: function(){$root.activeAnnotation($data); $root.showExpandedCommentsPanel();}">                    <a class="anno_select anno_universal_icon" href="#">                      <span class="comments_number"                           data-bind="visible: $data.replyCount, text: $data.replyCount, style: {backgroundColor: $root.getLastReplyColor($data)}"></span>                    </a>                    <a href="#" class="tab_sum_comment_text" data-bind="text: $root.getLastReplyText($data)"></a>                  </div>                <!-- /ko -->              <!-- /ko -->            </div>          </div>       </div>     </div>   </div>   <div id="tab_comments" class="comments_content ui-tabs-panel ui-widget-content ui-corner-bottom" style="height: 453px;">     <div class="comments_scroll" style="height: 453px;">       <div class="scrollbar" style="height: 433px;">         <div class="track" style="height: 433px;">           <div class="thumb" style="height: 50px; top: 0px;">             <div class="end"></div>           </div>         </div>       </div>        <div class="viewport" style="height: 433px;">          <div class="overview" style="top: 0px;">            <a class="red_button_sb right" href="#" data-bind="click: $root.removeActiveAnnotation, visible: ($root.canDelete() && $root.activeAnnotation() != null)" data-localize="DeleteAnnotation">Delete Annotation</a>            <h3 class="com_heading colon" data-localize="CommentsForAnnotation">Comments for annotation:</h3>            <!-- ko if: activeAnnotation() != null -->            <!-- ko foreach: activeAnnotation().replies -->            <div class="comment_box_sidebar" data-bind="css: {\'lvl1\': replyLevel == 0, \'lvl2\': replyLevel == 1, \'lvl3\':replyLevel >= 2}">               <div class="comment_avatar"><span class="blanc_avatar_icon"></span><img alt="" style="position: absolute; left: 0;" data-bind="visible: avatarUrl, src: avatarUrl" onerror="$(this).hide();" onload="if (this.width == 0) { $(this).hide(); }" /></div>               <span class="comment_name" data-bind="text: userName, visible: guid() != null"></span>               <p class="comment_time" data-bind="text: displayDateTime, visible: guid() != null"></p>               <div class="comment_text_wrapper mousetrap">                   <span class="comment_box_pointer"></span>                   <div class="comment_text mousetrap" data-bind="htmlValue: text, valueUpdate: [\'keyup\'],                                                    attr: {contenteditable: $root.activeAnnotation().activeReply() == $index() || $data.guid() == null},                                                    hasfocus: $root.activeAnnotation().activeReply() == $index(),                                                    event: {blur: function(){$root.commitAnnotationReplyOnBlur($root.activeAnnotation(), false, $data);} }">                   </div>               </div>               <!-- ko if: guid() != null -->               <!-- ko if: $data.userGuid == $root.userId -->               <a class="comment_reply_btn" data-bind="text: \'@localize(Edit)\', visible: $root.activeAnnotation().activeReply() != $index(), click: function(){ $data.initialText = $data.text(); $root.activeAnnotation().activeReply($index()) }" href="#">Edit</a>               <a class="comment_reply_btn" data-bind="text: \'@localize(Delete)\',visible: $root.activeAnnotation().activeReply() != $index(), click:                    function(){ /*askAndDeleteReply($root, $root.activeAnnotation(), $data)*/ $root.deleteAnnotationReply($root.activeAnnotation().guid, $data.guid()); }" href="#">Delete</a>               <!-- /ko -->               <!-- ko if: $data.userGuid != $root.userId -->               <a class="comment_reply_btn" data-bind="text: \'@localize(Reply)\', visible: $root.activeAnnotation().activeReply() != $index(), click: function(){ $root.addChildReply($root.activeAnnotation(), $data.guid()) }" href="#">Reply</a>               <!-- /ko -->               <a class="red_button_sb right" href="#"                   data-bind="text: \'@localize(Submit)\',visible: $root.activeAnnotation().activeReply() == $index(),                              click: function(data, e) { $root.commitAnnotationReply($root.activeAnnotation()); }, clickBubble: false">Submit</a>               <a class="comment_reply_btn" href="#" data-bind="text: \'@localize(Cancel)\',visible: $root.activeAnnotation().activeReply() == $index(), click: function(data, e) { $data.text($data.initialText); $data.initialText = null; $root.activeAnnotation().activeReply(-1); }">Cancel</a>               <!-- /ko -->               <!-- ko if: guid() == null -->               <a class="red_button_sb right" href="#"                   data-bind="text: \'@localize(Submit)\',visible: $root.activeAnnotation().activeReply() == $index(),                              click: function(data, e) { $root.commitAnnotationReply($root.activeAnnotation()); return false;}, clickBubble: false">Submit</a>               <a class="comment_reply_btn" href="#" data-bind="text: \'@localize(Cancel)\', click: $root.deleteReply.bind($root, $data)">Cancel</a>               <!-- /ko -->           </div>           <!-- /ko -->           <!-- /ko -->           </div>         </div>      </div>    </div>  </div>  <div class="comments_sidebar_collapsed" style="display: block;">    <a class="comments_togle_btn collapsed_toggle_icon"></a>    <div style="overflow:hidden;height:100%;width:100%;position: relative">      <div class="annotation_icons_wrapper">        <!-- ko foreach: annotations -->          <div class="collapsed_anno_box" style="position: absolute" data-bind="visible: ($data.commentsEnabled == true && ($root.disconnectUncommented == false || $data.replyCount() > 0)), click: function(){$root.activeAnnotation($data); $root.showExpandedCommentsPanel();}, style: {top: ($data.annotationSideIconDisplayPosition().y - $root.fixedIconShift) + \'px\'}">            <a class="anno_select anno_universal_icon" href="#">              <span class="comments_number" data-bind="visible: $data.replyCount, text: $data.replyCount, style: {backgroundColor: $root.getLastReplyColor($data)}"></span>            </a>          </div>        <!-- /ko -->      </div>    </div>	  </div></div>')},_textfieldToolbarMarkup:function(){return'<span class="ta_resize_box" data-bind="visible: toolbarIsVisible() || mouseIsOver(), makeDraggable:$root.getDraggableOptionsForResizeMarker($data)"></span><div class="text_area_toolbar" data-bind="event: {            mouseover: function() { if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseDestroy(); } },             mouseout: function() { if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseInit(); } }        },        clickBubble: true,        visible: toolbarIsVisible() || mouseIsOver()">  <a href="#" class="ta_move">    <span class="ta_tooltip ta_tp_move">Move <span class="ta_tooltip_pointer"></span></span>  </a>  <div class="ta_tool_wrapper">    <span class="ta_tooltip ta_tp_color">Select Color<span class="ta_tooltip_pointer"></span></span>    <span data-bind="style: { backgroundColor: $root.getRgbColorFromInteger($data.annotation.fontColor()) }" class="ta_color_selected"></span>    <a class="ta_dropdown_btn dropdown_menu_button" href="#" data-bind="click: function(data, event) { $root.dropdownMenuClickHandler.call(event.target); }"></a>    <ul class="ta_dropdown dropdown_menu" data-bind="foreach: $root.fontColors">      <li> <a class="ta_color_sel" data-bind="style: { backgroundColor: $root.getRgbColorFromInteger($data) }, click: function() { $parent.annotation.fontColor($data); $root.setTextFieldColor($parent); }" href="#"></a></li>    </ul>  </div>  <div class="ta_tool_wrapper">    <span class="ta_tooltip ta_tp_font">Select Font<span class="ta_tooltip_pointer"></span></span>    <span class="ta_font_selected" data-bind="text: $data.selectedFontFamily()"></span>    <a class="ta_dropdown_btn dropdown_menu_button" href="#" data-bind="click: function(data, event) { $root.dropdownMenuClickHandler.call(event.target); }"></a>    <ul id="fontFamilyList" class="ta_dropdown dropdown_menu" data-bind="foreach: $data.fontFamilies">      <li data-bind="click: function() { $parent.selectedFontFamily($data); $root.saveTextField($parent); }">        <a href="#" data-bind="text: $data"></a>      </li>    </ul>  </div>  <div class="ta_tool_wrapper">    <span class="ta_tooltip ta_tp_font_size">Select Font Size<span class="ta_tooltip_pointer"></span></span>    <span class="ta_size_selected" data-bind="text: $data.selectedFontSize()"></span>    <a class="ta_dropdown_btn dropdown_menu_button" href="#" data-bind="click: function(data, event) { $root.dropdownMenuClickHandler.call(event.target); }"></a>    <ul id="fontSizeList" class="ta_dropdown dropdown_menu" data-bind="foreach: $data.fontSizes">      <li data-bind="click: function() { $parent.selectedFontSize($data); $root.saveTextField($parent); }">        <a href="#" data-bind="text: $data"></a>      </li>    </ul>  </div>  <div class="ta_tool_wrapper">    <span class="ta_tooltip ta_tp_font_size_adjust">Adjust Font Size<span class="ta_tooltip_pointer"></span></span>    <a class="ta_plus" href="#" data-bind="click: function() { if ($data.selectedFontSize() < $data.fontSizes[$data.fontSizes.length - 1]) $data.selectedFontSize($data.selectedFontSize() + 1); $root.saveTextField($data); return true; }, clickBubble: true">    </a>    <a class="ta_minus" href="#" data-bind="click: function(){ if ($data.selectedFontSize() > $data.fontSizes[0]) $data.selectedFontSize($data.selectedFontSize() - 1); $root.saveTextField($data); return true; }, clickBubble: true">    </a>  </div>  <div class="ta_del_wrapper">    <span class="ta_tooltip ta_tp_del">Delete<span class="ta_tooltip_pointer"></span></span>    <a class="ta_del" data-bind="click: function(){ $root.removeAnnotation($data.annotation); var sel = $root.getSelectableInstance(); sel._mouseInit(); }" href="#"></a>  </div></div>'},_watermarksMarkup:function(){return"<!-- ko foreach: pages -->  <!-- ko foreach: $root._watermarks() -->    <div style=\"display: none;z-index:1\" class=\"doc_text_area\"         data-bind=\"style: { left: $root.convertRectToScreenCoordinatesForPage($data.annotation.bounds(), $parent.number - 1).left() + 'px',                             top: $root.convertRectToScreenCoordinatesForPage($data.annotation.bounds(), $parent.number - 1).top() + 'px', display: 'block'},                             makeDraggable: $root.getDraggableOptionsForTextFields($data)\" >      <div class=\"doc_text_area_text mousetrap\"           data-bind=\"htmlValue: text,           style: { minWidth: $root.convertRectToScreenCoordinatesForPage($data.annotation.bounds(), $parent.number - 1).width() + 'px',                    minHeight: $root.convertRectToScreenCoordinatesForPage($data.annotation.bounds(), $parent.number - 1).height() + 'px', display: 'block',                    fontFamily: $data.selectedFontFamily(), fontSize: $data.selectedFontSize().toString() + 'px',                    border: $data.toolbarIsVisible() || mouseIsOver() ? '1px dotted #000000' : 'none',                    background: $data.toolbarIsVisible() || mouseIsOver() ? 'none repeat scroll 0 0 #FFFFFF' : 'none',                    boxShadow: $data.toolbarIsVisible() || mouseIsOver() ? '1px 1px 3px 0 rgba(0, 0, 0, 0.6)' : 'none',                    color: $root.getRgbColorFromInteger($data.annotation.fontColor()),                    opacity: $data.toolbarIsVisible() || mouseIsOver() ? 1.0 : 0.5                   },           attr: { contenteditable: true },           event: { koValueUpdated: function(wm, event, element) { /*askAndDeleteEmptyWatermark($root, $data, element);*/ $root.saveTextField($data); $data.toolbarIsVisible($.trim($data.text()).length == 0); if ($.trim($data.text()).length != 0) $(element).blur(); return true; },                    mouseover: function() { $data.mouseIsOver(true); if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseDestroy(); } },                    mouseout: function(){ $data.mouseIsOver(false); if (!$data.annotation.isBeingDeleted()) { var sel = $root.getSelectableInstance(); sel._mouseInit(); } }                  },           click: function() { $data.toolbarIsVisible(true); return true; }\" spellcheck=\"false\"></div>"+this._textfieldToolbarMarkup()+"    </div>  <!-- /ko --><!-- /ko -->"},_modalsMarkup:function(){return $('<div class="modal fade export_annotations_modal">  <h3 data-localize="ExportingTheDocument">Exporting the document</h3></div><div class="modal fade importing_annotations_modal">  <h3 class="ellipsis" data-localize="ImportingInternalDocumentAnnotations">Importing internal document annotations...</h3></div>  <div class="modal fade print_document_modal" data-bind="visible: printing, css: { in: printing } ">    <h3 data-localize="PrintingTheDocument">Printing the document</h3>  </div><div class="modal fade manage_collaborators_modal" id="modal_inv">  <a data-dismiss="modal" class="popclose"></a>  <div class="sigModalbody">    <ul class="nav nav-tabs">      <li class="active">        <a href="#inv_mail" data-toggle="tab">E-mail</a>      </li>    </ul>    <div id="addCollaboratorTab" class="tab-content">      <div id="inv_mail" class="tab-pane active">        <div class="ivn_line_wrapper">          <p class="inv_line_name">E-mail</p>          <input id="newReviewer" type="text" class="inv_mail_input" data-bind="value: newCollaborator, valueUpdate: [\'keypress\',\'afterkeydown\',\'propertychange\',\'input\']"/>          <a class="red_button_sb right" data-toggle="modal" href="#modal_add_from_contacts">Add from Contacts</a>        </div>        <div class="ivn_line_wrapper">          <p class="inv_line_name" data-localize="Message">Message</p>          <textarea class="inv_msg_area" data-bind="value: reviewerInvitationMessage, valueUpdate: [\'keypress\',\'afterkeydown\',\'propertychange\',\'input\']"></textarea>        </div>        <button class="red_button_sb inv_send_btn" data-dismiss="modal" data-localize="Cancel">Cancel</button>        <button class="red_button_sb inv_send_btn" data-bind="click: $root.addDocumentReviewer.bind($root)" data-localize="Send">Send</button>        <span class="progresspin right" data-bind="visible: busyAddingReviewer()"></span>      </div>    </div>  </div></div>')},_tooltipMarkupt:function(){return'<script type="text/html" id="wt-comments">    <li>        <h5 data-bind="text: userName">John Doe</h5>        <p class="date" data-bind="text: displayDateTime">16 Apr 2014, 12:10:11</p>        <p class="wt-comment" data-bind="text: text">Check this part please</p>        <a class="icon-expand" href="#expand" data-toggle="tooltip" data-placement="left" title="" data-original-title="Expand">+</a>        <ul data-bind="template: { name: \'wt-comments\', foreach: childReplies }"></ul>    </li></script><div class="widget-tooltip" style="left: 100px; top: 300px; height: 17px; z-index: 24;" data-bind="style: { left: (prevHoveredAnnotation() != null ? Math.min(prevHoveredAnnotation().displayBounds().left(), prevHoveredAnnotation().displayBounds().right()) : \'-100\') + \'px\', top: (prevHoveredAnnotation() != null ? (Math.min(prevHoveredAnnotation().displayBounds().top(), prevHoveredAnnotation().displayBounds().bottom())  - 17) : \'-100\') + \'px\', width: (prevHoveredAnnotation() != null ? (Math.abs(prevHoveredAnnotation().displayBounds().width()) + 17) : \'0\') + \'px\' }, event: { mouseenter: function() { $root.hoveredAnnotation($root.prevHoveredAnnotation()); }, mouseleave: function (data, event) { $root.hoveredAnnotation(null); $root.prevHoveredAnnotation(null); $(event.target).children(\'.wt-container\').hide(); } }">    <div class="widget-tooltip" style="left: 100px; top: 17px; width: 17px; z-index: 24;" data-bind="style: { left: (prevHoveredAnnotation() != null ? Math.abs(prevHoveredAnnotation().displayBounds().width()) : \'-100\') + \'px\', height: (prevHoveredAnnotation() != null ? Math.abs(prevHoveredAnnotation().displayBounds().height()) : \'0\') + \'px\' }">    </div>    <div class="wt-icon" data-bind="visible: (hoveredAnnotation() != null), click: function (data, event) { $root.expandAnnotationTooltip(event); }">    </div>    <div class="wt-container" style="display: none;" data-bind="with: hoveredAnnotation, visible: (hoveredAnnotation() != null)">        <div class="wt-header" data-bind="text: (replyCount() + \' comment(s):\')">1 comment</div>        <a class="wt-close" href="#close" data-bind="clickBubble: false, click: function (data, event) { $(event.target).parents(\'.wt-container\').hide(); }">Close</a>        <div class="scrollbar scrollable" tabindex="-1">            <div class="scroll-bar vertical" style="height: 230px; display: none;">                <div class="thumb" style="top: 0px; height: 237.219730941704px;">                </div>            </div>            <div class="viewport" style="height: 230px; width: 180px;">                <div class="overview" style="top: 0px; left: 0px;">                    <ul data-bind="template: { name: \'wt-comments\', foreach: $data.comments }"></ul>                </div>            </div>            <div class="scroll-bar horizontal" style="width: 180px; display: none;">                <div class="thumb" style="left: 0px; width: 181.005586592179px;"></div>            </div>        </div>    </div></div>'},getViewer:function(){return this._viewer},activateAnnotation:function(annotation){this.viewerViewModel.activeAnnotation(annotation)},getAnnotationsObservable:function(){return this.viewerViewModel.annotations},getAnnotationsByPagesObservable:function(){return this.viewerViewModel.annotationsByPagesObservable},getActiveAnnotationObservable:function(){return this.viewerViewModel.activeAnnotation},getLastReplyColor:function(annotation){return this.viewerViewModel.getLastReplyColor(annotation)},getLastReplyText:function(annotation){return this.viewerViewModel.getLastReplyText(annotation)},deleteActiveAnnotation:function(){this.viewerViewModel.deleteActiveAnnotation()},commitReplyOfActiveAnnotation:function(replyIndex){var activeAnnotation=this.viewerViewModel.activeAnnotation();activeAnnotation.activeReply(replyIndex),this.viewerViewModel.commitAnnotationReply(activeAnnotation)},deleteReply:function(annotationGuid,replyGuid){this.viewerViewModel.deleteAnnotationReply(annotationGuid,replyGuid)},getCurrentUserGuid:function(){return this.viewerViewModel.userId},addChildReply:function(annotation,parentReplyGuid){return this.viewerViewModel.addChildReply(annotation,parentReplyGuid)},setAnnotationMode:function(mode){switch(mode){case Annotation.prototype.AnnotationType.Text:this.viewerViewModel.setTextAnnotationMode();break;case Annotation.prototype.AnnotationType.Area:this.viewerViewModel.setAreaAnnotationMode();break;case Annotation.prototype.AnnotationType.Point:this.viewerViewModel.setPointAnnotationMode();break;case Annotation.prototype.AnnotationType.TextStrikeout:case Annotation.prototype.AnnotationType.TextRemoval:this.viewerViewModel.setStrikeoutTextMode();break;case Annotation.prototype.AnnotationType.Polyline:this.viewerViewModel.setPolylineAnnotationMode();break;case Annotation.prototype.AnnotationType.TextField:this.viewerViewModel.setTextFieldAnnotationMode();break;case Annotation.prototype.AnnotationType.Watermark:this.viewerViewModel.setWatermarkAnnotationMode();break;case Annotation.prototype.AnnotationType.TextReplacement:this.viewerViewModel.setReplacementAnnotationMode();break;case Annotation.prototype.AnnotationType.Arrow:this.viewerViewModel.setArrowAnnotationMode();break;case Annotation.prototype.AnnotationType.TextRedaction:this.viewerViewModel.setTextRedactionAnnotationMode();break;case Annotation.prototype.AnnotationType.ResourcesRedaction:this.viewerViewModel.setResourcesRedactionAnnotationMode();break;default:this.viewerViewModel.setHandToolMode()}},exportAnnotations:function(format){this.viewerViewModel.exportAnnotationsTo(format)},importAnnotations:function(fileId){fileId?this.viewerViewModel.importDocumentAnnotations(fileId):this.viewerViewModel.importAnnotations()},loadDocument:function(fileId){this.viewerViewModel.loadDocument(fileId)},initControlsAndHandlers:function(){window.groupdocs.initAnnotationControlsAndHandlers(this.element,this._viewer,this.viewerViewModel)}}),groupdocsAnnotationViewerModel=function(options){measurementAnnotationModel.prototype.constructor.apply(this,arguments)},$.extend(groupdocsAnnotationViewerModel.prototype,measurementAnnotationModel.prototype,{getFile:function(fileId,callback,errorCallback){this._portalService.getFile(fileId,function(response){callback.apply(this,[response])},function(error){errorCallback.apply(this,[error])})}}),groupdocsAnnotationViewerViewModel=function(options){measurementAnnotationViewModel.prototype.constructor.apply(this,arguments)},$.extend(groupdocsAnnotationViewerViewModel.prototype,measurementAnnotationViewModel.prototype,{annotationHub:null,fileExplorerEnabled:ko.observable(!1),printEnabled:ko.observable(!1),licensed:ko.observable(!1),annotationsByPages:null,showHeader:!1,showZoom:!1,localizedStrings:null,charSelection:!1,thumbsImageBase64Encoded:null,undoEnabled:!0,exportMenuOpened:!1,printMenuOpened:!1,_annotationPrinter:null,_create:function(options){var self=this;if(this._model=new groupdocsAnnotationViewerModel(options),this._init(options),this.fileExplorerEnabled=ko.observable(options.showFileExplorer||!1),this.printEnabled=ko.observable(options.showPrint||!1),this.licensed=ko.observable(!0),this.annotationsByPages={pageNumbers:ko.observableArray([])},this.annotationsByPagesObservable=ko.observableArray(),this.showHeader=options.showHeader,this.showZoom=options.showZoom,this.localizedStrings=options.localizedStrings,this.undoEnabled=options.undoEnabled,this.exportMenuOpened=ko.observable(!1),this.printMenuOpened=ko.observable(!1),this.thumbsImageBase64Encoded=options.thumbsImageBase64Encoded,this.licensed.subscribe(function(newValue){window.setTimeout(self.reInitCanvasOffset.bind(self),100)}),this.printEnabled()){this._annotationPrinter=$(this.element).printable({contentLoader:this._model.getDocumentPrintView.bind(this._model)});var vm=$(this._annotationPrinter).printable("viewModel");ko.applyBindings(vm,$(this.element).find(".print_document_modal").get(0))}},_init:function(options){measurementAnnotationViewModel.prototype._init.call(this,options);var self=this,prevAnnotations=[];this.annotations.subscribe(function(newValue){var changedPages={},changes=$.grep(ko.utils.compareArrays(prevAnnotations,newValue),function(x){return isNaN(x.moved)&&("added"==x.status||"deleted"==x.status)});prevAnnotations=newValue.slice(0),$.each(changes,function(index,valueArgs){var pageNumber=valueArgs.value.pageNumber,pageKey="page_"+pageNumber.toString(),pageAnnotations=self.annotationsByPages[pageKey];pageAnnotations||(pageAnnotations={page:pageNumber,annotations:ko.observableArray([])},self.annotationsByPages[pageKey]=pageAnnotations,self.annotationsByPages.pageNumbers.push(pageNumber)),changedPages[pageKey]=pageAnnotations,self.annotationsByPagesObservable()[pageNumber]||(self.annotationsByPagesObservable.valueWillMutate(),self.annotationsByPagesObservable()[pageNumber]=ko.observableArray(),self.annotationsByPagesObservable.valueHasMutated()),"deleted"==valueArgs.status?(pageAnnotations.annotations.remove(valueArgs.value),self.annotationsByPagesObservable()[pageNumber].remove(valueArgs.value),0==pageAnnotations.annotations().length&&(self.annotationsByPages.pageNumbers.remove(pageNumber),self.annotationsByPages[pageKey]=void 0)):(pageAnnotations.annotations.push(valueArgs.value),self.annotationsByPagesObservable()[pageNumber].push(valueArgs.value))}),$.each(changedPages,function(i,p){p.annotations.sort(function(x,y){var diff=x.bounds().top()-y.bounds().top();return 0==diff?0:diff>0?1:-1})}),self.annotationsByPages.pageNumbers.sort()},this)},getLocalized:function(key){var localized=this.localizedStrings[key];return localized},showExpandedCommentsPanel:function(){this.enableSidePanel&&(this.element.find(".comments_sidebar_collapsed").hide(),this.element.find(".comments_sidebar_expanded").show(),this.element.find(".comments_sidebar_expanded").tabs("option","active",1),
this.element.find(".comments_scroll").tinyscrollbar_update("relative"),this.redrawConnectingLines())},expandAnnotationTooltip:function(e){return $(e.target).siblings(".wt-container").show(),$(".widget-tooltip .wt-comment").each(function(){jGroupdocs.html.textWidth($(this).text(),"400 11px 'PT Sans', Helvetica, Arial, sans-serif")>$(this).width()&&$(this).parent().addClass("overflowed")}),$(".widget-tooltip .scrollbar").customScrollbar(),!1},dropdownMenuClickHandler:function(target){var self=$(this);self.hasClass("active")?self.parent().find(".dropdown_menu").hide("blind","fast",function(){self.removeClass("active"),document.activeElement=self[0]}):self.parent().find(".dropdown_menu").show("blind","fast",function(){self.addClass("active")})},markerClickHandler:function(annotation){measurementAnnotationViewModel.prototype.markerClickHandler.call(this,annotation),this.clickableAnnotations&&this.showExpandedCommentsPanel()},toggleExportMenu:function(viewModel,event){this.exportMenuOpened(!this.exportMenuOpened()),event.stopPropagation()},togglePrintMenu:function(viewModel,event){this.printMenuOpened(!this.printMenuOpened()),event.stopPropagation()},getPageImageHorizontalOffset:function(){var leftImageMargin=17;return leftImageMargin},exportAnnotationsTo:function(format,mode){this.exportingAnnotationsProgress.modal("show"),this._model.exportAnnotations(this.fileId,format||"Pdf",mode||Annotation.prototype.AnnotationExportMode.Append,function(response){this._onAnnotationsExported(response)}.bind(this),function(error){this.exportingAnnotationsProgress.modal("hide"),this._onError(error)}.bind(this))},getPdfVersionOfDocument:function(){this.exportingAnnotationsProgress.modal("show"),this._model.getPdfVersionOfDocument(this.fileId,function(response){this._onPdfVerionOfDocumentReceived(response)}.bind(this),function(error){this.exportingAnnotationsProgress.modal("hide"),this._onError(error)}.bind(this))},downloadDocument:function(){this._model.getFile(this.fileId,function(response){this._onDocumentDownloaded(response)}.bind(this),function(error){this._onError(error)})},printDocument:function(){this.printAnnotations({components:"Pages"})},printAnnotations:function(setup){this._annotationPrinter||(this._annotationPrinter=$(this.element).printable({contentLoader:this._model.getDocumentPrintView.bind(this._model)})),$(this._annotationPrinter).printable("print",this.fileId,setup||{components:"All",renew:!0})},openFileExplorer:function(){$(this.element).find(".fileOpenDialogWrapper").modal("show")},onFileSelected:function(metadata){$(".input_search_clear").click(),this.loadDocument(metadata.guid)},undo:function(){this._undoRedo&&this._undoRedo.undoAsync()},redo:function(){this._undoRedo&&this._undoRedo.redoAsync()},_onDocumentLoaded:function(response){if(measurementAnnotationViewModel.prototype._onDocumentLoaded.apply(this,arguments),this.licensed(response.lic===!0),response.lic||0!=$(this.element).find(".licBanner").length||($(this.element).find(".viewer_mainwrapper").addClass("viewer_mainwrapper_trial"),this.showHeader||$(this.element).find(".viewer_mainwrapper").css("top","32px")),this.showZoom){var zoomViewModel=this.viewerAdapter.zooming.zooming("getViewModel");zoomViewModel.setFitWidthZoom(this.getFitWidthZoom()),zoomViewModel.setFitHeightZoom(this.getFitHeightZoom())}else $(".zoom_wrappper").css("display","none");this.annotationHub=$.connection.annotationHub.client,this.annotationHub.createAnnotationOnClient=this._hubHandler._onAnnotationCreated.bind(this),this.annotationHub.createReplyOnClient=this._hubHandler._onAnnotationReplyCreated.bind(this),this.annotationHub.moveAnnotationOnClient=this._hubHandler._onAnnotationMoved.bind(this),this.annotationHub.setReviewersColorsOnClient=this._hubHandler._onReviewerColorChanged.bind(this),this.annotationHub.setReviewerRightsOnClient=this._hubHandler._onReviewerRightsChanged.bind(this),this.annotationHub.resizeAnnotationOnClient=this._hubHandler._onAnnotationResized.bind(this),this.annotationHub.setTextFieldColorOnClient=this._hubHandler._onTextFieldColorSet.bind(this),this.annotationHub.setAnnotationBackgroundColorOnClient=this._hubHandler._onAnnotationBackgroundColorSet.bind(this),this.annotationHub.deleteAnnotationOnClient=this._hubHandler._onAnnotationRemoved.bind(this),this.annotationHub.moveAnnotationMarkerOnClient=this._hubHandler._onAnnotationMarkerMoved.bind(this),this.annotationHub.editAnnotationReplyOnClient=this._hubHandler._onAnnotationReplyEdited.bind(this),this.annotationHub.deleteAnnotationReplyOnClient=this._hubHandler._onAnnotationReplyRemoved.bind(this),this.annotationHub.updateTextFieldOnClient=this._hubHandler._onTextFieldUpdated.bind(this),this.annotationHub.setAnnotationAccessOnClient=this._hubHandler._onAnnotationAccessChanged.bind(this);var isChrome=!1,urlParts=jGroupdocs.http.splitUrl($.ui.groupdocsViewer.prototype.applicationPath),baseUrl=urlParts.schema+"://"+urlParts.authority+(urlParts.path&&"/"!=urlParts.path?"/"+urlParts.path:"");$.connection.hub.qs={uid:this.userId},$.connection.hub.url=baseUrl+"/signalr1_1_2/hubs",$.connection.hub.start({jsonp:isChrome}).done(this._onConnectionEstablished.bind(this)),this._localizeElements(),this._setThumbsImage(),localizedStrings=this.localizedStrings},_localizeElements:function(){var localizedStrings=this.localizedStrings;null!=localizedStrings&&this.element.find("[data-localize],[data-localize-ph],[data-localize-tooltip]").each(function(){var localizationTextValue,that=$(this),localizationKey=that.attr("data-localize");localizationKey?(localizationTextValue=localizedStrings[localizationKey],that.text(localizationTextValue)):(localizationKey=that.attr("data-localize-ph"),localizationKey?(localizationTextValue=localizedStrings[localizationKey],that.attr("placeholder",localizationTextValue)):(localizationKey=that.attr("data-localize-tooltip"),localizationKey&&(localizationTextValue=localizedStrings[localizationKey],that.attr("data-tooltip",localizationTextValue))))})},_setThumbsImage:function(){var thumbsButton=this.element.find(".thumbs_btn");this.showThumbnails&&null!=this.thumbsImageBase64Encoded&&thumbsButton.css("background-image","url(data:image/png;base64,"+this.thumbsImageBase64Encoded+")").css("background-position","0 0")},_onAnnotationsImported:function(response){measurementAnnotationViewModel.prototype._onAnnotationsImported.apply(this,arguments),this.loadDocument(response.fileId)},_onAnnotationsExported:function(response){this.exportingAnnotationsProgress.modal("hide"),this._downloadFileAt(response.url)},_onAnnotationCreated:function(annotation,markerFigure){measurementAnnotationViewModel.prototype._onAnnotationCreated.call(this,annotation,markerFigure),this.showExpandedCommentsPanel()},_onPdfVerionOfDocumentReceived:function(response){this.exportingAnnotationsProgress.modal("hide"),this._downloadFileAt(response.url)},_onDocumentDownloaded:function(response){this._downloadFileAt(response.url)},_downloadFileAt:function(url){var frameId="groupdocs-file-download",downloader=$("#"+frameId);downloader&&0!=downloader.length||(downloader=$("<iframe>",{id:frameId}).hide().appendTo("body")),downloader.attr("src",url)},_onDocumentPrinted:function(response){},_onConnectionEstablished:function(result){$.connection.annotationHub.server.setDocumentGuidForConnection(this.fileId),this.getDocumentCollaborators(),this.listAnnotations()},_hubHandler:{_onAnnotationCreated:function(connectionId,data){connectionId!=$.connection.hub.id&&this.addAnnotationFromAnotherUser(data)},_onAnnotationReplyCreated:function(connectionId,data){connectionId!=$.connection.hub.id&&this.addAnnotationReplyFromAnotherUser(data)},_onAnnotationMoved:function(connectionId,annotationGuid,position){connectionId!=$.connection.hub.id&&this.moveAnnotationOnClient(annotationGuid,position)},_onReviewerColorChanged:function(connectionId,reviewerDescriptions){connectionId!=$.connection.hub.id&&this.setReviewersColorsOnClient(reviewerDescriptions)},_onReviewerRightsChanged:function(connectionId,reviewerDescriptions){connectionId!=$.connection.hub.id&&this.setReviewersRightsOnClient(reviewerDescriptions)},_onAnnotationResized:function(connectionId,annotationGuid,width,height){connectionId!=$.connection.hub.id&&this.resizeAnnotationOnClient(annotationGuid,width,height)},_onTextFieldColorSet:function(connectionId,annotationGuid,fontColor){connectionId!=$.connection.hub.id&&this.setTextFieldColorOnClient(annotationGuid,fontColor)},_onAnnotationBackgroundColorSet:function(connectionId,annotationGuid,color){connectionId!=$.connection.hub.id&&this.setAnnotationBackgroundColorOnClient(annotationGuid,color)},_onAnnotationRemoved:function(connectionId,annotationGuid){connectionId!=$.connection.hub.id&&this.deleteAnnotationOnClient(annotationGuid)},_onAnnotationMarkerMoved:function(connectionId,annotationGuid,position,pageNumber){connectionId!=$.connection.hub.id&&this.moveAnnotationMarkerOnClient(annotationGuid,position,pageNumber)},_onAnnotationReplyEdited:function(connectionId,annotationGuid,replyGuid,message){connectionId!=$.connection.hub.id&&this.editAnnotationReplyOnClient(annotationGuid,replyGuid,message)},_onAnnotationReplyRemoved:function(connectionId,annotationGuid,replyGuid,replies){connectionId!=$.connection.hub.id&&this.deleteAnnotationReplyOnClient(annotationGuid,replyGuid,replies)},_onTextFieldUpdated:function(connectionId,annotationGuid,text,fontFamily,fontSize){connectionId!=$.connection.hub.id&&this.updateTextFieldOnClient(annotationGuid,text,fontFamily,fontSize)},_onAnnotationAccessChanged:function(connectionId,annotationGuid,annotationAccess,annotation){connectionId!=$.connection.hub.id&&this.setAnnotationAccessOnClient(annotationGuid,annotationAccess,annotation)}}}),$.widget("ui.groupdocsAnnotationViewer",$.ui.documentAnnotation,{_createViewModel:function(){return new groupdocsAnnotationViewerViewModel(this.options)},_create:function(){$.ui.documentAnnotation.prototype._create.call(this)}})}(jQuery),window.groupdocs.initAnnotationControlsAndHandlers=function(annotationWidget,annotationsViewer,annotationsViewerVM){function flipPanels(togglePanels){function setIconsPanelScrollTop(){annotationIconsPanelVisible||(annotationIconsWrapperParent.scrollTop=docViewer.scrollTop)}function redrawLinesAndCalculateZoom(){if(setIconsPanelScrollTop(),togglePanels)annotationsViewerVM.redrawConnectingLines(!annotationIconsPanelVisible);else{annotationsViewerVM.resizePagesToWindowSize();var selectableElement=annotationsViewerVM.getSelectable();if(null!=selectableElement){var selectable=selectableElement.data("ui-dvselectable")||selectableElement.data("dvselectable");selectable.initStorage()}annotationsViewerVM.redrawWorkingArea()}}var docViewer=$(annotationsViewer)[0],annotationIconsPanelVisible=$(annotationWidget).find(".comments_sidebar_collapsed").is(":visible");if(togglePanels){annotationIconsPanelVisible||redrawLinesAndCalculateZoom();var setIntervalId=window.setInterval(function(){setIconsPanelScrollTop()},50);$(annotationWidget).find(".comments_sidebar_collapsed").toggle("slide",{direction:"right"},400,function(){clearInterval(setIntervalId),setIconsPanelScrollTop()}),$(annotationWidget).find(".comments_sidebar_expanded").toggle("slide",{direction:"right"},400,function(){annotationIconsPanelVisible?redrawLinesAndCalculateZoom():setIconsPanelScrollTop()})}else redrawLinesAndCalculateZoom();$(annotationWidget).find(".comments_scroll").tinyscrollbar_update("relative")}function resizeSidebar(){var containerHeight=$(annotationWidget).find(".doc_viewer").height();$(annotationWidget).find(".comments_content").css({height:containerHeight-152+"px"}),$(annotationWidget).find(".comments_scroll").css({height:containerHeight-152+"px"}),$(annotationWidget).find(".comments_scroll .viewport").css({height:containerHeight-172+"px"}),$(annotationWidget).find(".comments_sidebar_collapsed").css({height:containerHeight-50+"px"}),$(annotationWidget).find(".comments_scroll").tinyscrollbar_update("relative")}var commentModePanel=$(annotationWidget).find("div.embed_annotation_tools");commentModePanel.css("margin-right",0),commentModePanel.draggable({scroll:!1,handle:".tools_dots",containment:"body",appendTo:"body"}),$(annotationWidget).find(".tool_field").click(function(){var toolFields=$(annotationWidget).find(".tool_field");toolFields.hasClass("active")&&$(toolFields.removeClass("active")),$(this).addClass("active")}),$(annotationWidget).find(".header_tools_icon").hover(function(){$(this).find(".tooltip_on_hover").css("display","block")},function(){$(this).find(".tooltip_on_hover").css("display","none")}),annotationsViewerVM.enableSidePanel&&$(annotationWidget).find(".comments_togle_btn").click(function(){flipPanels(!0)}),$(annotationWidget).find(".comments_scroll").tinyscrollbar({sizethumb:50});var annotationIconsWrapperParentScrollTop,annotationIconsWrapper=$(annotationWidget).find(".annotation_icons_wrapper"),annotationIconsWrapperParent=annotationIconsWrapper.parent()[0];if(annotationsViewer.bind("onDocumentLoadComplete",function(e,data){annotationsViewerVM.setHandToolMode(),annotationIconsWrapper.height($(annotationsViewer).find(".pages_container").height()),annotationIconsWrapperParent.scrollTop=annotationIconsWrapperParentScrollTop,window.setTimeout(resizeSidebar,10)}),annotationsViewer.bind("onDocViewScrollPositionSet",function(e,data){annotationIconsWrapper.parent()[0].scrollTop=data.position}.bind(this)),annotationsViewer.bind("onBeforeScrollDocView onDocViewScrollPositionSet",function(e,data){annotationIconsWrapperParent.scrollTop!=data.position&&(annotationIconsWrapperParent.scrollTop=data.position,annotationIconsWrapperParentScrollTop=data.position)}.bind(this)),$(window).resize(function(){flipPanels(!1),resizeSidebar()}),resizeSidebar(),$("html").click(function(){$(annotationWidget).find(".dropdown_menu_button").hasClass("active")&&($(annotationWidget).find(".dropdown_menu_button.active").next(".dropdown_menu").hide("blind","fast"),$(annotationWidget).find(".dropdown_menu_button.active").removeClass("active"))}),Mousetrap){Mousetrap.stopCallback;Mousetrap.stopCallback=function(e,element,combo,sequence){return annotationsViewerVM.tabNavigationEnabled!==!0?!0:!1},Mousetrap.bind(["command+z","ctrl+z"],function(e){return annotationsViewerVM.undo(),!1}),Mousetrap.bind(["shift+command+z","ctrl+y"],function(e){return annotationsViewerVM.redo(),!1}),Mousetrap.bind(["del"],function(e){var annotation=annotationsViewerVM.activeAnnotation(),reply=annotation?annotation.getActiveReply():null;return null==annotation||null!=reply&&reply.text().length>0?!0:(annotationsViewerVM.removeAnnotation(annotation,e),!1)}),Mousetrap.bind("tab",function(e){return annotationsViewerVM.tabNavigationEnabled!==!0?!0:(annotationsViewerVM.activateNextAnnotation(),!1)}),Mousetrap.bind("shift+tab",function(e){return annotationsViewerVM.tabNavigationEnabled!==!0?!0:(annotationsViewerVM.activatePrevAnnotation(),!1)})}window.jerror=function(msg,handler,title){if($(annotationWidget).trigger("error.groupdocs",msg),annotationsViewerVM.enableStandardErrorHandling){var ttl=title||"Error";msg||(msg="Sorry, we're unable to perform your request right now. Please try again later."),$("#jerrormodal h3").text(ttl),$("#jerrormodalText").text(msg.Reason?msg.Reason:msg),handler&&$("#jerrormodal").one("hidden",handler),$("#jerrormodal").modal("show")}},$("#jerrormodal").length>0||($("<div class='grpdx jerrorwrapper'> <div id='jerrormodal' class='modal fade modal2' style='z-index: 9999'>  <div class='modal_inner_wrapper'>      <a class='popclose' data-dismiss='modal'></a>      <div class='modal_header'>          <h3>Error</h3>      </div>      <div class='modal_content'>          <div class='modal_input_wrap_left'>              <p id='jerrormodalText' class='modaltext left'>An unexpected error occured. Please contact Support team for the assistance.</p>          </div>      </div>  </div></div></div>").appendTo("body"),$("#jerrormodal").modal({show:!1}))};